(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[324],{9742:function(e,t){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,a=u(e),o=a[0],s=a[1],c=new i((o+s)*3/4-s),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(function(e,t,r){for(var i,a=[],o=t;o<r;o+=3)a.push(n[(i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}(e,o,o+16383>s?s:o+16383));return 1===i?a.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&a.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)n[o]=a[o],r[a.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},8764:function(e,t,n){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var r=n(9742),i=n(645),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>2147483647)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return l(e)}return u(e,t,n)}function u(e,t,n){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!s.isEncoding(t))throw TypeError("Unknown encoding: "+t);var n=0|d(e,t),r=o(n),i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(O(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(O(e,ArrayBuffer)||e&&O(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(O(e,SharedArrayBuffer)||e&&O(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return s.from(r,t,n);var i=function(e){if(s.isBuffer(e)){var t,n=0|f(e.length),r=o(n);return 0===r.length||e.copy(r,0,0,n),r}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?o(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return c(e),o(e<0?0:0|f(e))}function h(e){for(var t=e.length<0?0:0|f(e.length),n=o(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e,t,n){var r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),s.prototype),r}function f(e){if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function d(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||O(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(e).length;default:if(i)return r?-1:M(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=x[e[a]];return i}(this,t,n);case"utf8":case"utf-8":return b(this,t,n);case"ascii":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":return i=t,a=n,0===i&&a===this.length?r.fromByteArray(this):r.fromByteArray(this.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length-1;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){var a;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),(a=n=+n)!=a&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return -1;n=e.length-1}else if(n<0){if(!i)return -1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else -1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var h=!0,p=0;p<u;p++)if(c(e,a+p)!==c(t,p)){h=!1;break}if(h)return a}return -1}function b(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:(192&(a=e[i+1]))==128&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],(192&a)==128&&(192&o)==128&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],(192&a)==128&&(192&o)==128&&(192&s)==128&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function E(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function T(e,t,n,r,i,a){if(!s.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function N(e,t,n,r,i,a){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function C(e,t,n,r,a){return t=+t,n>>>=0,a||N(e,t,n,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,n,r,23,4),n+4}function w(e,t,n,r,a){return t=+t,n>>>=0,a||N(e,t,n,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,n,r,52,8),n+8}t.Buffer=s,t.SlowBuffer=function(e){return+e!=e&&(e=0),s.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=2147483647,s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,n){return(c(e),e<=0)?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(O(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),O(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,r=s.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(O(a,Uint8Array))i+a.length>r.length?s.from(a).copy(r,i):Uint8Array.prototype.set.call(r,a,i);else if(s.isBuffer(a))a.copy(r,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=a.length}return r},s.byteLength=d,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):m.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(s.prototype[a]=s.prototype.inspect),s.prototype.compare=function(e,t,n,r,i){if(O(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var a=i-r,o=n-t,u=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),h=0;h<u;++h)if(c[h]!==l[h]){a=c[h],o=l[h];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,a,o,s,u,c,l,h,p=this.length-t;if((void 0===n||n>p)&&(n=p),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var f=!1;;)switch(r){case"hex":return function(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(s!=s)break;e[n+o]=s}return o}(this,e,t,n);case"utf8":case"utf-8":return i=t,a=n,S(M(e,this.length-i),this,i,a);case"ascii":case"latin1":case"binary":return o=t,s=n,S(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,o,s);case"base64":return u=t,c=n,S(R(e),this,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l=t,h=n,S(function(e,t){for(var n,r,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i.push(n%256),i.push(r);return i}(e,this.length-l),this,l,h);default:if(f)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),f=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,s.prototype),r},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},s.prototype.readInt8=function(e,t){return(e>>>=0,t||E(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),i.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),i.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;T(this,e,t,n,i,0)}var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=e/a&255;return t+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;T(this,e,t,n,i,0)}var a=n-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);T(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);T(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,n){return C(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return C(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return w(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return w(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){var i,a=e.charCodeAt(0);("utf8"===r&&a<128||"latin1"===r)&&(e=a)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=s.isBuffer(e)?e:s.from(e,r),u=o.length;if(0===u)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%u]}return this};var A=/[^+/0-9A-Za-z-_]/g;function M(e,t){t=t||1/0;for(var n,r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319||o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return a}function R(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(A,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function S(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function O(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var x=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var r=16*n,i=0;i<16;++i)t[r+i]=e[n]+e[i];return t}()},1227:function(e,t,n){let r;var i=n(3454);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))}),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG),e},t.useColors=function(){return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(r=!1,()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(2447)(t);let{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},2447:function(e,t,n){e.exports=function(e){function t(e){let n,i,a;let o=null;function s(...e){if(!s.enabled)return;let r=s,i=Number(new Date),a=i-(n||i);r.diff=a,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return"%";o++;let a=t.formatters[i];if("function"==typeof a){let t=e[o];n=a.call(r,t),e.splice(o,1),o--}return n}),t.formatArgs.call(r,e);let u=r.log||t.log;u.apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,a=t.enabled(e)),a),set:e=>{o=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,n){let r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names.map(i),...t.skips.map(i).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];let r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.slice(1)+"$")):t.names.push(RegExp("^"+e+"$")))},t.enabled=function(e){let n,r;if("*"===e[e.length-1])return!0;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(7824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t)|0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},645:function(e,t){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,p=n?-1:1,f=e[t+h];for(h+=p,a=f&(1<<-l)-1,f>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=p,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=p,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:(f?-1:1)*(1/0);o+=Math.pow(2,r),a-=c}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,h=l>>1,p=23===i?5960464477539062e-23:0,f=r?0:a-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+h>=1?t+=p/u:t+=p*Math.pow(2,1-h),t*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+f]=255&o,f+=d,o/=256,c-=8);e[n+f-d]|=128*m}},5717:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},5822:function(e,t,n){!function(e){"use strict";//! moment.js locale configuration
var t=[/^led/i,/^úno/i,/^bře/i,/^dub/i,/^kvě/i,/^(čvn|červen$|června)/i,/^(čvc|červenec|července)/i,/^srp/i,/^zář/i,/^říj/i,/^lis/i,/^pro/i],n=/^(leden|únor|březen|duben|květen|červenec|července|červen|června|srpen|září|říjen|listopad|prosinec|led|úno|bře|dub|kvě|čvn|čvc|srp|zář|říj|lis|pro)/i;function r(e){return e>1&&e<5&&1!=~~(e/10)}function i(e,t,n,i){var a=e+" ";switch(n){case"s":return t||i?"p\xe1r sekund":"p\xe1r sekundami";case"ss":if(t||i)return a+(r(e)?"sekundy":"sekund");return a+"sekundami";case"m":return t?"minuta":i?"minutu":"minutou";case"mm":if(t||i)return a+(r(e)?"minuty":"minut");return a+"minutami";case"h":return t?"hodina":i?"hodinu":"hodinou";case"hh":if(t||i)return a+(r(e)?"hodiny":"hodin");return a+"hodinami";case"d":return t||i?"den":"dnem";case"dd":if(t||i)return a+(r(e)?"dny":"dn\xed");return a+"dny";case"M":return t||i?"měs\xedc":"měs\xedcem";case"MM":if(t||i)return a+(r(e)?"měs\xedce":"měs\xedců");return a+"měs\xedci";case"y":return t||i?"rok":"rokem";case"yy":if(t||i)return a+(r(e)?"roky":"let");return a+"lety"}}e.defineLocale("cs",{months:{format:"leden_\xfanor_březen_duben_květen_červen_červenec_srpen_z\xe1ř\xed_ř\xedjen_listopad_prosinec".split("_"),standalone:"ledna_\xfanora_března_dubna_května_června_července_srpna_z\xe1ř\xed_ř\xedjna_listopadu_prosince".split("_")},monthsShort:"led_\xfano_bře_dub_kvě_čvn_čvc_srp_z\xe1ř_ř\xedj_lis_pro".split("_"),monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(leden|ledna|února|únor|březen|března|duben|dubna|květen|května|červenec|července|červen|června|srpen|srpna|září|říjen|října|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|úno|bře|dub|kvě|čvn|čvc|srp|zář|říj|lis|pro)/i,monthsParse:t,longMonthsParse:t,shortMonthsParse:t,weekdays:"neděle_ponděl\xed_\xfater\xfd_středa_čtvrtek_p\xe1tek_sobota".split("_"),weekdaysShort:"ne_po_\xfat_st_čt_p\xe1_so".split("_"),weekdaysMin:"ne_po_\xfat_st_čt_p\xe1_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[z\xedtra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v neděli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve středu v] LT";case 4:return"[ve čtvrtek v] LT";case 5:return"[v p\xe1tek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[včera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou neděli v] LT";case 1:case 2:return"[minul\xe9] dddd [v] LT";case 3:return"[minulou středu v] LT";case 4:case 5:return"[minul\xfd] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"před %s",s:i,ss:i,m:i,mm:i,h:i,hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(n(381))},7824:function(e){function t(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}e.exports=function(e,n){n=n||{};var r,i,a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return 864e5*n;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*n;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===a&&isFinite(e))return n.long?(r=Math.abs(e))>=864e5?t(e,r,864e5,"day"):r>=36e5?t(e,r,36e5,"hour"):r>=6e4?t(e,r,6e4,"minute"):r>=1e3?t(e,r,1e3,"second"):e+" ms":(i=Math.abs(e))>=864e5?Math.round(e/864e5)+"d":i>=36e5?Math.round(e/36e5)+"h":i>=6e4?Math.round(e/6e4)+"m":i>=1e3?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3454:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(7663)},7663:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u=[],c=!1,l=-1;function h(){c&&r&&(c=!1,r.length?u=r.concat(u):l=-1,u.length&&p())}function p(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(r=u,u=[];++l<t;)r&&r[l].run();l=-1,t=u.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function d(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||c||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}},o=!0;try{t[e](a,a.exports,r),o=!1}finally{o&&delete n[e]}return a.exports}r.ab="//";var i=r(229);e.exports=i}()},8660:function(e,t,n){var r,i,a=n(3454);r=i||(i={}),function(e){var t="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=a(r);function a(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===t.Reflect?t.Reflect=r:i=a(t.Reflect,i),e(i)}(function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,s=({__proto__:[]})instanceof Array,u=!o&&!s,c={create:o?function(){return x(Object.create(null))}:s?function(){return x({__proto__:null})}:function(){return x({})},has:u?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:u?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),h="object"==typeof a&&a.env&&"true"===a.env.REFLECT_METADATA_USE_MAP_POLYFILL,p=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,a)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function a(e,t){return t}function o(e,t){return[e,t]}}():Map,f=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new p}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(h||"function"!=typeof WeakMap?function(){var e=c.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do t="@@WeakMap@@"+function(){var e="function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(16)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(16)):a(new Uint8Array(16),16):a(Array(16),16);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var t="",n=0;n<16;++n){var r=e[n];(4===n||6===n||8===n)&&(t+="-"),r<16&&(t+="0"),t+=r.toString(16).toLowerCase()}return t}();while(c.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:c.create()})}return e[n]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}}():WeakMap);function m(e,t,n){var r=d.get(e);if(T(r)){if(!n)return;r=new p,d.set(e,r)}var i=r.get(t);if(T(i)){if(!n)return;i=new p,r.set(t,i)}return i}function y(e,t,n){var r=m(t,n,!1);return!T(r)&&!!r.has(e)}function v(e,t,n){var r=m(t,n,!1);if(!T(r))return r.get(e)}function g(e,t,n,r){m(n,r,!0).set(e,t)}function b(e,t){var n=[],r=m(e,t,!1);if(T(r))return n;for(var a=function(e){var t=S(e,i);if(!M(t))throw TypeError();var n=t.call(e);if(!C(n))throw TypeError();return n}(r.keys()),o=0;;){var s=function(e){var t=e.next();return!t.done&&t}(a);if(!s)return n.length=o,n;var u=s.value;try{n[o]=u}catch(e){try{(function(e){var t=e.return;t&&t.call(e)})(a)}finally{throw e}}o++}}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function T(e){return void 0===e}function N(e){return null===e}function C(e){return"object"==typeof e?null!==e:"function"==typeof e}function w(e){var t=function(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=S(e,r);if(void 0!==i){var a=i.call(e,n);if(C(a))throw TypeError();return a}return function(e,t){if("string"===t){var n=e.toString;if(M(n)){var r=n.call(e);if(!C(r))return r}var i=e.valueOf;if(M(i)){var r=i.call(e);if(!C(r))return r}}else{var i=e.valueOf;if(M(i)){var r=i.call(e);if(!C(r))return r}var a=e.toString;if(M(a)){var r=a.call(e);if(!C(r))return r}}throw TypeError()}(e,"default"===n?"number":n)}(e,3);return"symbol"==typeof t?t:""+t}function A(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function M(e){return"function"==typeof e}function R(e){return"function"==typeof e}function S(e,t){var n=e[t];if(null!=n){if(!M(n))throw TypeError();return n}}function O(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l||t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function x(e){return e.__=void 0,delete e.__,e}e("decorate",function(e,t,n,r){if(T(n)){if(!A(e)||!R(t))throw TypeError();return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!T(r)&&!N(r)){if(!R(r))throw TypeError();t=r}}return t}(e,t)}if(!A(e)||!C(t)||!C(r)&&!T(r)&&!N(r))throw TypeError();return N(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!T(a)&&!N(a)){if(!C(a))throw TypeError();r=a}}return r}(e,t,n=w(n),r)}),e("metadata",function(e,t){return function(n,r){if(!C(n)||!T(r)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(r))throw TypeError();g(e,t,n,r)}}),e("defineMetadata",function(e,t,n,r){if(!C(n))throw TypeError();return T(r)||(r=w(r)),g(e,t,n,r)}),e("hasMetadata",function(e,t,n){if(!C(t))throw TypeError();return T(n)||(n=w(n)),function e(t,n,r){if(y(t,n,r))return!0;var i=O(n);return!N(i)&&e(t,i,r)}(e,t,n)}),e("hasOwnMetadata",function(e,t,n){if(!C(t))throw TypeError();return T(n)||(n=w(n)),y(e,t,n)}),e("getMetadata",function(e,t,n){if(!C(t))throw TypeError();return T(n)||(n=w(n)),function e(t,n,r){if(y(t,n,r))return v(t,n,r);var i=O(n);if(!N(i))return e(t,i,r)}(e,t,n)}),e("getOwnMetadata",function(e,t,n){if(!C(t))throw TypeError();return T(n)||(n=w(n)),v(e,t,n)}),e("getMetadataKeys",function(e,t){if(!C(e))throw TypeError();return T(t)||(t=w(t)),function e(t,n){var r=b(t,n),i=O(t);if(null===i)return r;var a=e(i,n);if(a.length<=0)return r;if(r.length<=0)return a;for(var o=new f,s=[],u=0;u<r.length;u++){var c=r[u],l=o.has(c);l||(o.add(c),s.push(c))}for(var h=0;h<a.length;h++){var c=a[h],l=o.has(c);l||(o.add(c),s.push(c))}return s}(e,t)}),e("getOwnMetadataKeys",function(e,t){if(!C(e))throw TypeError();return T(t)||(t=w(t)),b(e,t)}),e("deleteMetadata",function(e,t,n){if(!C(t))throw TypeError();T(n)||(n=w(n));var r=m(t,n,!1);if(T(r)||!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||(d.delete(t),!0)})})},9509:function(e,t,n){var r=n(8764),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},4189:function(e,t,n){var r=n(9509).Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var n=this._block,i=this._blockSize,a=e.length,o=this._len,s=0;s<a;){for(var u=o%i,c=Math.min(a-s,i-u),l=0;l<c;l++)n[u+l]=e[s+l];o+=c,s+=c,o%i==0&&this._update(n)}return this._len+=a,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0;this._block.writeUInt32BE((n-r)/4294967296,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var i=this._hash();return e?i.toString(e):i},i.prototype._update=function(){throw Error("_update must be implemented by subclass")},e.exports=i},9072:function(e,t,n){var r=e.exports=function(e){var t=r[e=e.toLowerCase()];if(!t)throw Error(e+" is not supported (we accept pull requests)");return new t};r.sha=n(2349),r.sha1=n(8336),r.sha224=n(8432),r.sha256=n(7499),r.sha384=n(1686),r.sha512=n(7816)},2349:function(e,t,n){var r=n(5717),i=n(4189),a=n(9509).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,i=0|this._c,a=0|this._d,s=0|this._e,u=0;u<16;++u)t[u]=e.readInt32BE(4*u);for(;u<80;++u)t[u]=t[u-3]^t[u-8]^t[u-14]^t[u-16];for(var c=0;c<80;++c){var l,h,p,f,d,m=~~(c/20),y=((l=n)<<5|l>>>27)+(h=r,p=i,f=a,0===m?h&p|~h&f:2===m?h&p|h&f|p&f:h^p^f)+s+t[c]+o[m]|0;s=a,a=i,i=(d=r)<<30|d>>>2,r=n,n=y}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=a+this._d|0,this._e=s+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},8336:function(e,t,n){var r=n(5717),i=n(4189),a=n(9509).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,i=0|this._c,a=0|this._d,s=0|this._e,u=0;u<16;++u)t[u]=e.readInt32BE(4*u);for(;u<80;++u)t[u]=(l=t[u-3]^t[u-8]^t[u-14]^t[u-16])<<1|l>>>31;for(var c=0;c<80;++c){var l,h,p,f,d,m,y=~~(c/20),v=((h=n)<<5|h>>>27)+(p=r,f=i,d=a,0===y?p&f|~p&d:2===y?p&f|p&d|f&d:p^f^d)+s+t[c]+o[y]|0;s=a,a=i,i=(m=r)<<30|m>>>2,r=n,n=v}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=a+this._d|0,this._e=s+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},8432:function(e,t,n){var r=n(5717),i=n(7499),a=n(4189),o=n(9509).Buffer,s=Array(64);function u(){this.init(),this._w=s,a.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=u},7499:function(e,t,n){var r=n(5717),i=n(4189),a=n(9509).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=Array(64);function u(){this.init(),this._w=s,i.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,i=0|this._c,a=0|this._d,s=0|this._e,u=0|this._f,c=0|this._g,l=0|this._h,h=0;h<16;++h)t[h]=e.readInt32BE(4*h);for(;h<64;++h)t[h]=(((f=t[h-2])>>>17|f<<15)^(f>>>19|f<<13)^f>>>10)+t[h-7]+(((d=t[h-15])>>>7|d<<25)^(d>>>18|d<<14)^d>>>3)+t[h-16]|0;for(var p=0;p<64;++p){var f,d,m,y,v,g,b,E,T,N=l+(((m=s)>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(y=s,v=u,(g=c)^y&(v^g))+o[p]+t[p]|0,C=(((b=n)>>>2|b<<30)^(b>>>13|b<<19)^(b>>>22|b<<10))+((E=n)&(T=r)|i&(E|T))|0;l=c,c=u,u=s,s=a+N|0,a=i,i=r,r=n,n=N+C|0}this._a=n+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=a+this._d|0,this._e=s+this._e|0,this._f=u+this._f|0,this._g=c+this._g|0,this._h=l+this._h|0},u.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=u},1686:function(e,t,n){var r=n(5717),i=n(7816),a=n(4189),o=n(9509).Buffer,s=Array(160);function u(){this.init(),this._w=s,a.call(this,128,112)}r(u,i),u.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=u},7816:function(e,t,n){var r=n(5717),i=n(4189),a=n(9509).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=Array(160);function u(){this.init(),this._w=s,i.call(this,128,112)}function c(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function l(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function h(e,t){return e>>>0<t>>>0?1:0}r(u,i),u.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,i=0|this._ch,a=0|this._dh,s=0|this._eh,u=0|this._fh,p=0|this._gh,f=0|this._hh,d=0|this._al,m=0|this._bl,y=0|this._cl,v=0|this._dl,g=0|this._el,b=0|this._fl,E=0|this._gl,T=0|this._hl,N=0;N<32;N+=2)t[N]=e.readInt32BE(4*N),t[N+1]=e.readInt32BE(4*N+4);for(;N<160;N+=2){var C,w,A,M,R,S,O,x,P=t[N-30],I=t[N-30+1],D=((C=P)>>>1|(w=I)<<31)^(C>>>8|w<<24)^C>>>7,q=((A=I)>>>1|(M=P)<<31)^(A>>>8|M<<24)^(A>>>7|M<<25);P=t[N-4],I=t[N-4+1];var _=((R=P)>>>19|(S=I)<<13)^(S>>>29|R<<3)^R>>>6,j=((O=I)>>>19|(x=P)<<13)^(x>>>29|O<<3)^(O>>>6|x<<26),L=t[N-14],B=t[N-14+1],U=t[N-32],F=t[N-32+1],J=q+B|0,k=D+L+h(J,q)|0;k=(k=k+_+h(J=J+j|0,j)|0)+U+h(J=J+F|0,F)|0,t[N]=k,t[N+1]=J}for(var G=0;G<160;G+=2){k=t[G],J=t[G+1];var V,Q,K,z,W,Y,H,Z,X,$,ee=(V=n)&(Q=r)|i&(V|Q),et=(K=d)&(z=m)|y&(K|z),en=c(n,d),er=c(d,n),ei=l(s,g),ea=l(g,s),eo=o[G],es=o[G+1],eu=(W=s,Y=u,(H=p)^W&(Y^H)),ec=(Z=g,X=b,($=E)^Z&(X^$)),el=T+ea|0,eh=f+ei+h(el,T)|0;eh=(eh=(eh=eh+eu+h(el=el+ec|0,ec)|0)+eo+h(el=el+es|0,es)|0)+k+h(el=el+J|0,J)|0;var ep=er+et|0,ef=en+ee+h(ep,er)|0;f=p,T=E,p=u,E=b,u=s,b=g,s=a+eh+h(g=v+el|0,v)|0,a=i,v=y,i=r,y=m,r=n,m=d,n=eh+ef+h(d=el+ep|0,el)|0}this._al=this._al+d|0,this._bl=this._bl+m|0,this._cl=this._cl+y|0,this._dl=this._dl+v|0,this._el=this._el+g|0,this._fl=this._fl+b|0,this._gl=this._gl+E|0,this._hl=this._hl+T|0,this._ah=this._ah+n+h(this._al,d)|0,this._bh=this._bh+r+h(this._bl,m)|0,this._ch=this._ch+i+h(this._cl,y)|0,this._dh=this._dh+a+h(this._dl,v)|0,this._eh=this._eh+s+h(this._el,g)|0,this._fh=this._fh+u+h(this._fl,b)|0,this._gh=this._gh+p+h(this._gl,E)|0,this._hh=this._hh+f+h(this._hl,T)|0},u.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=u},655:function(e,t,n){"use strict";n.d(t,{gn:function(){return r}});function r(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}},7677:function(e,t,n){"use strict";n.d(t,{z:function(){return a}});var r=n(274),i=n(5022),a=function(){function e(){}return e.buildDriverOptions=function(e,t){var n,i;if(e.url){var a=this.parseConnectionUrl(e.url);t&&t.useSid&&a.database&&(a.sid=a.database);try{for(var o=(0,r.XA)(Object.keys(a)),s=o.next();!s.done;s=o.next()){var u=s.value;void 0===a[u]&&delete a[u]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return Object.assign({},e,a)}return Object.assign({},e)},e.buildColumnAlias=function(e,t,n){var r=e.maxAliasLength,a=t+"_"+n;return r&&r>0&&a.length>r?(0,i.vp)(a,{length:r}):a},e.parseConnectionUrl=function(e){var t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),a=i.indexOf("/"),o=-1!==a?i.substr(0,a):i,s=-1!==a?i.substr(a+1):void 0;s&&-1!==s.indexOf("?")&&(s=s.substr(0,s.indexOf("?")));var u=o.lastIndexOf("@"),c=o.substr(0,u),l=o.substr(u+1),h=c,p="",f=c.indexOf(":");-1!==f&&(h=c.substr(0,f),p=c.substr(f+1));var d=(0,r.CR)(l.split(":"),2),m=d[0],y=d[1];return{type:t,host:m,username:decodeURIComponent(h),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}},e}()},3298:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});var r=function(e,t){this.query=e,this.parameters=t}},1429:function(e,t,n){"use strict";n.d(t,{X:function(){return O}});var r=n(274),i=n(8198),a=n(6908),o=n(8956),s=n(6556),u=n(124),c=n(5838),l=n(9396),h=n(9652),p=n(5128),f=n(2611),d=n(3298),m=n(7316),y=n(1959),v=n(4894),g=n(3003),b=n(5738),E=n(879),T=n(1444),N=function(e){function t(t,n){var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new v.a(r),r.mode=n,r}return(0,r.ZT)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection})),this.databaseConnectionPromise)},t.prototype.release=function(){var e=this;return new Promise(function(t,n){e.isReleased=!0,e.databaseConnection?e.databaseConnection.close(function(e){if(e)return n(e);t()}):t()})},t.prototype.startTransaction=function(e){return void 0===e&&(e="READ COMMITTED"),(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new p.Y;if(this.isTransactionActive)throw new o.S;if("SERIALIZABLE"!==e&&"READ COMMITTED"!==e)throw Error("Oracle only supports SERIALIZABLE and READ COMMITTED isolation");if(t=new T.D,this.broadcaster.broadcastBeforeTransactionStartEvent(t),!(t.promises.length>0))return[3,2];return[4,Promise.all(t.promises)];case 1:r.sent(),r.label=2;case 2:return[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)];case 3:if(r.sent(),this.isTransactionActive=!0,n=new T.D,this.broadcaster.broadcastAfterTransactionStartEvent(n),!(n.promises.length>0))return[3,5];return[4,Promise.all(n.promises)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new s.W;if(e=new T.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:if(n.sent(),this.isTransactionActive=!1,t=new T.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new s.W;if(e=new T.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:if(n.sent(),this.isTransactionActive=!1,t=new T.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new p.Y;return new Promise(function(i,a){return(0,r.mG)(n,void 0,void 0,function(){var n,o,s,u=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),n=+new Date,o=function(r,o){var s=u.driver.connection.options.maxQueryExecutionTime,c=+new Date-n;if(s&&c>s&&u.driver.connection.logger.logQuerySlow(c,e,t,u),r)return u.driver.connection.logger.logQueryError(r,e,t,u),a(new m.O(e,t,r));i(o.rows||o.outBinds||o.rowsAffected)},s={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return r.sent().execute(e,t||{},s,o),[3,3];case 2:return a(r.sent()),[3,3];case 3:return[2]}})})})},t.prototype.stream=function(e,t,n,r){throw Error("Stream is not supported by Oracle driver.")},t.prototype.getDatabases=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve(!1)]})})},t.prototype.hasTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t='SELECT "TABLE_NAME" FROM "USER_TABLES" WHERE "TABLE_NAME" = \''+(e instanceof c.i?e.name:e)+"'",[4,this.query(t)];case 1:return[2,!!n.sent().length]}})})},t.prototype.hasColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n='SELECT "COLUMN_NAME" FROM "USER_TAB_COLS" WHERE "TABLE_NAME" = \''+(e instanceof c.i?e.name:e)+"' AND \"COLUMN_NAME\" = '"+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.query('CREATE DATABASE IF NOT EXISTS "'+e+'"')];case 1:return t.sent(),[2]}})})},t.prototype.dropDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Schema create queries are not supported by Oracle driver.")})})},t.prototype.dropSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Schema drop queries are not supported by Oracle driver.")})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,function(){var a,o,s=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,2];return[4,this.hasTable(e)];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,function(){var a,o,s,u,l,h=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,2];return[4,this.hasTable(e)];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:if(a=n,!(e instanceof c.i))return[3,3];return s=e,[3,5];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],l=[],i&&o.indices.forEach(function(e){u.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return u.push(h.dropForeignKeySql(o,e))}),u.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(u,l)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return t=e instanceof f.G?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,p=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(n=[],i=[],!(e instanceof c.i))return[3,1];return o=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),t instanceof c.i?s=t:s.name=t,n.push(new d.A('ALTER TABLE "'+a.name+'" RENAME TO "'+s.name+'"')),i.push(new d.A('ALTER TABLE "'+s.name+'" RENAME TO "'+a.name+'"')),s.primaryColumns.length>0&&(u=s.primaryColumns.map(function(e){return e.name}),l=this.connection.namingStrategy.primaryKeyName(a,u),h=this.connection.namingStrategy.primaryKeyName(s,u),n.push(new d.A('ALTER TABLE "'+s.name+'" RENAME CONSTRAINT "'+l+'" TO "'+h+'"')),i.push(new d.A('ALTER TABLE "'+s.name+'" RENAME CONSTRAINT "'+h+'" TO "'+l+'"'))),s.uniques.forEach(function(e){var t=p.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);n.push(new d.A('ALTER TABLE "'+s.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new d.A('ALTER TABLE "'+s.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t}),s.indices.forEach(function(e){var t=p.connection.namingStrategy.indexName(s,e.columnNames,e.where);n.push(new d.A('ALTER INDEX "'+e.name+'" RENAME TO "'+t+'"')),i.push(new d.A('ALTER INDEX "'+t+'" RENAME TO "'+e.name+'"')),e.name=t}),s.foreignKeys.forEach(function(e){var t=p.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new d.A('ALTER TABLE "'+s.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new d.A('ALTER TABLE "'+s.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t}),[4,this.executeQueries(n,i)];case 4:return r.sent(),a.name=s.name,this.replaceCachedTable(a,s),[2]}})})},t.prototype.addColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,p,f,m,v;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),s=[],(o=[]).push(new d.A('ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(t))),s.push(new d.A('ALTER TABLE "'+n.name+'" DROP COLUMN "'+t.name+'"')),t.isPrimary&&((u=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,u.map(function(e){return e.name})),h=u.map(function(e){return'"'+e.name+'"'}).join(", "),o.push(new d.A('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+l+'"')),s.push(new d.A('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")"))),u.push(t),p=this.connection.namingStrategy.primaryKeyName(a.name,u.map(function(e){return e.name})),f=u.map(function(e){return'"'+e.name+'"'}).join(", "),o.push(new d.A('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+f+")")),s.push(new d.A('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+p+'"'))),(m=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(a.indices.splice(a.indices.indexOf(m),1),o.push(this.createIndexSql(n,m)),s.push(this.dropIndexSql(m))),t.isUnique&&(v=new y.v({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(v),o.push(new d.A('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+v.name+'" UNIQUE ("'+t.name+'")')),s.push(new d.A('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+v.name+'"'))),[4,this.executeQueries(o,s)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}})})},t.prototype.addColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),i=(n=(0,r.XA)(t)).next(),u.label=1;case 1:if(i.done)return[3,4];return a=i.value,[4,this.addColumn(e,a)];case 2:u.sent(),u.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o={error:u.sent()},[3,7];case 6:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return a=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof u.D?t:i.columns.find(function(e){return e.name===t})))throw Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return s=void 0,n instanceof u.D?s=n:(s=o.clone()).name=n,[4,this.changeColumn(i,o,s)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,o,s,l,h,p,f,m,v,g,b,E,T,N,C,w,A,M=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return a=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],l=[],!(h=t instanceof u.D?t:i.columns.find(function(e){return e.name===t})))throw Error('Column "'+t+'" was not found in the "'+i.name+'" table.');if(!(n.isGenerated!==h.isGenerated&&"uuid"!==n.generationStrategy||h.type!==n.type||h.length!==n.length))return[3,6];return[4,this.dropColumn(i,h)];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,8];case 6:return n.name!==h.name&&(s.push(new d.A('ALTER TABLE "'+i.name+'" RENAME COLUMN "'+h.name+'" TO "'+n.name+'"')),l.push(new d.A('ALTER TABLE "'+i.name+'" RENAME COLUMN "'+n.name+'" TO "'+h.name+'"')),!0===h.isPrimary&&(f=(p=o.primaryColumns).map(function(e){return e.name}),m=this.connection.namingStrategy.primaryKeyName(o,f),f.splice(f.indexOf(h.name),1),f.push(n.name),v=this.connection.namingStrategy.primaryKeyName(o,f),s.push(new d.A('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+m+'" TO "'+v+'"')),l.push(new d.A('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+v+'" TO "'+m+'"'))),o.findColumnUniques(h).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);s.push(new d.A('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),l.push(new d.A('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t}),o.findColumnIndices(h).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.indexName(o,e.columnNames,e.where);s.push(new d.A('ALTER INDEX "'+e.name+'" RENAME TO "'+t+'"')),l.push(new d.A('ALTER INDEX "'+t+'" RENAME TO "'+e.name+'"')),e.name=t}),o.findColumnForeignKeys(h).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(new d.A('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),l.push(new d.A('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t}),g=o.columns.find(function(e){return e.name===h.name}),o.columns[o.columns.indexOf(g)].name=n.name,h.name=n.name),this.isColumnChanged(h,n,!0)&&(b="",E="",T="",N="",null!==n.default&&void 0!==n.default?(b="DEFAULT "+n.default,E=null!==h.default&&void 0!==h.default?"DEFAULT "+h.default:"DEFAULT NULL"):null!==h.default&&void 0!==h.default&&(b="DEFAULT NULL",E="DEFAULT "+h.default),n.isNullable!==h.isNullable&&(!0===n.isNullable?(T="NULL",N="NOT NULL"):(T="NOT NULL",N="NULL")),s.push(new d.A('ALTER TABLE "'+i.name+'" MODIFY "'+h.name+'" '+this.connection.driver.createFullType(n)+" "+b+" "+T)),l.push(new d.A('ALTER TABLE "'+i.name+'" MODIFY "'+h.name+'" '+this.connection.driver.createFullType(h)+" "+E+" "+N))),n.isPrimary!==h.isPrimary&&((p=o.primaryColumns).length>0&&(C=this.connection.namingStrategy.primaryKeyName(o.name,p.map(function(e){return e.name})),f=p.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C+'"')),l.push(new d.A('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C+'" PRIMARY KEY ('+f+")"))),!0===n.isPrimary?(p.push(n),o.columns.find(function(e){return e.name===n.name}).isPrimary=!0,C=this.connection.namingStrategy.primaryKeyName(o.name,p.map(function(e){return e.name})),f=p.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C+'" PRIMARY KEY ('+f+")")),l.push(new d.A('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C+'"'))):(w=p.find(function(e){return e.name===n.name}),p.splice(p.indexOf(w),1),o.columns.find(function(e){return e.name===n.name}).isPrimary=!1,p.length>0&&(C=this.connection.namingStrategy.primaryKeyName(o.name,p.map(function(e){return e.name})),f=p.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C+'" PRIMARY KEY ('+f+")")),l.push(new d.A('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C+'"'))))),n.isUnique!==h.isUnique&&(!0===n.isUnique?(A=new y.v({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),o.uniques.push(A),s.push(new d.A('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+A.name+'" UNIQUE ("'+n.name+'")')),l.push(new d.A('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+A.name+'"'))):(A=o.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),o.uniques.splice(o.uniques.indexOf(A),1),s.push(new d.A('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+A.name+'"')),l.push(new d.A('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+A.name+'" UNIQUE ("'+n.name+'")')))),[4,this.executeQueries(s,l)];case 7:r.sent(),this.replaceCachedTable(i,o),r.label=8;case 8:return[2]}})})},t.prototype.changeColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c;return(0,r.Jh)(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,7]),i=(n=(0,r.XA)(t)).next(),l.label=1;case 1:if(i.done)return[3,4];return o=(a=i.value).oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)];case 2:l.sent(),l.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u={error:l.sent()},[3,7];case 6:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,l,h,p,f,m,y,v,g;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof u.D?t:n.findColumnByName(t)))throw Error('Column "'+t+'" was not found in table "'+n.name+'"');return o=n.clone(),s=[],l=[],a.isPrimary&&(h=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map(function(e){return e.name})),p=o.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+o.name+'" DROP CONSTRAINT "'+h+'"')),l.push(new d.A('ALTER TABLE "'+o.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")")),o.findColumnByName(a.name).isPrimary=!1,o.primaryColumns.length>0&&(f=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map(function(e){return e.name})),m=o.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+o.name+'" ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+m+")")),l.push(new d.A('ALTER TABLE "'+o.name+'" DROP CONSTRAINT "'+f+'"')))),(y=o.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(s.push(this.dropIndexSql(y)),l.push(this.createIndexSql(n,y))),(v=o.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.checks.splice(o.checks.indexOf(v),1),s.push(this.dropCheckConstraintSql(n,v)),l.push(this.createCheckConstraintSql(n,v))),(g=o.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.uniques.splice(o.uniques.indexOf(g),1),s.push(this.dropUniqueConstraintSql(n,g)),l.push(this.createUniqueConstraintSql(n,g))),s.push(new d.A('ALTER TABLE "'+n.name+'" DROP COLUMN "'+a.name+'"')),l.push(new d.A('ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(a))),[4,this.executeQueries(s,l)];case 4:return r.sent(),o.removeColumn(a),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),i=(n=(0,r.XA)(t)).next(),u.label=1;case 1:if(i.done)return[3,4];return a=i.value,[4,this.dropColumn(e,a)];case 2:u.sent(),u.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o={error:u.sent()},[3,7];case 6:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,p,f,m;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=t.map(function(e){return e.name}),o=n.clone(),s=[],u=[],(l=o.primaryColumns).length>0&&(h=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),p=l.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+h+'"')),u.push(new d.A('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")"))),o.columns.filter(function(e){return -1!==a.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),f=this.connection.namingStrategy.primaryKeyName(o.name,a),m=a.map(function(e){return'"'+e+'"'}).join(", "),s.push(new d.A('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+m+")")),u.push(new d.A('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+f+'"')),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropPrimaryKey=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return n=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createUniqueConstraint(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.v?t:n.uniques.find(function(e){return e.name===t})))throw Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropUniqueConstraintSql(n,a),s=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropUniqueConstraint(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createCheckConstraint(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof E.r?t:n.checks.find(function(e){return e.name===t})))throw Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropCheckConstraint(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Oracle does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Oracle does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Oracle does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Oracle does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createForeignKey(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.U?t:n.foreignKeys.find(function(e){return e.name===t})))throw Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropForeignKey(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createIndex(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof c.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof h.s?t:n.indices.find(function(e){return e.name===t})))throw Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropIndex(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t=this;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return[4,this.startTransaction()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,8,,13]),[4,this.query('SELECT \'DROP VIEW "\' || VIEW_NAME || \'"\' AS "query" FROM "USER_VIEWS"')];case 3:return[4,Promise.all(n.sent().map(function(e){return t.query(e.query)}))];case 4:return n.sent(),[4,this.query('SELECT \'DROP TABLE "\' || TABLE_NAME || \'" CASCADE CONSTRAINTS\' AS "query" FROM "USER_TABLES"')];case 5:return[4,Promise.all(n.sent().map(function(e){return t.query(e.query)}))];case 6:return n.sent(),[4,this.commitTransaction()];case 7:return n.sent(),[3,13];case 8:e=n.sent(),n.label=9;case 9:return n.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:case 11:return n.sent(),[3,12];case 12:throw e;case 13:return[2]}})})},t.prototype.loadViews=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:if(!r.sent())return[2,Promise.resolve([])];return t=e.map(function(e){return"'"+e+"'"}).join(", "),n='SELECT "T".* FROM "'+this.getTypeormMetadataTableName()+'" "T" INNER JOIN "USER_VIEWS" "V" ON "V"."VIEW_NAME" = "T"."name" WHERE "T"."type" = \'VIEW\'',t.length>0&&(n+=' AND "T"."name" IN ('+t+")"),[4,this.query(n)];case 2:return[2,r.sent().map(function(e){var t=new f.G;return t.name=e.name,t.expression=e.value,t})]}})})},t.prototype.loadTables=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,p,f,d,m,v,g,T=this;return(0,r.Jh)(this,function(N){switch(N.label){case 0:if(!e||!e.length)return[2,[]];return n='SELECT * FROM "USER_TABLES" WHERE "TABLE_NAME" IN ('+(t=e.map(function(e){return"'"+e+"'"}).join(", "))+")",i='SELECT * FROM "USER_TAB_COLS" WHERE "TABLE_NAME" IN ('+t+")",a='SELECT "IND"."INDEX_NAME", "IND"."TABLE_NAME", "IND"."UNIQUENESS", LISTAGG ("COL"."COLUMN_NAME", \',\') WITHIN GROUP (ORDER BY "COL"."COLUMN_NAME") AS "COLUMN_NAMES" FROM "USER_INDEXES" "IND" INNER JOIN "USER_IND_COLUMNS" "COL" ON "COL"."INDEX_NAME" = "IND"."INDEX_NAME" LEFT JOIN "USER_CONSTRAINTS" "CON" ON "CON"."CONSTRAINT_NAME" = "IND"."INDEX_NAME" WHERE "IND"."TABLE_NAME" IN ('+t+') AND "CON"."CONSTRAINT_NAME" IS NULL GROUP BY "IND"."INDEX_NAME", "IND"."TABLE_NAME", "IND"."UNIQUENESS"',o='SELECT "C"."CONSTRAINT_NAME", "C"."TABLE_NAME", "COL"."COLUMN_NAME", "REF_COL"."TABLE_NAME" AS "REFERENCED_TABLE_NAME", "REF_COL"."COLUMN_NAME" AS "REFERENCED_COLUMN_NAME", "C"."DELETE_RULE" AS "ON_DELETE" FROM "USER_CONSTRAINTS" "C" INNER JOIN "USER_CONS_COLUMNS" "COL" ON "COL"."OWNER" = "C"."OWNER" AND "COL"."CONSTRAINT_NAME" = "C"."CONSTRAINT_NAME" INNER JOIN "USER_CONS_COLUMNS" "REF_COL" ON "REF_COL"."OWNER" = "C"."R_OWNER" AND "REF_COL"."CONSTRAINT_NAME" = "C"."R_CONSTRAINT_NAME" AND "REF_COL"."POSITION" = "COL"."POSITION" WHERE "C"."TABLE_NAME" IN ('+t+') AND "C"."CONSTRAINT_TYPE" = \'R\'',s='SELECT "C"."CONSTRAINT_NAME", "C"."CONSTRAINT_TYPE", "C"."TABLE_NAME", "COL"."COLUMN_NAME", "C"."SEARCH_CONDITION" FROM "USER_CONSTRAINTS" "C" INNER JOIN "USER_CONS_COLUMNS" "COL" ON "COL"."OWNER" = "C"."OWNER" AND "COL"."CONSTRAINT_NAME" = "C"."CONSTRAINT_NAME" WHERE "C"."TABLE_NAME" IN ('+t+") AND \"C\".\"CONSTRAINT_TYPE\" IN ('C', 'U', 'P') AND \"C\".\"GENERATED\" = 'USER NAME'",[4,Promise.all([this.query(n),this.query(i),this.query(a),this.query(o),this.query(s)])];case 1:if(f=(p=r.CR.apply(void 0,[N.sent(),5]))[0],d=p[1],m=p[2],v=p[3],g=p[4],!f.length)return[2,[]];return[2,f.map(function(e){var t=new c.i;t.name=e.TABLE_NAME,t.columns=d.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=g.filter(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),r=n.find(function(e){return"U"===e.CONSTRAINT_TYPE}),i=!!r&&!!g.find(function(t){return"U"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===r.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),a=!!n.find(function(e){return"P"===e.CONSTRAINT_TYPE}),o=new u.D;if(o.name=e.COLUMN_NAME,o.type=e.DATA_TYPE.toLowerCase(),-1!==o.type.indexOf("(")&&(o.type=o.type.replace(/\([0-9]*\)/,"")),-1!==T.driver.withLengthColumnTypes.indexOf(o.type)){var s="raw"===o.type?e.DATA_LENGTH:e.CHAR_COL_DECL_LENGTH;o.length=s&&!T.isDefaultColumnLength(t,o,s)?s.toString():""}return"number"===o.type||"float"===o.type?(null===e.DATA_PRECISION||T.isDefaultColumnPrecision(t,o,e.DATA_PRECISION)||(o.precision=e.DATA_PRECISION),null===e.DATA_SCALE||T.isDefaultColumnScale(t,o,e.DATA_SCALE)||(o.scale=e.DATA_SCALE)):("timestamp"===o.type||"timestamp with time zone"===o.type||"timestamp with local time zone"===o.type)&&null!==e.DATA_SCALE&&(o.precision=T.isDefaultColumnPrecision(t,o,e.DATA_SCALE)?void 0:e.DATA_SCALE),o.default=null!==e.DATA_DEFAULT&&void 0!==e.DATA_DEFAULT&&"NULL"!==e.DATA_DEFAULT.trim()?o.default=e.DATA_DEFAULT.trim():void 0,o.isNullable="Y"===e.NULLABLE,o.isUnique=!!r&&!i,o.isPrimary=a,o.isGenerated="YES"===e.IDENTITY_COLUMN,o.isGenerated&&(o.generationStrategy="increment",o.default=void 0),o.comment="",o});var n=b.s.uniq(g.filter(function(e){return e.TABLE_NAME===t.name&&"U"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME});t.uniques=n.map(function(e){var t=g.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new y.v({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME})})});var r=b.s.uniq(g.filter(function(e){return e.TABLE_NAME===t.name&&"C"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME});t.checks=r.map(function(e){var t=g.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new E.r({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.SEARCH_CONDITION})});var i=b.s.uniq(v.filter(function(e){return e.TABLE_NAME===t.name}),function(e){return e.CONSTRAINT_NAME});return t.foreignKeys=i.map(function(e){var t=v.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new l.U({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:e.REFERENCED_TABLE_NAME,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:e.ON_DELETE,onUpdate:"NO ACTION"})}),t.indices=m.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new h.s({name:e.INDEX_NAME,columnNames:e.COLUMN_NAMES.split(","),isUnique:"UNIQUE"===e.UNIQUENESS})}),t})]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(e){return n.buildCreateColumnSql(e)}).join(", "),i='CREATE TABLE "'+e.name+'" ('+r;e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new y.v({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),e.uniques.length>0&&(i+=", "+e.uniques.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map(function(e){return'"'+e+'"'}).join(", ")+")"}).join(", ")),e.checks.length>0&&(i+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", ")),e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&"NO ACTION"!==t.onDelete&&(a+=" ON DELETE "+t.onDelete),a}).join(", "));var a=e.columns.filter(function(e){return e.isPrimary});return a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'" PRIMARY KEY ('+a.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),i+=")",new d.A(i)},t.prototype.dropTableSql=function(e,t){var n=e instanceof c.i?e.name:e;return new d.A(t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"')},t.prototype.createViewSql=function(e){var t=e.materialized?"MATERIALIZED ":"";return new d.A("string"==typeof e.expression?"CREATE "+t+'VIEW "'+e.name+'" AS '+e.expression:"CREATE "+t+'VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=(0,r.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new d.A(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof f.G?e.name:e;return new d.A('DROP VIEW "'+t+'"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof f.G?e.name:e,n=this.connection.createQueryBuilder(),i=(0,r.CR)(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape("type")+" = 'VIEW'").andWhere(n.escape("name")+" = :name",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new d.A(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return new d.A("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+")")},t.prototype.dropIndexSql=function(e){var t=e instanceof h.s?e.name:e;return new d.A('DROP INDEX "'+t+'"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'"'+e+'"'}).join(", ");return new d.A('ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new d.A('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return new d.A('ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof y.v?t.name:t;return new d.A('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new d.A('ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof E.r?t.name:t;return new d.A('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i='ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") "+('REFERENCES "'+t.referencedTableName)+'" ('+r+")";return t.onDelete&&"NO ACTION"!==t.onDelete&&(i+=" ON DELETE "+t.onDelete),new d.A(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof l.U?t.name:t;return new d.A('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(t+=" GENERATED BY DEFAULT AS IDENTITY"),t},t}(g.Y),C=n(8893),w=n(418),A=n(1014),M=n(7677),R=n(8535),S=n(8764).Buffer,O=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["char","nchar","nvarchar2","varchar2","long","raw","long raw","number","numeric","float","dec","decimal","integer","int","smallint","real","double precision","date","timestamp","timestamp with time zone","timestamp with local time zone","interval year to month","interval day to second","bfile","blob","clob","nclob","rowid","urowid"],this.spatialTypes=[],this.withLengthColumnTypes=["char","nchar","nvarchar2","varchar2","varchar","raw"],this.withPrecisionColumnTypes=["number","float","timestamp","timestamp with time zone","timestamp with local time zone"],this.withScaleColumnTypes=["number"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"timestamp",updateDateDefault:"CURRENT_TIMESTAMP",deleteDate:"timestamp",deleteDateNullable:!0,version:"number",treeLevel:"number",migrationId:"number",migrationName:"varchar2",migrationTimestamp:"number",cacheId:"number",cacheIdentifier:"varchar2",cacheTime:"number",cacheDuration:"number",cacheQuery:"clob",cacheResult:"clob",metadataType:"varchar2",metadataDatabase:"varchar2",metadataSchema:"varchar2",metadataTable:"varchar2",metadataName:"varchar2",metadataValue:"clob"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},varchar2:{length:255},nvarchar2:{length:255},raw:{length:2e3},float:{precision:126},timestamp:{precision:6},"timestamp with time zone":{precision:6},"timestamp with local time zone":{precision:6}},this.maxAliasLength=30,this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(this.oracle.fetchAsString=[this.oracle.CLOB],this.oracle.fetchAsBuffer=[this.oracle.BLOB],!this.options.replication)return[3,3];return e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e=this;return(0,r.Jh)(this,function(t){switch(t.label){case 0:if(!this.master)return[2,Promise.reject(new i.y("oracle"))];return[4,this.closePool(this.master)];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new A.n(this.connection)},e.prototype.createQueryRunner=function(e){return new N(this,e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return"boolean"==typeof n[e]?n[e]?1:0:n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(RegExp(i,"g"),function(e){var n,i=!1;return(":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i)?n.map(function(t,n){return r.push(t),":"+e.substr(4)+n}).join(", "):n instanceof Function?n():"boolean"==typeof n?n?1:0:(r.push(n),e)}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){return e},e.prototype.preparePersistentValue=function(e,t){return(t.transformer&&(e=R.A.transformTo(t.transformer,e)),null==e)?e:t.type===Boolean?e?1:0:"date"===t.type?("string"==typeof e&&(e=e.replace(/[^0-9-]/g,"")),function(){return"TO_DATE('"+C.E.mixedDateToDateString(e)+"', 'YYYY-MM-DD')"}):t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp with local time zone"===t.type?C.E.mixedDateToDate(e):"simple-array"===t.type?C.E.simpleArrayToString(e):"simple-json"===t.type?C.E.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?R.A.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:"date"===t.type?e=C.E.mixedDateToDateString(e):"time"===t.type?e=C.E.mixedTimeToString(e):t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp with local time zone"===t.type?e=C.E.normalizeHydratedDate(e):"json"===t.type?e=JSON.parse(e):"simple-array"===t.type?e=C.E.stringToSimpleArray(e):"simple-json"===t.type&&(e=C.E.stringToSimpleJson(e)),t.transformer&&(e=R.A.transformFrom(t.transformer,e)),e)},e.prototype.normalizeType=function(e){if(e.type===Number||e.type===Boolean||"numeric"===e.type||"dec"===e.type||"decimal"===e.type||"int"===e.type||"integer"===e.type||"smallint"===e.type)return"number";if("real"===e.type||"double precision"===e.type)return"float";if(e.type===String||"varchar"===e.type)return"varchar2";if(e.type===Date)return"timestamp";if(e.type===S)return"blob";if("uuid"===e.type)return"varchar2";if("simple-array"===e.type)return"clob";else if("simple-json"===e.type)return"clob";else return e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();switch(e.type){case String:case"varchar":case"varchar2":case"nvarchar2":return"255";case"raw":return"2000";case"uuid":return"36";default:return""}},e.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),"timestamp with time zone"===e.type?t="TIMESTAMP"+(null!==e.precision&&void 0!==e.precision?"("+e.precision+")":"")+" WITH TIME ZONE":"timestamp with local time zone"===e.type&&(t="TIMESTAMP"+(null!==e.precision&&void 0!==e.precision?"("+e.precision+")":"")+" WITH LOCAL TIME ZONE"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.master.getConnection(function(e,r,i){if(e)return n(e);t(r)})})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].getConnection(function(e,r){if(e)return n(e);t(r)})}):this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&b.s.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{})},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)})},e.prototype.isReturningSqlSupported=function(){return!0},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.isFullTextColumnTypeSupported=function(){return!1},e.prototype.createParameter=function(e,t){return":"+(t+1)},e.prototype.columnTypeToNativeParameter=function(e){switch(this.normalizeType({type:e})){case"number":case"numeric":case"int":case"integer":case"smallint":case"dec":case"decimal":return this.oracle.NUMBER;case"char":case"nchar":case"nvarchar2":case"varchar2":return this.oracle.STRING;case"blob":return this.oracle.BLOB;case"clob":return this.oracle.CLOB;case"date":case"timestamp":case"timestamp with time zone":case"timestamp with local time zone":return this.oracle.DATE}},e.prototype.loadDependencies=function(){try{this.oracle=w.Qm.load("oracledb")}catch(e){throw new a.z("Oracle","oracledb")}},e.prototype.createPool=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i=this;return(0,r.Jh)(this,function(r){return n=Object.assign({},{user:(t=Object.assign({},t,M.z.buildDriverOptions(t))).username,password:t.password,connectString:t.connectString?t.connectString:t.host+":"+t.port+"/"+t.sid},e.extra||{}),[2,new Promise(function(e,t){i.oracle.createPool(n,function(n,r){if(n)return t(n);e(r)})})]})})},e.prototype.closePool=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()}),e=void 0})]})})},e}()},7349:function(e,t,n){"use strict";n.d(t,{t:function(){return R}});var r=n(274),i=n(6908),a=n(418),o=n(1014),s=n(8535),u=n(8893),c=n(5738),l=n(5128),h=n(8956),p=n(6556),f=n(4678),d=n(3003),m=n(5838),y=n(879),v=n(124),g=n(9396),b=n(9652),E=n(1959),T=n(2611),N=n(4894),C=n(3298),w=n(1444),A=function(e){function t(t,n){var r=e.call(this)||this;return r.queryResponsibilityChain=[],r.driver=t,r.connection=t.connection,r.broadcaster=new N.a(r),r.mode=n,r}return(0,r.ZT)(t,e),t.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){switch(t.label){case 0:if(this.databaseConnection)return[2,this.databaseConnection];return e=this,[4,this.driver.obtainMasterConnection()];case 1:return e.databaseConnection=t.sent(),[2,this.databaseConnection]}})})},t.prototype.release=function(){return(this.isReleased=!0,this.databaseConnection)?this.driver.master.release(this.databaseConnection):Promise.resolve()},t.prototype.startTransaction=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new l.Y;if(this.isTransactionActive)throw new h.S;if(t=new w.D,this.broadcaster.broadcastBeforeTransactionStartEvent(t),!(t.promises.length>0))return[3,2];return[4,Promise.all(t.promises)];case 1:r.sent(),r.label=2;case 2:if(this.isTransactionActive=!0,!e)return[3,4];return[4,this.query("SET TRANSACTION ISOLATION LEVEL "+(e||""))];case 3:r.sent(),r.label=4;case 4:if(n=new w.D,this.broadcaster.broadcastAfterTransactionStartEvent(n),!(n.promises.length>0))return[3,6];return[4,Promise.all(n.promises)];case 5:r.sent(),r.label=6;case 6:return[2]}})})},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.Y;if(!this.isTransactionActive)throw new p.W;if(e=new w.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:if(n.sent(),this.isTransactionActive=!1,t=new w.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(this.isReleased)throw new l.Y;if(!this.isTransactionActive)throw new p.W;if(e=new w.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:if(n.sent(),this.isTransactionActive=!1,t=new w.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.query=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s=this;return(0,r.Jh)(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new l.Y;if(i=new Promise(function(e){return n=e}),!this.queryResponsibilityChain.length)return[3,2];return a=(0,r.fl)(this.queryResponsibilityChain),this.queryResponsibilityChain.push(i),[4,Promise.all(a)];case 1:u.sent(),u.label=2;case 2:return o=new Promise(function(a,u){return(0,r.mG)(s,void 0,void 0,function(){var s,c,l,h=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return(s=r.sent()).setAutoCommit(!this.isTransactionActive),this.driver.connection.logger.logQuery(e,t,this),c=+new Date,l="INSERT INTO"===e.substr(0,11),s.prepare(e).exec(t,function(r,p){var d=h.driver.connection.options.maxQueryExecutionTime,m=+new Date-c;d&&m>d&&h.driver.connection.logger.logQuerySlow(m,e,t,h);var y=function(){-1!==v&&h.queryResponsibilityChain.splice(v,1),-1!==g&&h.queryResponsibilityChain.splice(g,1),n()},v=h.queryResponsibilityChain.indexOf(o),g=h.queryResponsibilityChain.indexOf(i);if(r)return h.driver.connection.logger.logQueryError(r,e,t,h),y(),u(new f.Od(e,t,r));if(l){var b='SELECT CURRENT_IDENTITY_VALUE() FROM "SYS"."DUMMY"';h.driver.connection.logger.logQuery(b,[],h),s.exec(b,function(e,t){if(e){h.driver.connection.logger.logQueryError(e,b,[],h),y(),u(new f.Od(b,[],e));return}a(t[0]["CURRENT_IDENTITY_VALUE()"]),y()})}else a(p),y()}),[3,3];case 2:return u(r.sent()),[3,3];case 3:return[2]}})})}),this.queryResponsibilityChain.push(o),[2,o]}})})},t.prototype.stream=function(e,t,n,i){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Stream is not supported by SAP driver.")})})},t.prototype.getDatabases=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT DATABASE_NAME FROM "SYS"."M_DATABASES"')];case 1:return[2,e.sent().map(function(e){return e.DATABASE_NAME})]}})})},t.prototype.getSchemas=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t=e?'SELECT * FROM "'+e+'"."SYS"."SCHEMAS"':'SELECT * FROM "SYS"."SCHEMAS"',[4,this.query(t)];case 1:return[2,n.sent().map(function(e){return e.SCHEMA_NAME})]}})})},t.prototype.hasDatabase=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getDatabases()];case 1:return[2,-1!==t.sent().indexOf(e)]}})})},t.prototype.hasSchema=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getSchemas()];case 1:return[2,-1!==t.sent().indexOf(e)]}})})},t.prototype.hasTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n='SELECT * FROM "SYS"."TABLES" WHERE "SCHEMA_NAME" = '+(t=this.parseTableName(e)).schema+' AND "TABLE_NAME" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return i='SELECT * FROM "SYS"."TABLE_COLUMNS" WHERE "SCHEMA_NAME" = '+(n=this.parseTableName(e)).schema+' AND "TABLE_NAME" = '+n.tableName+' AND "COLUMN_NAME" = \''+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.dropDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(n=!1,!t)return[3,2];return[4,this.query('SELECT * FROM "SYS"."SCHEMAS" WHERE "SCHEMA_NAME" = \''+e+"'")];case 1:n=!!r.sent().length,r.label=2;case 2:if(!(!t||t&&!n))return[3,4];return i='CREATE SCHEMA "'+e+'"',a='DROP SCHEMA "'+e+'" CASCADE',[4,this.executeQueries(new C.A(i),new C.A(a))];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.dropSchema=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(i=-1===e.indexOf(".")?e:e.split(".")[0],a=!1,!t)return[3,2];return[4,this.query('SELECT * FROM "SYS"."SCHEMAS" WHERE "SCHEMA_NAME" = \''+i+"'")];case 1:a=!!r.sent().length,r.label=2;case 2:if(!(!t||t&&a))return[3,4];return o='DROP SCHEMA "'+i+'" '+(n?"CASCADE":""),s='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(new C.A(o),new C.A(s))];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,function(){var a,o,s=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,2];return[4,this.hasTable(e)];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,function(){var a,o,s,u,c,l=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,2];return[4,this.hasTable(e)];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:if(a=n,!(e instanceof m.i))return[3,3];return s=e,[3,5];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],c=[],i&&o.indices.forEach(function(e){u.push(l.dropIndexSql(o,e)),c.push(l.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return u.push(l.dropForeignKeySql(o,e))}),u.push(this.dropTableSql(o)),c.push(this.createTableSql(o,a)),[4,this.executeQueries(u,c)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return t=e instanceof T.G?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,h,p,f,d,y,v,b,E=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(n=[],i=[],!(e instanceof m.i))return[3,1];return o=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=-1===a.name.indexOf(".")?a.name:a.name.split(".")[1],c=-1===a.name.indexOf(".")?void 0:a.name.split(".")[0],s.name=c?c+"."+t:t,n.push(new C.A("RENAME TABLE "+this.escapePath(a.name)+" TO "+this.escapePath(t))),i.push(new C.A("RENAME TABLE "+this.escapePath(s.name)+" TO "+this.escapePath(u))),s.foreignKeys.forEach(function(e){n.push(E.dropForeignKeySql(s,e)),i.push(E.createForeignKeySql(s,e))}),l='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = \''+c+"' AND \"REFERENCED_TABLE_NAME\" = '"+u+"'",[4,this.query(l)];case 4:return h=r.sent(),p=[],f=[],h.length>0&&(p=h.map(function(e){var t=h.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return f.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new g.U({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:s.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})})).forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});n.push(E.dropForeignKeySql(t.tableName,e)),i.push(E.createForeignKeySql(t.tableName,e))}),s.primaryColumns.length>0&&(y=(d=s.primaryColumns.map(function(e){return e.name})).map(function(e){return'"'+e+'"'}).join(", "),v=this.connection.namingStrategy.primaryKeyName(a,d),b=this.connection.namingStrategy.primaryKeyName(s,d),n.push(new C.A("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+v+'"')),i.push(new C.A("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+y+")")),n.push(new C.A("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+b+'" PRIMARY KEY ('+y+")")),i.push(new C.A("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+b+'"'))),s.foreignKeys.forEach(function(e){e.name=E.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames),n.push(E.createForeignKeySql(s,e)),i.push(E.dropForeignKeySql(s,e))}),p.forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});n.push(E.createForeignKeySql(t.tableName,e)),i.push(E.dropForeignKeySql(t.tableName,e))}),s.indices.forEach(function(e){var t=E.connection.namingStrategy.indexName(s,e.columnNames,e.where);n.push(E.dropIndexSql(s,e)),i.push(E.createIndexSql(s,e)),e.name=t,n.push(E.createIndexSql(s,e)),i.push(E.dropIndexSql(s,e))}),[4,this.executeQueries(n,i)];case 5:return r.sent(),a.name=s.name,this.replaceCachedTable(a,s),[2]}})})},t.prototype.addColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,h,p,f,d,y,v,T,N,w,A=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,a=this.parseTableName(n),o=n.clone(),u=[],(s=[]).push(new C.A(this.addColumnSql(n,t))),u.push(new C.A(this.dropColumnSql(n,t))),!t.isPrimary)return[3,6];if(!((c=o.primaryColumns).length>0))return[3,5];return l='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+a.schema+' AND "REFERENCED_TABLE_NAME" = '+a.tableName,[4,this.query(l)];case 4:h=r.sent(),p=[],f=[],h.length>0&&(p=h.map(function(e){var t=h.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return f.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new g.U({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:n.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})})).forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});s.push(A.dropForeignKeySql(t.tableName,e)),u.push(A.createForeignKeySql(t.tableName,e))}),d=this.connection.namingStrategy.primaryKeyName(o.name,c.map(function(e){return e.name})),y=c.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new C.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+d+'"')),u.push(new C.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+d+'" PRIMARY KEY ('+y+")")),p.forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});s.push(A.createForeignKeySql(t.tableName,e)),u.push(A.dropForeignKeySql(t.tableName,e))}),r.label=5;case 5:c.push(t),v=this.connection.namingStrategy.primaryKeyName(o.name,c.map(function(e){return e.name})),T=c.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new C.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+T+")")),u.push(new C.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+v+'"')),r.label=6;case 6:return(N=o.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))?(s.push(this.createIndexSql(n,N)),u.push(this.dropIndexSql(n,N))):t.isUnique&&(w=new b.s({name:this.connection.namingStrategy.indexName(n.name,[t.name]),columnNames:[t.name],isUnique:!0}),o.indices.push(w),o.uniques.push(new E.v({name:w.name,columnNames:w.columnNames})),s.push(this.createIndexSql(n,w)),u.push(this.dropIndexSql(n,w))),[4,this.executeQueries(s,u)];case 7:return r.sent(),o.addColumn(t),this.replaceCachedTable(n,o),[2]}})})},t.prototype.addColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),i=(n=(0,r.XA)(t)).next(),u.label=1;case 1:if(i.done)return[3,4];return a=i.value,[4,this.addColumn(e,a)];case 2:u.sent(),u.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o={error:u.sent()},[3,7];case 6:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return a=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof v.D?t:i.columns.find(function(e){return e.name===t})))throw Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return s=void 0,n instanceof v.D?s=n:(s=o.clone()).name=n,[4,this.changeColumn(i,o,s)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,o,s,u,c,l,h,p,f,d,y,g,T,N,w,A,M=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return a=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(c=t instanceof v.D?t:i.columns.find(function(e){return e.name===t})))throw Error('Column "'+t+'" was not found in the "'+i.name+'" table.');if(!(n.isGenerated!==c.isGenerated&&"uuid"!==n.generationStrategy||n.type!==c.type||n.length!==c.length))return[3,6];return[4,this.dropColumn(i,c)];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,8];case 6:return n.name!==c.name&&(s.push(new C.A("RENAME COLUMN "+this.escapePath(i)+'."'+c.name+'" TO "'+n.name+'"')),u.push(new C.A("RENAME COLUMN "+this.escapePath(i)+'."'+n.name+'" TO "'+c.name+'"')),!0===c.isPrimary&&(h=(l=o.primaryColumns).map(function(e){return e.name}),p=this.connection.namingStrategy.primaryKeyName(o,h),h.splice(h.indexOf(c.name),1),h.push(n.name),f=h.map(function(e){return'"'+e+'"'}).join(", "),s.push(new C.A("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+p+'"')),u.push(new C.A("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+f+")")),d=this.connection.namingStrategy.primaryKeyName(o,h),s.push(new C.A("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+d+'" PRIMARY KEY ('+f+")")),u.push(new C.A("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+d+'"'))),o.findColumnIndices(c).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.indexName(o,e.columnNames,e.where);s.push(M.dropIndexSql(o,e)),u.push(M.createIndexSql(o,e)),e.name=t,s.push(M.createIndexSql(o,e)),u.push(M.dropIndexSql(o,e))}),o.findColumnForeignKeys(c).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(M.dropForeignKeySql(o,e)),u.push(M.createForeignKeySql(o,e)),e.name=t,s.push(M.createForeignKeySql(o,e)),u.push(M.dropForeignKeySql(o,e))}),o.findColumnChecks(c).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.checkConstraintName(o,e.expression);s.push(M.dropCheckConstraintSql(o,e)),u.push(M.createCheckConstraintSql(o,e)),e.name=t,s.push(M.createCheckConstraintSql(o,e)),u.push(M.dropCheckConstraintSql(o,e))}),y=o.columns.find(function(e){return e.name===c.name}),o.columns[o.columns.indexOf(y)].name=n.name,c.name=n.name),this.isColumnChanged(c,n)&&(s.push(new C.A("ALTER TABLE "+this.escapePath(i)+" ALTER ("+this.buildCreateColumnSql(n)+")")),u.push(new C.A("ALTER TABLE "+this.escapePath(i)+" ALTER ("+this.buildCreateColumnSql(c)+")"))),n.isPrimary!==c.isPrimary&&((l=o.primaryColumns).length>0&&(g=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),h=l.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new C.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+g+'"')),u.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+g+'" PRIMARY KEY ('+h+")"))),!0===n.isPrimary?(l.push(n),o.columns.find(function(e){return e.name===n.name}).isPrimary=!0,g=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),h=l.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+g+'" PRIMARY KEY ('+h+")")),u.push(new C.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+g+'"'))):(T=l.find(function(e){return e.name===n.name}),l.splice(l.indexOf(T),1),o.columns.find(function(e){return e.name===n.name}).isPrimary=!1,l.length>0&&(g=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),h=l.map(function(e){return'"'+e.name+'"'}).join(", "),s.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+g+'" PRIMARY KEY ('+h+")")),u.push(new C.A("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+g+'"'))))),n.isUnique!==c.isUnique&&(!0===n.isUnique?(N=new b.s({name:this.connection.namingStrategy.indexName(i.name,[n.name]),columnNames:[n.name],isUnique:!0}),o.indices.push(N),o.uniques.push(new E.v({name:N.name,columnNames:N.columnNames})),s.push(this.createIndexSql(i,N)),u.push(this.dropIndexSql(i,N))):(w=o.indices.find(function(e){return 1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find(function(e){return e===n.name})}),o.indices.splice(o.indices.indexOf(w),1),A=o.uniques.find(function(e){return e.name===w.name}),o.uniques.splice(o.uniques.indexOf(A),1),s.push(this.dropIndexSql(i,w)),u.push(this.createIndexSql(i,w)))),n.default!==c.default&&(null!==n.default&&void 0!==n.default?(s.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+n.name+'" '+this.connection.driver.createFullType(n)+" DEFAULT "+n.default+")")),null!==c.default&&void 0!==c.default?u.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+c.name+'" '+this.connection.driver.createFullType(c)+" DEFAULT "+c.default+")")):u.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+c.name+'" '+this.connection.driver.createFullType(c)+" DEFAULT NULL)"))):null!==c.default&&void 0!==c.default&&(s.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+n.name+'" '+this.connection.driver.createFullType(n)+" DEFAULT NULL)")),u.push(new C.A("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+c.name+'" '+this.connection.driver.createFullType(c)+" DEFAULT "+c.default+")")))),[4,this.executeQueries(s,u)];case 7:r.sent(),this.replaceCachedTable(i,o),r.label=8;case 8:return[2]}})})},t.prototype.changeColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c;return(0,r.Jh)(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,7]),i=(n=(0,r.XA)(t)).next(),l.label=1;case 1:if(i.done)return[3,4];return o=(a=i.value).oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)];case 2:l.sent(),l.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u={error:l.sent()},[3,7];case 6:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,h,p,f,d,y,b,E,T,N,w,A,M,R,S=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,a=this.parseTableName(n),!(o=t instanceof v.D?t:n.findColumnByName(t)))throw Error('Column "'+t+'" was not found in table "'+n.name+'"');if(s=n.clone(),u=[],c=[],!o.isPrimary)return[3,5];return l='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+a.schema+' AND "REFERENCED_TABLE_NAME" = '+a.tableName,[4,this.query(l)];case 4:h=r.sent(),p=[],f=[],h.length>0&&(p=h.map(function(e){var t=h.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return f.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new g.U({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:n.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})})).forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});u.push(S.dropForeignKeySql(t.tableName,e)),c.push(S.createForeignKeySql(t.tableName,e))}),d=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map(function(e){return e.name})),y=s.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),u.push(new C.A("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+d+'"')),c.push(new C.A("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+d+'" PRIMARY KEY ('+y+")")),s.findColumnByName(o.name).isPrimary=!1,s.primaryColumns.length>0&&(b=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map(function(e){return e.name})),E=s.primaryColumns.map(function(e){return'"'+e.name+'"'}).join(", "),u.push(new C.A("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+b+'" PRIMARY KEY ('+E+")")),c.push(new C.A("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+b+'"'))),p.forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});u.push(S.createForeignKeySql(t.tableName,e)),c.push(S.dropForeignKeySql(t.tableName,e))}),r.label=5;case 5:return(T=s.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===o.name}))?(s.indices.splice(s.indices.indexOf(T),1),u.push(this.dropIndexSql(n,T)),c.push(this.createIndexSql(n,T))):o.isUnique&&(N=this.connection.namingStrategy.uniqueConstraintName(n.name,[o.name]),(w=s.uniques.find(function(e){return e.name===N}))&&(s.uniques.splice(s.uniques.indexOf(w),1),u.push(this.dropIndexSql(n,N)),c.push(new C.A('CREATE UNIQUE INDEX "'+N+'" ON '+this.escapePath(n)+' ("'+o.name+'")'))),A=this.connection.namingStrategy.indexName(n.name,[o.name]),(M=s.indices.find(function(e){return e.name===A}))&&(s.indices.splice(s.indices.indexOf(M),1),u.push(this.dropIndexSql(n,A)),c.push(new C.A('CREATE UNIQUE INDEX "'+A+'" ON '+this.escapePath(n)+' ("'+o.name+'")')))),(R=s.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===o.name}))&&(s.checks.splice(s.checks.indexOf(R),1),u.push(this.dropCheckConstraintSql(n,R)),c.push(this.createCheckConstraintSql(n,R))),u.push(new C.A(this.dropColumnSql(n,o))),c.push(new C.A(this.addColumnSql(n,o))),[4,this.executeQueries(u,c)];case 6:return r.sent(),s.removeColumn(o),this.replaceCachedTable(n,s),[2]}})})},t.prototype.dropColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),i=(n=(0,r.XA)(t)).next(),u.label=1;case 1:if(i.done)return[3,4];return a=i.value,[4,this.dropColumn(e,a)];case 2:u.sent(),u.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o={error:u.sent()},[3,7];case 6:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,h,p,f,d,y,v,b,E,T=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=this.parseTableName(n),o=n.clone(),s=t.map(function(e){return e.name}),u=[],c=[],l='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+a.schema+' AND "REFERENCED_TABLE_NAME" = '+a.tableName,[4,this.query(l)];case 4:return h=r.sent(),p=[],f=[],h.length>0&&(p=h.map(function(e){var t=h.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return f.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new g.U({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:n.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})})).forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});u.push(T.dropForeignKeySql(t.tableName,e)),c.push(T.createForeignKeySql(t.tableName,e))}),(d=o.primaryColumns).length>0&&(y=this.connection.namingStrategy.primaryKeyName(o.name,d.map(function(e){return e.name})),v=d.map(function(e){return'"'+e.name+'"'}).join(", "),u.push(new C.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+y+'"')),c.push(new C.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+y+'" PRIMARY KEY ('+v+")"))),o.columns.filter(function(e){return -1!==s.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),b=this.connection.namingStrategy.primaryKeyName(o.name,s),E=s.map(function(e){return'"'+e+'"'}).join(", "),u.push(new C.A("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+b+'" PRIMARY KEY ('+E+")")),c.push(new C.A("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+b+'"')),p.forEach(function(e){var t=f.find(function(t){return t.fkName===e.name});u.push(T.createForeignKeySql(t.tableName,e)),c.push(T.dropForeignKeySql(t.tableName,e))}),[4,this.executeQueries(u,c)];case 5:return r.sent(),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropPrimaryKey=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l,h=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return n=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.parseTableName(t),a=[],o=[],s='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+i.schema+' AND "REFERENCED_TABLE_NAME" = '+i.tableName,[4,this.query(s)];case 4:return u=r.sent(),c=[],l=[],u.length>0&&(c=u.map(function(e){var n=u.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return l.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new g.U({name:e.CONSTRAINT_NAME,columnNames:n.map(function(e){return e.COLUMN_NAME}),referencedTableName:t.name,referencedColumnNames:n.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})})).forEach(function(e){var t=l.find(function(t){return t.fkName===e.name});a.push(h.dropForeignKeySql(t.tableName,e)),o.push(h.createForeignKeySql(t.tableName,e))}),a.push(this.dropPrimaryKeySql(t)),o.push(this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name}))),c.forEach(function(e){var t=l.find(function(t){return t.fkName===e.name});a.push(h.createForeignKeySql(t.tableName,e)),o.push(h.dropForeignKeySql(t.tableName,e))}),[4,this.executeQueries(a,o)];case 5:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support unique constraints. Use unique index instead.")})})},t.prototype.createUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support unique constraints. Use unique index instead.")})})},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support unique constraints. Use unique index instead.")})})},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support unique constraints. Use unique index instead.")})})},t.prototype.createCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createCheckConstraint(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.r?t:n.checks.find(function(e){return e.name===t})))throw Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropCheckConstraint(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("SAP HANA does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createForeignKey(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof g.U?t:n.foreignKeys.find(function(e){return e.name===t})))throw Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropForeignKey(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createIndex(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof m.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof b.s?t:n.indices.find(function(e){return e.name===t})))throw Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropIndex(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(e){return e.schema}).forEach(function(t){e.find(function(e){return e===t.schema})||e.push(t.schema)}),e.push(this.driver.options.schema||"current_schema"),t=e.map(function(e){return"current_schema"===e?e:"'"+e+"'"}).join(", "),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,6,,11]),n='SELECT \'DROP TABLE "\' || schema_name || \'"."\' || table_name || \'" CASCADE;\' as "query" FROM "SYS"."TABLES" WHERE "SCHEMA_NAME" IN ('+t+") AND \"TABLE_NAME\" NOT IN ('SYS_AFL_GENERATOR_PARAMETERS') AND \"IS_COLUMN_TABLE\" = 'TRUE'",[4,this.query(n)];case 3:return[4,Promise.all(r.sent().map(function(e){return a.query(e.query)}))];case 4:return r.sent(),[4,this.commitTransaction()];case 5:return r.sent(),[3,11];case 6:i=r.sent(),r.label=7;case 7:return r.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:case 9:return r.sent(),[3,10];case 10:throw i;case 11:return[2]}})})},t.prototype.getCurrentDatabase=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT "VALUE" AS "db_name" FROM "SYS"."M_SYSTEM_OVERVIEW" WHERE "SECTION" = \'System\' and "NAME" = \'Instance ID\'')];case 1:return[2,e.sent()[0].db_name]}})})},t.prototype.getCurrentSchema=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT CURRENT_SCHEMA AS "schema_name" FROM "SYS"."DUMMY"')];case 1:return[2,e.sent()[0].schema_name]}})})},t.prototype.loadViews=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a=this;return(0,r.Jh)(this,function(o){switch(o.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:if(!o.sent())return[2,Promise.resolve([])];return[4,this.getCurrentSchema()];case 2:return t=o.sent(),n=e.map(function(e){var n=(0,r.CR)(e.split("."),2),i=n[0],o=n[1];return o||(o=i,i=a.driver.options.schema||t),'("t"."schema" = \''+i+'\' AND "t"."name" = \''+o+"')"}).join(" OR "),i='SELECT "t".* FROM '+this.escapePath(this.getTypeormMetadataTableName())+' "t" WHERE "t"."type" = \'VIEW\' '+(n?"AND ("+n+")":""),[4,this.query(i)];case 3:return[2,o.sent().map(function(e){var n=new T.G,r=e.schema!==t||a.driver.options.schema?e.schema:void 0;return n.name=a.driver.buildTableName(e.name,r),n.expression=e.value,n})]}})})},t.prototype.loadTables=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,l,h,p,f,d,E,T=this;return(0,r.Jh)(this,function(N){switch(N.label){case 0:if(!e||!e.length)return[2,[]];return[4,this.getCurrentSchema()];case 1:return t=N.sent(),i='SELECT * FROM "SYS"."TABLES" WHERE '+(n=e.map(function(e){var n=(0,r.CR)(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=T.driver.options.schema||t),'("SCHEMA_NAME" = \''+i+"' AND \"TABLE_NAME\" = '"+a+"')"}).join(" OR ")),a='SELECT * FROM "SYS"."TABLE_COLUMNS" WHERE '+n+' ORDER BY "POSITION"',o='SELECT * FROM "SYS"."CONSTRAINTS" WHERE ('+e.map(function(e){var n=(0,r.CR)(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=T.driver.options.schema||t),'("SCHEMA_NAME" = \''+i+"' AND \"TABLE_NAME\" = '"+a+"')"}).join(" OR ")+') ORDER BY "POSITION"',s='SELECT "I"."INDEX_TYPE", "I"."SCHEMA_NAME", "I"."TABLE_NAME", "I"."INDEX_NAME", "IC"."COLUMN_NAME", "I"."CONSTRAINT" FROM "SYS"."INDEXES" "I" INNER JOIN "SYS"."INDEX_COLUMNS" "IC" ON "IC"."INDEX_OID" = "I"."INDEX_OID" WHERE ('+e.map(function(e){var n=(0,r.CR)(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=T.driver.options.schema||t),'("I"."SCHEMA_NAME" = \''+i+'\' AND "I"."TABLE_NAME" = \''+a+"')"}).join(" OR ")+') AND ("I"."CONSTRAINT" IS NULL OR "I"."CONSTRAINT" != \'PRIMARY KEY\') AND "I"."INDEX_NAME" NOT LIKE \'%_SYS_FULLTEXT_%\' ORDER BY "IC"."POSITION"',u='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE ('+e.map(function(e){var n=(0,r.CR)(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=T.driver.options.schema||t),'("SCHEMA_NAME" = \''+i+"' AND \"TABLE_NAME\" = '"+a+"')"}).join(" OR ")+') ORDER BY "POSITION"',[4,Promise.all([this.query(i),this.query(a),this.query(o),this.query(s),this.query(u)])];case 2:if(h=(l=r.CR.apply(void 0,[N.sent(),5]))[0],p=l[1],f=l[2],d=l[3],E=l[4],!h.length)return[2,[]];return[2,Promise.all(h.map(function(e){return(0,r.mG)(T,void 0,void 0,function(){var n,i,a,o,s,u,l,h=this;return(0,r.Jh)(this,function(T){switch(T.label){case 0:return n=new m.i,i=e.SCHEMA_NAME!==t||this.driver.options.schema?e.SCHEMA_NAME:void 0,n.name=this.driver.buildTableName(e.TABLE_NAME,i),a=this.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME),o=n,[4,Promise.all(p.filter(function(e){return h.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a}).map(function(e){return(0,r.mG)(h,void 0,void 0,function(){var t,i,o,s,u,c,l,h=this;return(0,r.Jh)(this,function(r){return t=f.filter(function(t){return h.driver.buildTableName(t.TABLE_NAME,t.SCHEMA_NAME)===a&&t.COLUMN_NAME===e.COLUMN_NAME}),i=d.find(function(t){return h.driver.buildTableName(t.TABLE_NAME,t.SCHEMA_NAME)===a&&t.COLUMN_NAME===e.COLUMN_NAME&&t.CONSTRAINT&&-1!==t.CONSTRAINT.indexOf("UNIQUE")}),o=this.connection.entityMetadatas.find(function(e){return e.tablePath===n.name}),s=i&&o&&o.indices.some(function(e){return e.name===i.INDEX_NAME&&!1===e.synchronize}),u=!!i&&!!d.find(function(t){return t.INDEX_NAME===i.INDEX_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),(c=new v.D).name=e.COLUMN_NAME,c.type=e.DATA_TYPE_NAME.toLowerCase(),"dec"!==c.type&&"decimal"!==c.type||(null===e.LENGTH||this.isDefaultColumnPrecision(n,c,e.LENGTH)?null===e.SCALE||this.isDefaultColumnScale(n,c,e.SCALE)||(c.precision=void 0):c.precision=e.LENGTH,null===e.SCALE||this.isDefaultColumnScale(n,c,e.SCALE)?null===e.LENGTH||this.isDefaultColumnPrecision(n,c,e.LENGTH)||(c.scale=void 0):c.scale=e.SCALE),"array"===e.DATA_TYPE_NAME.toLowerCase()&&(c.isArray=!0,c.type=e.CS_DATA_TYPE_NAME.toLowerCase()),-1!==this.driver.withLengthColumnTypes.indexOf(c.type)&&e.LENGTH&&(l=e.LENGTH.toString(),c.length=this.isDefaultColumnLength(n,c,l)?"":l),c.isUnique=!!i&&!s&&!u,c.isNullable="TRUE"===e.IS_NULLABLE,c.isPrimary=!!t.find(function(e){return"TRUE"===e.IS_PRIMARY_KEY}),c.isGenerated="ALWAYS AS IDENTITY"===e.GENERATION_TYPE,c.isGenerated&&(c.generationStrategy="increment"),null===e.DEFAULT_VALUE||void 0===e.DEFAULT_VALUE?c.default=void 0:"char"===c.type||"nchar"===c.type||"varchar"===c.type||"nvarchar"===c.type||"alphanum"===c.type||"shorttext"===c.type?c.default="'"+e.DEFAULT_VALUE+"'":"boolean"===c.type?c.default="1"===e.DEFAULT_VALUE?"true":"false":c.default=e.DEFAULT_VALUE,c.comment="",e.character_set_name&&(c.charset=e.character_set_name),e.collation_name&&(c.collation=e.collation_name),[2,c]})})}))];case 1:return o.columns=T.sent(),s=c.s.uniq(f.filter(function(e){return h.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a&&null!==e.CHECK_CONDITION&&void 0!==e.CHECK_CONDITION}),function(e){return e.CONSTRAINT_NAME}),n.checks=s.map(function(e){var t=f.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new y.r({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.CHECK_CONDITION})}),u=c.s.uniq(E.filter(function(e){return h.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a}),function(e){return e.CONSTRAINT_NAME}),n.foreignKeys=u.map(function(e){var n=E.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}),r=e.REFERENCED_SCHEMA_NAME===t?void 0:e.REFERENCED_SCHEMA_NAME,i=h.driver.buildTableName(e.REFERENCED_TABLE_NAME,r);return new g.U({name:e.CONSTRAINT_NAME,columnNames:n.map(function(e){return e.COLUMN_NAME}),referencedTableName:i,referencedColumnNames:n.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})}),l=c.s.uniq(d.filter(function(e){return h.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a}),function(e){return e.INDEX_NAME}),n.indices=l.map(function(e){var t=d.filter(function(t){return t.SCHEMA_NAME===e.SCHEMA_NAME&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME});return new b.s({table:n,name:e.INDEX_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),isUnique:e.CONSTRAINT&&-1!==e.CONSTRAINT.indexOf("UNIQUE"),isFulltext:"FULLTEXT"===e.INDEX_TYPE})}),[2,n]}})})}))]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(e){return n.buildCreateColumnSql(e)}).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;e.columns.filter(function(e){return e.isUnique}).forEach(function(t){var r=e.indices.some(function(e){return 1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name)}),i=e.uniques.some(function(e){return 1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)});r||i||e.indices.push(new b.s({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name],isUnique:!0}))}),e.uniques.length>0&&e.uniques.forEach(function(t){e.indices.some(function(e){return e.name===t.name})||e.indices.push(new b.s({name:t.name,columnNames:t.columnNames,isUnique:!0}))}),e.checks.length>0&&(i+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", ")),e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapePath(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+("NO ACTION"===t.onDelete?"RESTRICT":t.onDelete)),t.onUpdate&&(a+=" ON UPDATE "+("NO ACTION"===t.onUpdate?"RESTRICT":t.onUpdate)),a}).join(", "));var a=e.columns.filter(function(e){return e.isPrimary});return a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'" PRIMARY KEY ('+a.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),i+=")",new C.A(i)},t.prototype.dropTableSql=function(e,t){var n=t?"DROP TABLE IF EXISTS "+this.escapePath(e):"DROP TABLE "+this.escapePath(e);return new C.A(n)},t.prototype.createViewSql=function(e){return new C.A("string"==typeof e.expression?"CREATE VIEW "+this.escapePath(e)+" AS "+e.expression:"CREATE VIEW "+this.escapePath(e)+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c;return(0,r.Jh)(this,function(l){switch(l.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=l.sent(),n=e.name.split("."),i=this.driver.options.schema||t,a=e.name,2===n.length&&(i=n[0],a=n[1]),o="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),u=(s=(0,r.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",schema:i,name:a,value:o}).getQueryAndParameters(),2))[0],c=s[1],[2,new C.A(u,c)]}})})},t.prototype.dropViewSql=function(e){return new C.A("DROP VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l;return(0,r.Jh)(this,function(h){switch(h.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=h.sent(),i=(n=e instanceof T.G?e.name:e).split("."),a=this.driver.options.schema||t,o=n,2===i.length&&(a=i[0],o=i[1]),s=this.connection.createQueryBuilder(),c=(u=(0,r.CR)(s.delete().from(this.getTypeormMetadataTableName()).where(s.escape("type")+" = 'VIEW'").andWhere(s.escape("schema")+" = :schema",{schema:a}).andWhere(s.escape("name")+" = :name",{name:o}).getQueryAndParameters(),2))[0],l=u[1],[2,new C.A(c,l)]}})})},t.prototype.addColumnSql=function(e,t){return"ALTER TABLE "+this.escapePath(e)+" ADD ("+this.buildCreateColumnSql(t)+")"},t.prototype.dropColumnSql=function(e,t){return"ALTER TABLE "+this.escapePath(e)+' DROP ("'+t.name+'")'},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r="";return t.isUnique&&(r+="UNIQUE "),t.isFulltext&&(r+="FULLTEXT "),new C.A("CREATE "+r+'INDEX "'+t.name+'" ON '+this.escapePath(e)+" ("+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof b.s?t.name:t,r=this.parseTableName(e);return new C.A("current_schema"===r.schema?'DROP INDEX "'+n+'"':'DROP INDEX "'+r.schema.replace(/'/g,"")+'"."'+n+'"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'"'+e+'"'}).join(", ");return new C.A("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new C.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new C.A("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof y.r?t.name:t;return new C.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", "),r=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(","),i="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") "+("REFERENCES "+this.escapePath(t.referencedTableName))+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+("NO ACTION"===t.onDelete?"RESTRICT":t.onDelete)),t.onUpdate&&(i+=" ON UPDATE "+("NO ACTION"===t.onUpdate?"RESTRICT":t.onUpdate)),new C.A(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof g.U?t.name:t;return new C.A("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.escapePath=function(e,t){var n=e instanceof m.i||e instanceof T.G?e.name:e;return(n=-1===n.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+n:n).split(".").map(function(e){return t?e:'"'+e+'"'}).join(".")},t.prototype.parseTableName=function(e){var t=e instanceof m.i?e.name:e;return -1===t.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema",tableName:"'"+t+"'"}:{schema:"'"+t.split(".")[0]+"'",tableName:"'"+t.split(".")[1]+"'"}},t.prototype.buildForeignKeyName=function(e,t,n){var r=e;return t&&(r=t+"."+r),n&&(r=n+"."+r),r},t.prototype.removeParenthesisFromDefault=function(e){if("("!==e.substr(0,1))return e;var t=e.substr(1,e.lastIndexOf(")")-1);return this.removeParenthesisFromDefault(t)},t.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(t+=" GENERATED ALWAYS AS IDENTITY"),t},t}(d.Y),M=n(8764).Buffer,R=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["tinyint","smallint","int","integer","bigint","smalldecimal","decimal","dec","real","double","float","date","time","seconddate","timestamp","boolean","char","nchar","varchar","nvarchar","text","alphanum","shorttext","array","varbinary","blob","clob","nclob","st_geometry","st_point"],this.spatialTypes=["st_geometry","st_point"],this.withLengthColumnTypes=["varchar","nvarchar","alphanum","shorttext","varbinary"],this.withPrecisionColumnTypes=["decimal"],this.withScaleColumnTypes=["decimal"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"timestamp",updateDateDefault:"CURRENT_TIMESTAMP",deleteDate:"timestamp",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"nvarchar",migrationTimestamp:"bigint",cacheId:"integer",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"integer",cacheQuery:"nvarchar(5000)",cacheResult:"text",metadataType:"nvarchar",metadataDatabase:"nvarchar",metadataSchema:"nvarchar",metadataTable:"nvarchar",metadataName:"nvarchar",metadataValue:"nvarchar(5000)"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},shorttext:{length:255},varbinary:{length:255},decimal:{precision:18,scale:0}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.loadDependencies()}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i;return(0,r.Jh)(this,function(a){return e=(0,r.pi)({hostName:this.options.host,port:this.options.port,userName:this.options.username,password:this.options.password},this.options.extra),this.options.database&&(e.databaseName=this.options.database),this.options.encrypt&&(e.encrypt=this.options.encrypt),this.options.sslValidateCertificate&&(e.validateCertificate=this.options.sslValidateCertificate),this.options.key&&(e.key=this.options.key),this.options.cert&&(e.cert=this.options.cert),this.options.ca&&(e.ca=this.options.ca),t={min:this.options.pool&&this.options.pool.min?this.options.pool.min:1,max:this.options.pool&&this.options.pool.max?this.options.pool.max:10},this.options.pool&&this.options.pool.checkInterval&&(t.checkInterval=this.options.pool.checkInterval),this.options.pool&&this.options.pool.maxWaitingRequests&&(t.maxWaitingRequests=this.options.pool.maxWaitingRequests),this.options.pool&&this.options.pool.requestTimeout&&(t.requestTimeout=this.options.pool.requestTimeout),this.options.pool&&this.options.pool.idleTimeout&&(t.idleTimeout=this.options.pool.idleTimeout),n=this.connection.logger,i=t.poolErrorHandler||function(e){return n.log("warn","SAP Hana pool raised an error. "+e)},this.client.eventEmitter.on("poolError",i),this.master=this.client.createPool(e,t),this.database=this.options.database,[2]})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){return e=this.master.clear(),this.master=void 0,[2,e]})})},e.prototype.createSchemaBuilder=function(){return new o.n(this.connection)},e.prototype.createQueryRunner=function(e){return new A(this,e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return n[e]instanceof Date?u.E.mixedDateToDatetimeString(n[e],!0):n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(RegExp(i,"g"),function(e){var n,i=!1;return(":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i)?n.map(function(e){return r.push(e),"?"}).join(", "):n instanceof Function?n():n instanceof Date?u.E.mixedDateToDatetimeString(n,!0):(r.push(n),"?")}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t){return t?t+"."+e:e},e.prototype.preparePersistentValue=function(e,t){if(t.transformer&&(e=s.A.transformTo(t.transformer,e)),null==e)return e;if(t.type===Boolean)return!0===e?1:0;if("date"===t.type)return u.E.mixedDateToDateString(e);if("time"===t.type)return u.E.mixedDateToTimeString(e);if("timestamp"===t.type||t.type===Date)return u.E.mixedDateToDatetimeString(e,!0);if("seconddate"===t.type)return u.E.mixedDateToDatetimeString(e,!1);if("simple-array"===t.type)return u.E.simpleArrayToString(e);if("simple-json"===t.type)return u.E.simpleJsonToString(e);else if("simple-enum"===t.type)return u.E.simpleEnumToString(e);else if(t.isArray)return function(){return"ARRAY("+e.map(function(e){return"'"+e+"'"})+")"};return e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?s.A.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:"timestamp"===t.type||"seconddate"===t.type||t.type===Date?e=u.E.normalizeHydratedDate(e):"date"===t.type?e=u.E.mixedDateToDateString(e):"time"===t.type?e=u.E.mixedTimeToString(e):"simple-array"===t.type?e=u.E.stringToSimpleArray(e):"simple-json"===t.type?e=u.E.stringToSimpleJson(e):"simple-enum"===t.type&&(e=u.E.stringToSimpleEnum(e,t)),t.transformer&&(e=s.A.transformFrom(t.transformer,e)),e)},e.prototype.normalizeType=function(e){if(e.type===Number||"int"===e.type)return"integer";if(e.type===String)return"nvarchar";if(e.type===Date)return"timestamp";if(e.type===Boolean)return"boolean";if(e.type===M)return"blob";if("uuid"===e.type)return"nvarchar";if("simple-array"===e.type||"simple-json"===e.type)return"text";else if("simple-enum"===e.type)return"nvarchar";else return e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"true":"false":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.indices.some(function(t){return t.isUnique&&1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case"varchar":case"nvarchar":case"shorttext":case String:case"varbinary":return"255";case"alphanum":return"127"}return""},e.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return this.master.getConnection()},e.prototype.obtainSlaveConnection=function(){return this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){var n=e.generatedColumns.reduce(function(e,n){var r;return"increment"===n.generationStrategy&&t&&(r=t),c.s.mergeDeep(e,n.createValueMap(r))},{});return Object.keys(n).length>0?n:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});if(!r)return!1;var i=n.normalizeDefault(t);return r.name!==t.databaseName||r.type!==n.normalizeType(t)||t.length&&r.length!==n.getColumnLength(t)||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&(null==i?void 0:i)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated})},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.isFullTextColumnTypeSupported=function(){return!0},e.prototype.createParameter=function(e,t){return"?"},e.prototype.loadDependencies=function(){try{this.client=a.Qm.load("hdb-pool")}catch(e){throw new i.z("SAP Hana","hdb-pool")}try{a.Qm.load("@sap/hana-client")}catch(e){throw new i.z("SAP Hana","@sap/hana-client")}},e}()},3595:function(e,t,n){"use strict";n.d(t,{w:function(){return u}});var r=n(274),i=n(8893),a=n(1014),o=n(5738),s=n(8535),u=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e=this;return(0,r.Jh)(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new a.n(this.connection)},e.prototype.preparePersistentValue=function(e,t){if(t.transformer&&(e=s.A.transformTo(t.transformer,e)),null==e)return e;if(t.type===Boolean||"boolean"===t.type)return!0===e?1:0;if("date"===t.type)return i.E.mixedDateToDateString(e);if("time"===t.type)return i.E.mixedDateToTimeString(e);if("datetime"===t.type||t.type===Date)return i.E.mixedDateToUtcDatetimeString(e);if("simple-array"===t.type)return i.E.simpleArrayToString(e);if("simple-json"===t.type)return i.E.simpleJsonToString(e);if("simple-enum"===t.type)return i.E.simpleEnumToString(e);return e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?s.A.transformFrom(t.transformer,e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"==typeof e&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=i.E.normalizeHydratedDate(e)):"date"===t.type?e=i.E.mixedDateToDateString(e):"time"===t.type?e=i.E.mixedTimeToString(e):"simple-array"===t.type?e=i.E.stringToSimpleArray(e):"simple-json"===t.type?e=i.E.stringToSimpleJson(e):"simple-enum"===t.type&&(e=i.E.stringToSimpleEnum(e,t)),t.transformer&&(e=s.A.transformFrom(t.transformer,e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return"boolean"==typeof n[e]?!0===n[e]?1:0:n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(RegExp(i,"g"),function(e){var n,i=!1;return(":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i)?n.map(function(e){return r.push(e),"?"}).join(", "):n instanceof Function?n():(r.push(n),"?")}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){return e},e.prototype.normalizeType=function(e){if(e.type===Number||"int"===e.type)return"integer";if(e.type===String)return"varchar";if(e.type===Date)return"datetime";if(e.type===Boolean)return"boolean";if("uuid"===e.type)return"varchar";if("simple-array"===e.type)return"text";if("simple-json"===e.type)return"text";else if("simple-enum"===e.type)return"varchar";else return e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.enum?"varchar":(e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t)},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t,n,r){var i=e.generatedColumns.reduce(function(e,i){var a;return("increment"===i.generationStrategy&&t&&(a=t-r+n+1),a)?o.s.mergeDeep(e,i.createValueMap(a)):e},{});return Object.keys(i).length>0?i:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)})},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.isFullTextColumnTypeSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.createDatabaseConnection=function(){throw Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}()},4726:function(e,t,n){"use strict";n.d(t,{J:function(){return g}});var r=n(274),i=n(8956),a=n(6556),o=n(124),s=n(2367),u=n(5838),c=n(9652),l=n(9396),h=n(2611),p=n(1444),f=n(3298),d=n(1959),m=n(3003),y=n(5738),v=n(879),g=function(e){function t(){return e.call(this)||this}return(0,r.ZT)(t,e),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(this.isTransactionActive)throw new i.S;if(!e)return[3,4];if("READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw Error("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");if("READ UNCOMMITTED"!==e)return[3,2];return[4,this.query("PRAGMA read_uncommitted = true")];case 1:return r.sent(),[3,4];case 2:return[4,this.query("PRAGMA read_uncommitted = false")];case 3:r.sent(),r.label=4;case 4:if(t=new p.D,this.broadcaster.broadcastBeforeTransactionStartEvent(t),!(t.promises.length>0))return[3,6];return[4,Promise.all(t.promises)];case 5:r.sent(),r.label=6;case 6:return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 7:if(r.sent(),n=new p.D,this.broadcaster.broadcastAfterTransactionStartEvent(n),!(n.promises.length>0))return[3,9];return[4,Promise.all(n.promises)];case 8:r.sent(),r.label=9;case 9:return[2]}})})},t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new a.W;if(e=new p.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:if(n.sent(),this.isTransactionActive=!1,t=new p.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new a.W;if(e=new p.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:if(n.sent(),this.isTransactionActive=!1,t=new p.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.stream=function(e,t,n,r){throw Error("Stream is not supported by sqlite driver.")},t.prototype.getDatabases=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("This driver does not support table schemas")})})},t.prototype.hasTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t='SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" = \''+(e instanceof u.i?e.name:e)+"'",[4,this.query(t)];case 1:return[2,!!n.sent().length]}})})},t.prototype.hasColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n='PRAGMA table_info("'+(e instanceof u.i?e.name:e)+'")',[4,this.query(n)];case 1:return[2,!!r.sent().find(function(e){return e.name===t})]}})})},t.prototype.createDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.dropDatabase=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.dropSchema=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,Promise.resolve()]})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,function(){var a,o,s=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(a=[],o=[],!t)return[3,2];return[4,this.hasTable(e)];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.mG)(this,void 0,void 0,function(){var a,o,s,c,l,h=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!t)return[3,2];return[4,this.hasTable(e)];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:if(a=n,!(e instanceof u.i))return[3,3];return s=e,[3,5];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,c=[],l=[],i&&o.indices.forEach(function(e){c.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))}),c.push(this.dropTableSql(o,t)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return t=e instanceof h.G?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,c=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).name=t,o=new f.A('ALTER TABLE "'+n.name+'" RENAME TO "'+t+'"'),s=new f.A('ALTER TABLE "'+t+'" RENAME TO "'+n.name+'"'),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.name=a.name,a.uniques.forEach(function(e){e.name=c.connection.namingStrategy.uniqueConstraintName(a,e.columnNames)}),a.foreignKeys.forEach(function(e){e.name=c.connection.namingStrategy.foreignKeyName(a,e.columnNames,e.referencedTableName,e.referencedColumnNames)}),a.indices.forEach(function(e){e.name=c.connection.namingStrategy.indexName(a,e.columnNames,e.where)}),[4,this.recreateTable(a,n)];case 5:return r.sent(),[2]}})})},t.prototype.addColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,this.addColumns(n,[t])]}})})},t.prototype.addColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addColumn(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.renameColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,s,c;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return a=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.D?t:i.columns.find(function(e){return e.name===t})))throw Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.D?c=n:(c=s.clone()).name=n,[2,this.changeColumn(i,s,c)]}})})},t.prototype.changeColumn=function(e,t,n){return(0,r.mG)(this,void 0,void 0,function(){var i,a,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return a=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.D?t:i.columns.find(function(e){return e.name===t})))throw Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return[4,this.changeColumns(i,[{oldColumn:s,newColumn:n}])];case 4:return r.sent(),[2]}})})},t.prototype.changeColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){e.newColumn.name!==e.oldColumn.name&&(a.findColumnUniques(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.uniqueConstraintName(a,t.columnNames)}),a.findColumnForeignKeys(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.foreignKeyName(a,t.columnNames,t.referencedTableName,t.referencedColumnNames)}),a.findColumnIndices(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.indexName(a,t.columnNames,t.where)}));var t=a.columns.find(function(t){return t.name===e.oldColumn.name});t&&(a.columns[a.columns.indexOf(t)]=e.newColumn)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropColumn=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.D?t:n.findColumnByName(t)))throw Error('Column "'+t+'" was not found in table "'+n.name+'"');return[4,this.dropColumns(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropColumns=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){a.removeColumn(e),a.findColumnUniques(e).forEach(function(e){return a.removeUniqueConstraint(e)}),a.findColumnIndices(e).forEach(function(e){return a.removeIndex(e)}),a.findColumnForeignKeys(e).forEach(function(e){return a.removeForeignKey(e)})}),[4,this.recreateTable(a,n)];case 4:return r.sent(),t.forEach(function(e){n.removeColumn(e),n.findColumnUniques(e).forEach(function(e){return n.removeUniqueConstraint(e)}),n.findColumnIndices(e).forEach(function(e){return n.removeIndex(e)}),n.findColumnForeignKeys(e).forEach(function(e){return n.removeForeignKey(e)})}),[2]}})})},t.prototype.createPrimaryKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),n.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}})})},t.prototype.dropPrimaryKey=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return n=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return(i=(t=n).clone()).primaryColumns.forEach(function(e){e.isPrimary=!1}),[4,this.recreateTable(i,t)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(n){switch(n.label){case 0:return[4,this.createUniqueConstraints(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addUniqueConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.v?t:n.uniques.find(function(e){return e.name===t})))throw Error("Supplied unique constraint was not found in table "+n.name);return[4,this.dropUniqueConstraints(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeUniqueConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(n){switch(n.label){case 0:return[4,this.createCheckConstraints(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addCheckConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof v.r?t:n.checks.find(function(e){return e.name===t})))throw Error("Supplied check constraint was not found in table "+n.name);return[4,this.dropCheckConstraints(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeCheckConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Sqlite does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Sqlite does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Sqlite does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){throw Error("Sqlite does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(n){switch(n.label){case 0:return[4,this.createForeignKeys(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addForeignKey(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.U?t:n.foreignKeys.find(function(e){return e.name===t})))throw Error("Supplied foreign key was not found in table "+n.name);return[4,this.dropForeignKeys(e,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeForeignKey(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.createIndex(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(e instanceof u.i))return[3,1];return i=e,[3,3];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.s?t:n.indices.find(function(e){return e.name===t})))throw Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.dropIndex(e,t)}))];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t=this;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return n.sent(),[4,this.startTransaction()];case 2:n.sent(),n.label=3;case 3:return n.trys.push([3,9,14,16]),[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 4:return[4,Promise.all(n.sent().map(function(e){return t.query(e.query)}))];case 5:return n.sent(),[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 6:return[4,Promise.all(n.sent().map(function(e){return t.query(e.query)}))];case 7:return n.sent(),[4,this.commitTransaction()];case 8:return n.sent(),[3,16];case 9:e=n.sent(),n.label=10;case 10:return n.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:case 12:return n.sent(),[3,13];case 13:throw e;case 14:return[4,this.query("PRAGMA foreign_keys = ON;")];case 15:return n.sent(),[7];case 16:return[2]}})})},t.prototype.loadViews=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:if(!r.sent())return[2,Promise.resolve([])];return t=e.map(function(e){return"'"+e+"'"}).join(", "),n='SELECT "t".* FROM "'+this.getTypeormMetadataTableName()+'" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = \'view\' WHERE "t"."type" = \'VIEW\'',t.length>0&&(n+=' AND "t"."name" IN ('+t+")"),[4,this.query(n)];case 2:return[2,r.sent().map(function(e){var t=new h.G;return t.name=e.name,t.expression=e.value,t})]}})})},t.prototype.loadTables=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a=this;return(0,r.Jh)(this,function(s){switch(s.label){case 0:if(!e||!e.length)return[2,[]];return t=e.map(function(e){return"'"+e+"'"}).join(", "),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" IN ('+t+")")];case 1:return n=s.sent(),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'index\' AND "tbl_name" IN ('+t+")")];case 2:if(i=s.sent(),!n||!n.length)return[2,[]];return[2,Promise.all(n.map(function(e){return(0,r.mG)(a,void 0,void 0,function(){var t,n,a,s,h,p,f,m,g,b,E,T,N,C,w,A,M,R=this;return(0,r.Jh)(this,function(S){switch(S.label){case 0:return t=new u.i({name:e.name}),n=e.sql,[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return s=(a=r.CR.apply(void 0,[S.sent(),3]))[0],h=a[1],p=a[2],f=void 0,-1!==(g=(m=e.sql).toUpperCase().indexOf("AUTOINCREMENT"))&&(b=(f=m.substr(0,g)).lastIndexOf(","),E=f.lastIndexOf("("),-1!==b?f=(f=(f=f.substr(b)).substr(0,f.lastIndexOf('"'))).substr(f.indexOf('"')+1):-1!==E&&(f=(f=(f=f.substr(E)).substr(0,f.lastIndexOf('"'))).substr(f.indexOf('"')+1))),t.columns=s.map(function(e){var t=new o.D;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=f===e.name,t.isGenerated&&(t.generationStrategy="increment"),"varchar"===t.type){var r=n.match(RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\\1\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));r&&(t.type="simple-enum",t.enum=r[2].substr(1,r[2].length-2).split("','"))}var i=t.type.indexOf("(");if(-1!==i){var a=t.type,s=a.substr(0,i);if(R.driver.withLengthColumnTypes.find(function(e){return e===s})){var u=parseInt(a.substring(i+1,a.length-1));u&&(t.length=u.toString(),t.type=s)}if(R.driver.withPrecisionColumnTypes.find(function(e){return e===s})){var c=RegExp("^"+s+"\\((\\d+),?\\s?(\\d+)?\\)"),l=a.match(c);l&&l[1]&&(t.precision=+l[1]),R.driver.withScaleColumnTypes.find(function(e){return e===s})&&l&&l[2]&&(t.scale=+l[2]),t.type=s}}return t}),T=y.s.uniq(p,function(e){return e.id}),t.foreignKeys=T.map(function(e){var n=p.filter(function(t){return t.id===e.id&&t.table===e.table}),r=n.map(function(e){return e.from}),i=n.map(function(e){return e.to}),a=R.connection.namingStrategy.foreignKeyName(t,r,e.referencedTableName,e.referencedColumnNames);return new l.U({name:a,columnNames:r,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})}),N=h.filter(function(e){return"u"===e.origin}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return(0,r.mG)(R,void 0,void 0,function(){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n=h.find(function(t){return t.name===e}),[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return 1===(i=r.sent().sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name})).length&&(a=t.columns.find(function(e){return!!i.find(function(t){return t===e.name})}))&&(a.isUnique=!0),[2,new d.v({name:this.connection.namingStrategy.uniqueConstraintName(t,i),columnNames:i})]}})})}),C=t,[4,Promise.all(N)];case 2:for(C.uniques=S.sent(),A=/CONSTRAINT "([^"]*)" CHECK (\(.*?\))([,]|[)]$)/g;null!==(w=A.exec(n));)t.checks.push(new v.r({name:w[1],expression:w[2]}));return[4,Promise.all(h.filter(function(e){return"c"===e.origin}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return(0,r.mG)(R,void 0,void 0,function(){var n,a,o,s,u;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return n=i.find(function(t){return t.name===e}),a=/WHERE (.*)/.exec(n.sql),o=h.find(function(t){return t.name===e}),[4,this.query('PRAGMA index_info("'+o.name+'")')];case 1:return s=r.sent().sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name}),u="1"===o.unique||1===o.unique,[2,new c.s({table:t,name:o.name,columnNames:s,isUnique:u,where:a?a[1]:void 0})]}})})}))];case 3:return M=S.sent(),t.indices=M.filter(function(e){return!!e}),[2,t]}})})}))]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.filter(function(e){return e.isPrimary}),i=r.find(function(e){return e.isGenerated&&"increment"===e.generationStrategy}),a=r.length>1;if(a&&i)throw Error("Sqlite does not support AUTOINCREMENT on composite primary key");var o=e.columns.map(function(e){return n.buildCreateColumnSql(e,a)}).join(", "),s='CREATE TABLE "'+e.name+'" ('+o;e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new d.v({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),e.uniques.length>0&&(s+=", "+e.uniques.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map(function(e){return'"'+e+'"'}).join(", ")+")"}).join(", ")),e.checks.length>0&&(s+=", "+e.checks.map(function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"}).join(", ")),e.foreignKeys.length>0&&t&&(s+=", "+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'"'+e+'"'}).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a}).join(", ")),r.length>1&&(s+=", PRIMARY KEY ("+r.map(function(e){return'"'+e.name+'"'}).join(", ")+")"),s+=")";var u=this.connection.entityMetadatas.find(function(t){return t.tableName===e.name});return u&&u.withoutRowid&&(s+=" WITHOUT ROWID"),new f.A(s)},t.prototype.dropTableSql=function(e,t){var n=e instanceof u.i?e.name:e;return new f.A(t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"')},t.prototype.createViewSql=function(e){return new f.A("string"==typeof e.expression?'CREATE VIEW "'+e.name+'" AS '+e.expression:'CREATE VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=(0,r.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new f.A(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof h.G?e.name:e;return new f.A('DROP VIEW "'+t+'"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof h.G?e.name:e,n=this.connection.createQueryBuilder(),i=(0,r.CR)(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape("type")+" = 'VIEW'").andWhere(n.escape("name")+" = :name",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new f.A(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'"'+e+'"'}).join(", ");return new f.A("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e){var t=e instanceof c.s?e.name:e;return new f.A('DROP INDEX "'+t+'"')},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return e instanceof s.T?n+=" "+this.driver.normalizeType(e):n+=" "+this.connection.driver.createFullType(e),e.enum&&(n+=" CHECK( "+e.name+" IN ("+e.enum.map(function(e){return"'"+e+"'"}).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n},t.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),(0,r.mG)(this,void 0,void 0,function(){var i,a,o,s,u=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return i=[],a=[],t.indices.forEach(function(e){i.push(u.dropIndexSql(e)),a.push(u.createIndexSql(t,e))}),e.name="temporary_"+e.name,i.push(this.createTableSql(e,!0)),a.push(this.dropTableSql(e)),n&&(o=e.columns.map(function(e){return'"'+e.name+'"'}).join(", "),s=t.columns.map(function(e){return'"'+e.name+'"'}).join(", "),t.columns.length<e.columns.length?o=e.columns.filter(function(e){return t.columns.find(function(t){return t.name===e.name})}).map(function(e){return'"'+e.name+'"'}).join(", "):t.columns.length>e.columns.length&&(s=t.columns.filter(function(t){return e.columns.find(function(e){return e.name===t.name})}).map(function(e){return'"'+e.name+'"'}).join(", ")),i.push(new f.A('INSERT INTO "'+e.name+'"('+o+") SELECT "+s+' FROM "'+t.name+'"')),a.push(new f.A('INSERT INTO "'+t.name+'"('+s+") SELECT "+o+' FROM "'+e.name+'"'))),i.push(this.dropTableSql(t)),a.push(this.createTableSql(t,!0)),i.push(new f.A('ALTER TABLE "'+e.name+'" RENAME TO "'+t.name+'"')),a.push(new f.A('ALTER TABLE "'+t.name+'" RENAME TO "'+e.name+'"')),e.name=t.name,e.indices.forEach(function(t){t.name||(t.name=u.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),i.push(u.createIndexSql(e,t)),a.push(u.dropIndexSql(t))}),[4,this.executeQueries(i,a)];case 1:return r.sent(),this.replaceCachedTable(t,e),[2]}})})},t}(m.Y)},2106:function(e,t,n){"use strict";n.d(t,{x:function(){return m}});var r=n(274),i=n(3595),a=n(5128),o=n(4726),s=n(4894),u=n(7316),c=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return(0,r.ZT)(t,e),t.prototype.commitTransaction=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}})})},t.prototype.query=function(e,t){var n=this;if(void 0===t&&(t=[]),this.isReleased)throw new a.Y;return new Promise(function(i,a){return(0,r.mG)(n,void 0,void 0,function(){var n,o,s,c,l,h;return(0,r.Jh)(this,function(r){n=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),o=+new Date;try{for(s=n.prepare(e),t&&(t=t.map(function(e){return void 0!==e?e:null}),s.bind(t)),c=this.driver.connection.options.maxQueryExecutionTime,l=+new Date-o,c&&l>c&&this.driver.connection.logger.logQuerySlow(l,e,t,this),h=[];s.step();)h.push(s.getAsObject());s.free(),i(h)}catch(n){s&&s.free(),this.driver.connection.logger.logQueryError(n,e,t,this),a(new u.O(e,t,n))}return[2]})})})},t}(o.J),l=n(6908),h=n(4547),p=n(418),f=n(5738),d=n(8764).Buffer,m=function(e){function t(t){var n=e.call(this,t)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new h.f("location or autoSaveCallback");return n.loadDependencies(),n}return(0,r.ZT)(t,e),t.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},t.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e=this;return(0,r.Jh)(this,function(t){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(e){n(e)}})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new c(this)),this.queryRunner},t.prototype.load=function(e,t){return void 0===t&&(t=!0),(0,r.mG)(this,void 0,void 0,function(){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if("string"!=typeof e)return[3,8];if("node"!==p.Qm.type)return[3,1];if(p.Qm.fileExist(e))return n=p.Qm.readFileSync(e),[2,this.createDatabaseConnectionWithImport(n)];if(!t)return[2,this.createDatabaseConnectionWithImport()];throw Error("File "+e+" does not exist");case 1:if(i=null,!this.options.useLocalForage)return[3,5];if(!window.localforage)return[3,3];return[4,window.localforage.getItem(e)];case 2:return i=r.sent(),[3,4];case 3:throw Error("localforage is not defined - please import localforage.js into your site");case 4:return[3,6];case 5:i=p.Qm.getGlobalVariable().localStorage.getItem(e),r.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(!t)return[2,this.createDatabaseConnectionWithImport()];throw Error("File "+e+" does not exist");case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}})})},t.prototype.save=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!e&&!this.options.location)throw Error("No location is set, specify a location parameter or add the location option to your configuration");if(t="",e?t=e:this.options.location&&(t=this.options.location),"node"!==p.Qm.type)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),n=d.from(this.databaseConnection.export()),[4,p.Qm.writeFile(t,n)];case 2:return r.sent(),[3,4];case 3:throw Error("Could not save database, error: "+r.sent());case 4:case 8:return[3,10];case 5:if(i=this.databaseConnection.export(),a=[].slice.call(i),!this.options.useLocalForage)return[3,9];if(!window.localforage)return[3,7];return[4,window.localforage.setItem(t,JSON.stringify(a))];case 6:return r.sent(),[3,8];case 7:throw Error("localforage is not defined - please import localforage.js into your site");case 9:p.Qm.getGlobalVariable().localStorage.setItem(t,JSON.stringify(a)),r.label=10;case 10:return[2]}})})},t.prototype.autoSave=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:if(!this.options.autoSave)return[3,4];if(!this.options.autoSaveCallback)return[3,2];return[4,this.options.autoSaveCallback(this.export())];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.export=function(){return this.databaseConnection.export()},t.prototype.createGeneratedMap=function(e,t){var n=this,r=e.generatedColumns.reduce(function(e,t){if(t.isPrimary&&"increment"===t.generationStrategy){var r="SELECT last_insert_rowid()";try{var i=n.databaseConnection.exec(r);return n.connection.logger.logQuery(r),f.s.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(e){n.connection.logger.logQueryError(e,r,[])}}return e},{});return Object.keys(r).length>0?r:void 0},t.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},t.prototype.createDatabaseConnectionWithImport=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if("function"!=typeof this.sqlite.Database)return[3,1];return n=this.sqlite,[3,3];case 1:return[4,this.sqlite(this.options.sqlJsConfig)];case 2:n=r.sent(),r.label=3;case 3:return t=n,e&&e.length>0?this.databaseConnection=new t.Database(e):this.databaseConnection=new t.Database,[2,new Promise(function(e,t){try{i.databaseConnection.exec("PRAGMA foreign_keys = ON;"),e(i.databaseConnection)}catch(e){t(e)}})]}})})},t.prototype.loadDependencies=function(){if("browser"===p.Qm.type)this.sqlite=window.SQL;else try{this.sqlite=p.Qm.load("sql.js")}catch(e){throw new l.z("sql.js","sql.js")}},t}(i.w)},9522:function(e,t,n){"use strict";n.d(t,{R:function(){return r}});var r=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]}},9772:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r=n(274),i=n(8198),a=n(6908),o=n(7677),s=n(31),u=n(8893),c=n(418),l=n(1014),h=n(9522),p=n(124),f=n(5738),d=n(8535),m=n(8764).Buffer,y=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","bigint","bit","decimal","money","numeric","smallint","smallmoney","tinyint","float","real","date","datetime2","datetime","datetimeoffset","smalldatetime","time","char","varchar","text","nchar","nvarchar","ntext","binary","image","varbinary","hierarchyid","sql_variant","timestamp","uniqueidentifier","xml","geometry","geography","rowversion"],this.spatialTypes=["geometry","geography"],this.withLengthColumnTypes=["char","varchar","nchar","nvarchar","binary","varbinary"],this.withPrecisionColumnTypes=["decimal","numeric","time","datetime2","datetimeoffset"],this.withScaleColumnTypes=["decimal","numeric"],this.mappedDataTypes={createDate:"datetime2",createDateDefault:"getdate()",updateDate:"datetime2",updateDateDefault:"getdate()",deleteDate:"datetime2",deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"nvarchar(MAX)",cacheResult:"nvarchar(MAX)",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"nvarchar(MAX)"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},binary:{length:1},varbinary:{length:1},decimal:{precision:18,scale:0},numeric:{precision:18,scale:0},time:{precision:7},datetime2:{precision:7},datetimeoffset:{precision:7}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!this.options.replication)return[3,3];return e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return(0,r.mG)(this,void 0,void 0,function(){var e=this;return(0,r.Jh)(this,function(t){switch(t.label){case 0:if(!this.master)return[2,Promise.reject(new i.y("mssql"))];return[4,this.closePool(this.master)];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.closePool=function(e){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(t){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new l.n(this.connection)},e.prototype.createQueryRunner=function(e){return new s.Y(this,e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"}).join("|");return[e=e.replace(RegExp(i,"g"),function(e){var n,i=!1;return(":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i)?n.map(function(e){return r.push(e),"@"+(r.length-1)}).join(", "):n instanceof Function?n():(r.push(n),"@"+(r.length-1))}),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){var r=e;return t&&(r=t+"."+e),n&&(r=t?n+"."+r:n+".."+e),r},e.prototype.preparePersistentValue=function(e,t){if(t.transformer&&(e=d.A.transformTo(t.transformer,e)),null==e)return e;if(t.type===Boolean)return!0===e?1:0;if("date"===t.type)return u.E.mixedDateToDate(e);if("time"===t.type)return u.E.mixedTimeToDate(e);if("datetime"===t.type||"smalldatetime"===t.type||t.type===Date)return u.E.mixedDateToDate(e,!1,!1);if("datetime2"===t.type||"datetimeoffset"===t.type)return u.E.mixedDateToDate(e,!1,!0);if("simple-array"===t.type)return u.E.simpleArrayToString(e);if("simple-json"===t.type)return u.E.simpleJsonToString(e);else if("simple-enum"===t.type)return u.E.simpleEnumToString(e);return e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?d.A.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"datetime2"===t.type||"smalldatetime"===t.type||"datetimeoffset"===t.type?e=u.E.normalizeHydratedDate(e):"date"===t.type?e=u.E.mixedDateToDateString(e):"time"===t.type?e=u.E.mixedTimeToString(e):"simple-array"===t.type?e=u.E.stringToSimpleArray(e):"simple-json"===t.type?e=u.E.stringToSimpleJson(e):"simple-enum"===t.type&&(e=u.E.stringToSimpleEnum(e,t)),t.transformer&&(e=d.A.transformFrom(t.transformer,e)),e)},e.prototype.normalizeType=function(e){if(e.type===Number||"integer"===e.type)return"int";if(e.type===String)return"nvarchar";if(e.type===Date)return"datetime";if(e.type===Boolean)return"bit";if(e.type===m)return"binary";if("uuid"===e.type)return"uniqueidentifier";if("simple-array"===e.type||"simple-json"===e.type)return"ntext";else if("simple-enum"===e.type)return"nvarchar";else if("dec"===e.type)return"decimal";else if("double precision"===e.type)return"float";else if("rowversion"===e.type)return"timestamp";else return e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?!0===t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():"varchar"===e.type||"nvarchar"===e.type||e.type===String?"255":""},e.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},e.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},e.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&f.s.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{})},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&n.lowerDefaultValueIfNessesary(n.normalizeDefault(t))!==n.lowerDefaultValueIfNessesary(r.default)||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||r.isGenerated!==t.isGenerated)})},e.prototype.lowerDefaultValueIfNessesary=function(e){return e?e.split("'").map(function(e,t){return t%2==1?e:e.toLowerCase()}).join("'"):e},e.prototype.isReturningSqlSupported=function(){return!this.options.options||!this.options.options.disableOutputReturning},e.prototype.isUUIDGenerationSupported=function(){return!0},e.prototype.isFullTextColumnTypeSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"@"+t},e.prototype.parametrizeValue=function(e,t){if(t instanceof h.R)return t;var n=this.normalizeType({type:e.type});return e.length?new h.R(t,n,e.length):null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?new h.R(t,n,e.precision,e.scale):null!==e.precision&&void 0!==e.precision?new h.R(t,n,e.precision):null!==e.scale&&void 0!==e.scale?new h.R(t,n,e.scale):new h.R(t,n)},e.prototype.parametrizeMap=function(e,t){var n=this;if(!this.connection.hasMetadata(e))return t;var r=this.connection.getMetadata(e);return Object.keys(t).reduce(function(e,i){var a=t[i],o=r.findColumnWithDatabaseName(i);return o?(e[i]=n.parametrizeValue(o,a),e):a},{})},e.prototype.buildTableVariableDeclaration=function(e,t){var n=this;return"DECLARE "+e+" TABLE ("+t.map(function(e){return n.escape(e.databaseName)+" "+n.createFullType(new p.D({name:e.databaseName,type:n.normalizeType(e),length:e.length,isNullable:e.isNullable,isArray:e.isArray}))}).join(", ")+")"},e.prototype.loadDependencies=function(){try{this.mssql=c.Qm.load("mssql")}catch(e){throw new a.z("SQL Server","mssql")}},e.prototype.createPool=function(e,t){var n=this;t=Object.assign({},t,o.z.buildDriverOptions(t));var r=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return r.options?r.options.useUTC||(r.options.useUTC=!1):r.options={useUTC:!1},new Promise(function(t,i){var a=new n.mssql.ConnectionPool(r),o=n.connection.logger,s=e.pool&&e.pool.errorHandler||function(e){return o.log("warn","MSSQL pool raised an error. "+e)};a.on("error",s);var u=a.connect(function(e){if(e)return i(e);t(u)})})},e}()},4962:function(e,t,n){"use strict";n.d(t,{I:function(){return r}});var r=function(e){this.options=e}},8198:function(e,t,n){"use strict";n.d(t,{y:function(){return i}});var r=n(274),i=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionIsNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Connection with "+n+" database is not established. Check connection configuration.",r}return(0,r.ZT)(t,e),t}(Error)},4547:function(e,t,n){"use strict";n.d(t,{f:function(){return i}});var r=n(274),i=function(e){function t(n){var r=e.call(this)||this;return r.name="DriverOptionNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Driver option ("+n+") is not set. Please set it to perform connection to the database.",r}return(0,r.ZT)(t,e),t}(Error)},6908:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var r=n(274),i=function(e){function t(n,r){var i=e.call(this)||this;return i.name="DriverPackageNotInstalledError",Object.setPrototypeOf(i,t.prototype),i.message=n+" package has not been found installed. Try to install it: npm install "+r+" --save",i}return(0,r.ZT)(t,e),t}(Error)},5072:function(e,t,n){"use strict";n.d(t,{n:function(){return i}});var r=n(274),i=function(e){function t(n){var r=e.call(this)||this;return r.name="EntityColumnNotFound",Object.setPrototypeOf(r,t.prototype),r.message='No entity column "'+n+'" was found.',r}return(0,r.ZT)(t,e),t}(Error)},497:function(e,t,n){"use strict";n.d(t,{E:function(){return a}});var r=n(274),i=n(4678),a=function(e){function t(n,r){var a,o=e.call(this)||this;o.name="EntityNotFound",Object.setPrototypeOf(o,t.prototype),a=n instanceof i.IU?n.options.name:"function"==typeof n?n.name:"object"==typeof n&&"name"in n?n.name:n;var s=o.stringifyCriteria(r);return o.message='Could not find any entity of type "'+a+'" matching: '+s,o}return(0,r.ZT)(t,e),t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e},t}(Error)},2270:function(e,t,n){"use strict";n.d(t,{T:function(){return i}});var r=n(274),i=function(e){function t(){var n=e.call(this)||this;return n.name="LimitOnUpdateNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="Your database does not support LIMIT on UPDATE statements.",n}return(0,r.ZT)(t,e),t}(Error)},7316:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});var r=n(274),i=n(7264),a=function(e){function t(n,a,o){var s=e.call(this)||this;return Object.setPrototypeOf(s,t.prototype),s.message=o.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""),i.g.assign(s,(0,r.pi)((0,r.pi)({},o),{name:"QueryFailedError",query:n,parameters:a||[]})),s}return(0,r.ZT)(t,e),t}(Error)},5128:function(e,t,n){"use strict";n.d(t,{Y:function(){return i}});var r=n(274),i=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Query runner already released. Cannot run queries anymore.",n}return(0,r.ZT)(t,e),t}(Error)},581:function(e,t,n){"use strict";n.d(t,{y:function(){return i}});var r=n(274),i=function(e){function t(){var n=e.call(this)||this;return n.name="ReturningStatementNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.",n}return(0,r.ZT)(t,e),t}(Error)},8956:function(e,t,n){"use strict";n.d(t,{S:function(){return i}});var r=n(274),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionAlreadyStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction already started for the given connection, commit current transaction before starting a new one.",n}return(0,r.ZT)(t,e),t}(Error)},6556:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var r=n(274),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionNotStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction is not started yet, start transaction before committing or rolling it back.",n}return(0,r.ZT)(t,e),t}(Error)},210:function(e,t,n){"use strict";n.d(t,{y:function(){return i}});var r=n(274),i=function(e){function t(){var n=e.call(this)||this;return n.name="UpdateValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.',n}return(0,r.ZT)(t,e),t}(Error)},4759:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});var r=function(){function e(e,t,n,r,i,a){void 0===n&&(n=!0),void 0===r&&(r=!1),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r,this._getSql=i,this._objectLiteralParameters=a}return Object.defineProperty(e.prototype,"useParameter",{get:function(){return this._value instanceof e?this._value.useParameter:this._useParameter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleParameters",{get:function(){return this._value instanceof e?this._value.multipleParameters:this._multipleParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value instanceof e?this._value.value:this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectLiteralParameters",{get:function(){return this._value instanceof e?this._value.objectLiteralParameters:this._objectLiteralParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"child",{get:function(){if(this._value instanceof e)return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getSql",{get:function(){return this._value instanceof e?this._value.getSql:this._getSql},enumerable:!0,configurable:!0}),e}()},8518:function(e,t,n){"use strict";n.d(t,{In:function(){return i}});var r=n(4759);function i(e){return new r.J("in",e,!0,!0)}},4678:function(e,t,n){"use strict";n.d(t,{sg:function(){return tA},JH:function(){return tx},IU:function(){return ti.I},gm:function(){return tP},Q2:function(){return tR},hA:function(){return tS},IF:function(){return tO},bs:function(){return tM},Od:function(){return eM.O},B5:function(){return tD},vJ:function(){return tI}}),n(8660);var r,i,a,o,s=n(274),u=n(8664),c=n(5022),l=n(5838),h=function(){function e(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}return e.prototype.tableName=function(e,t){return t||(0,c.fu)(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){var r=t||e;return n.length?(0,c.eV)(n.join("_"))+(0,c.Qs)(r):r},e.prototype.relationName=function(e){return e},e.prototype.primaryKeyName=function(e,t){var n=(0,s.fl)(t);n.sort();var r=(e instanceof l.i?e.name:e).replace(".","_")+"_"+n.join("_");return"PK_"+u.f.sha1(r).substr(0,27)},e.prototype.uniqueConstraintName=function(e,t){var n=(0,s.fl)(t);n.sort();var r=(e instanceof l.i?e.name:e).replace(".","_")+"_"+n.join("_");return"UQ_"+u.f.sha1(r).substr(0,27)},e.prototype.relationConstraintName=function(e,t,n){var r=(0,s.fl)(t);r.sort();var i=(e instanceof l.i?e.name:e).replace(".","_")+"_"+r.join("_");return n&&(i+="_"+n),"REL_"+u.f.sha1(i).substr(0,26)},e.prototype.defaultConstraintName=function(e,t){var n=(e instanceof l.i?e.name:e).replace(".","_");return"DF_"+u.f.sha1(n+"_"+t).substr(0,27)},e.prototype.foreignKeyName=function(e,t,n,r){var i=(0,s.fl)(t);i.sort();var a=(e instanceof l.i?e.name:e).replace(".","_")+"_"+i.join("_");return"FK_"+u.f.sha1(a).substr(0,27)},e.prototype.indexName=function(e,t,n){var r=(0,s.fl)(t);r.sort();var i=(e instanceof l.i?e.name:e).replace(".","_")+"_"+r.join("_");return n&&(i+="_"+n),"IDX_"+u.f.sha1(i).substr(0,26)},e.prototype.checkConstraintName=function(e,t){var n=(e instanceof l.i?e.name:e).replace(".","_");return"CHK_"+u.f.sha1(n+"_"+t).substr(0,26)},e.prototype.exclusionConstraintName=function(e,t){var n=(e instanceof l.i?e.name:e).replace(".","_");return"XCL_"+u.f.sha1(n+"_"+t).substr(0,26)},e.prototype.joinColumnName=function(e,t){return(0,c.eV)(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,r){return(0,c.fu)(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return(0,c.eV)(e+"_"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.prefixTableName=function(e,t){return e+t},e.prototype.eagerJoinRelationAlias=function(e,t){return e+"_"+t.replace(".","_")},e}(),p=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotExecuteNotConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot execute operation on "'+n+'" connection because connection is not yet established.',r}return(0,s.ZT)(t,e),t}(Error),f=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotConnectAlreadyConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a "'+n+'" connection because connection to the database already established.',r}return(0,s.ZT)(t,e),t}(Error),d=function(e){function t(n){var r,i=e.call(this)||this;return i.name="EntityMetadataNotFound",Object.setPrototypeOf(i,t.prototype),r=n instanceof ti.I?n.options.name:"function"==typeof n?n.name:"object"==typeof n&&"name"in n?n.name:n,i.message='No metadata for "'+r+'" was found.',i}return(0,s.ZT)(t,e),t}(Error),m=function(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r},y=n(9772),v=n(9522),g=n(7089),b=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.transaction="all";var n=this.connection.driver.options;this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n.schema,n.database)}return e.prototype.executeMigration=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t=this;return(0,s.Jh)(this,function(n){return[2,this.withQueryRunner(function(n){return(0,s.mG)(t,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,this.createMigrationsTableIfNotExist(n)];case 1:return t.sent(),[4,e.instance.up(n)];case 2:return t.sent(),[4,this.insertExecutedMigration(n,e)];case 3:return t.sent(),[2,e]}})})})]})})},e.prototype.getAllMigrations=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return[2,Promise.resolve(this.getMigrations())]})})},e.prototype.getExecutedMigrations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,this.withQueryRunner(function(t){return(0,s.mG)(e,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:return[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:return[2,e.sent()]}})})})]})})},e.prototype.getPendingMigrations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,this.getAllMigrations()];case 1:return e=n.sent(),[4,this.getExecutedMigrations()];case 2:return t=n.sent(),[2,e.filter(function(e){return!t.find(function(t){return t.name===e.name})})]}})})},e.prototype.insertMigration=function(e){var t=this;return new Promise(function(n,r){t.withQueryRunner(function(i){t.insertExecutedMigration(i,e).then(n).catch(r)})})},e.prototype.deleteMigration=function(e){var t=this;return new Promise(function(n,r){t.withQueryRunner(function(i){t.deleteExecutedMigration(i,e).then(n).catch(r)})})},e.prototype.showMigrations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u,c,l,h;return(0,s.Jh)(this,function(p){switch(p.label){case 0:return e=!1,t=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(t)];case 1:return p.sent(),[4,this.loadExecutedMigrations(t)];case 2:n=p.sent(),r=this.getMigrations(),i=function(t){n.find(function(e){return e.name===t.name})?a.connection.logger.logSchemaBuild(" [X] "+t.name):(e=!0,a.connection.logger.logSchemaBuild(" [ ] "+t.name))},a=this;try{for(u=(o=(0,s.XA)(r)).next();!u.done;u=o.next())c=u.value,i(c)}catch(e){l={error:e}}finally{try{u&&!u.done&&(h=o.return)&&h.call(o)}finally{if(l)throw l.error}}if(this.queryRunner)return[3,4];return[4,t.release()];case 3:p.sent(),p.label=4;case 4:return[2,e]}})})},e.prototype.executePendingMigrations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u,c,l,h,p,f,d,m=this;return(0,s.Jh)(this,function(y){switch(y.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return y.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=y.sent(),n=this.getLatestTimestampMigration(t),r=this.getMigrations(),i=[],(a=r.filter(function(e){return!t.find(function(t){return t.name===e.name})})).length)return[3,5];if(this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner)return[3,4];return[4,e.release()];case 3:y.sent(),y.label=4;case 4:return[2,[]];case 5:if(this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(r.length+" migrations were found in the source code."),n&&this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(a.length+" migrations are new migrations that needs to be executed."),o=!1,!("all"===this.transaction&&!e.isTransactionActive))return[3,7];return[4,e.startTransaction()];case 6:y.sent(),o=!0,y.label=7;case 7:y.trys.push([7,18,23,26]),u=function(t){return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!("each"===c.transaction&&!e.isTransactionActive))return[3,2];return[4,e.startTransaction()];case 1:n.sent(),o=!0,n.label=2;case 2:return[4,t.instance.up(e).then(function(){return(0,s.mG)(m,void 0,void 0,function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,this.insertExecutedMigration(e,t)];case 1:if(n.sent(),!("each"===this.transaction&&o))return[3,3];return[4,e.commitTransaction()];case 2:n.sent(),n.label=3;case 3:return[2]}})})}).then(function(){i.push(t),m.connection.logger.logSchemaBuild("Migration "+t.name+" has been executed successfully.")})];case 3:return n.sent(),[2]}})},c=this,y.label=8;case 8:y.trys.push([8,13,14,15]),h=(l=(0,s.XA)(a)).next(),y.label=9;case 9:if(h.done)return[3,12];return[5,u(h.value)];case 10:y.sent(),y.label=11;case 11:return h=l.next(),[3,9];case 12:return[3,15];case 13:return f={error:y.sent()},[3,15];case 14:try{h&&!h.done&&(d=l.return)&&d.call(l)}finally{if(f)throw f.error}return[7];case 15:if(!("all"===this.transaction&&o))return[3,17];return[4,e.commitTransaction()];case 16:y.sent(),y.label=17;case 17:return[3,26];case 18:if(p=y.sent(),!o)return[3,22];y.label=19;case 19:return y.trys.push([19,21,,22]),[4,e.rollbackTransaction()];case 20:case 21:return y.sent(),[3,22];case 22:throw p;case 23:if(this.queryRunner)return[3,25];return[4,e.release()];case 24:y.sent(),y.label=25;case 25:return[7];case 26:return[2,i]}})})},e.prototype.undoLastMigration=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a;return(0,s.Jh)(this,function(o){switch(o.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return o.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=o.sent(),!(n=this.getLatestExecutedMigration(t)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(!(r=this.getMigrations().find(function(e){return e.name===n.name})))throw Error("No migration "+n.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");if(this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),i=!1,!("none"!==this.transaction&&!e.isTransactionActive))return[3,4];return[4,e.startTransaction()];case 3:o.sent(),i=!0,o.label=4;case 4:return o.trys.push([4,9,14,17]),[4,r.instance.down(e)];case 5:return o.sent(),[4,this.deleteExecutedMigration(e,r)];case 6:if(o.sent(),this.connection.logger.logSchemaBuild("Migration "+r.name+" has been reverted successfully."),!i)return[3,8];return[4,e.commitTransaction()];case 7:o.sent(),o.label=8;case 8:return[3,17];case 9:if(a=o.sent(),!i)return[3,13];o.label=10;case 10:return o.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:case 12:return o.sent(),[3,13];case 13:throw a;case 14:if(this.queryRunner)return[3,16];return[4,e.release()];case 15:o.sent(),o.label=16;case 16:return[7];case 17:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(this.connection.driver instanceof g.Qd)return[2];return[4,e.hasTable(this.migrationsTable)];case 1:if(t.sent())return[3,3];return[4,e.createTable(new l.i({name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:t.sent(),t.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(!(this.connection.driver instanceof g.Qd))return[3,2];return[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()];case 1:return[2,t.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,t.sent().map(function(e){return new m(parseInt(e.id),parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){var e=this.connection.migrations.map(function(e){var t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw Error(t+" migration name is wrong. Migration class name should have a JavaScript timestamp appended.");return new m(void 0,n,t,e)});return this.checkForDuplicateMigrations(e),e.sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.checkForDuplicateMigrations=function(e){var t=e.map(function(e){return e.name}),n=Array.from(new Set(t.filter(function(e,n){return t.indexOf(e)<n})));if(n.length>0)throw Error("Duplicate migrations: "+n.join(", "))},e.prototype.getLatestTimestampMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-((e.timestamp-t.timestamp)*1)});return t.length>0?t[0]:void 0},e.prototype.getLatestExecutedMigration=function(e){return e.length>0?e[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if(n={},this.connection.driver instanceof y.Z?(n.timestamp=new v.R(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new v.R(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),!(this.connection.driver instanceof g.Qd))return[3,2];return[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insert(n)];case 1:return r.sent(),[3,4];case 2:return[4,e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}})})},e.prototype.deleteExecutedMigration=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:if(n={},this.connection.driver instanceof y.Z?(n.timestamp=new v.R(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new v.R(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),!(this.connection.driver instanceof g.Qd))return[3,2];return[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)];case 1:return i.sent(),[3,4];case 2:return[4,(r=e.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(r.escape("timestamp")+" = :timestamp").andWhere(r.escape("name")+" = :name").setParameters(n).execute()];case 3:i.sent(),i.label=4;case 4:return[2]}})})},e.prototype.withQueryRunner=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:t=this.queryRunner||this.connection.createQueryRunner(),n.label=1;case 1:return n.trys.push([1,,2,5]),[2,e(t)];case 2:if(this.queryRunner)return[3,4];return[4,t.release()];case 3:n.sent(),n.label=4;case 4:return[7];case 5:return[2]}})})},e}(),E=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingPrimaryColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',r}return(0,s.ZT)(t,e),t}(Error),T=function(e){function t(n){var r=e.call(this)||this;return r.name="CircularRelationsError",Object.setPrototypeOf(r,t.prototype),r.message="Circular relations detected: "+n+". To resolve this issue you need to set nullable: true somewhere in this dependency structure.",r}return(0,s.ZT)(t,e),t}(Error);function N(e,t,n){var r=[],i={};return function a(o){i[o]=!0,r.push(o),e[o].forEach(function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),Error("Dependency Cycle Found: "+r.join(" -> "))}else a(e)}),r.pop(),t&&0!==e[o].length||-1!==n.indexOf(o)||n.push(o)}}var C=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2==arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(this.hasNode(e))this.nodes[e]=t;else throw Error("Node does not exist: "+e)},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw Error("Node does not exist: "+e);if(!this.hasNode(t))throw Error("Node does not exist: "+t);return -1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];N(this.outgoingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];N(this.incomingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=N(this.outgoingEdges,!1,[]);r.forEach(function(e){i(e)});var a=N(this.outgoingEdges,e,n);return r.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),n},e}(),w=function(e){function t(n,r,i){var a=e.call(this)||this;a.name="DataTypeNotSupportedError",Object.setPrototypeOf(a,t.prototype);var o="string"==typeof r?r:r.name;return a.message='Data type "'+o+'" in "'+n.entityMetadata.targetName+"."+n.propertyName+'" is not supported by "'+i+'" database.',a}return(0,s.ZT)(t,e),t}(Error),A=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Option "'+n+'" is not set in your connection options, please define "'+n+'" option in your connection options or ormconfig.json',r}return(0,s.ZT)(t,e),t}(Error),M=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "'+n.entityMetadata.targetName+"#"+n.propertyPath+'". This is ORM requirement to make relations to work properly. Refer docs for more information.',r}return(0,s.ZT)(t,e),t}(Error),R=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach(function(r){return n.validate(r,e,t)}),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new E(e);if("STI"===e.inheritancePattern||"entity-child"===e.tableType){if(!e.discriminatorColumn)throw Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?");if(void 0===e.discriminatorValue)throw Error("Entity "+e.name+" has an undefined discriminator value. Discriminator value should be defined.");var r=t.find(function(t){return t!==e&&("STI"===t.inheritancePattern||"entity-child"===t.tableType)&&t.discriminatorValue===e.discriminatorValue&&t.inheritanceTree.some(function(t){return -1!==e.inheritanceTree.indexOf(t)})});if(r)throw Error("Entities "+e.name+" and "+r.name+" have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.")}if(e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),n instanceof g.Qd||e.columns.forEach(function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new w(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw Error("Column "+t.propertyName+" of Entity "+e.name+" does not support length property.")}),(n instanceof g.p$||n instanceof g.xI)&&e.columns.filter(function(e){return e.isGenerated&&"uuid"!==e.generationStrategy}).length>1)throw Error("Error in "+e.name+" entity. There can be only one auto-increment column in MySql table.");if(n instanceof g.p$&&0===t.filter(function(e){return e.database}).length&&!n.database)throw new A("database");if(n instanceof y.Z&&e.columns.filter(function(e){return e.charset}).length>1)throw Error("Character set specifying is not supported in Sql Server");var i=e.create();e.relations.forEach(function(e){if((e.isManyToMany||e.isOneToMany)&&!1!==e.persistenceEnabled&&Array.isArray(e.getEntityValue(i)))throw new M(e)}),e.relations.forEach(function(e){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")}),e.eagerRelations.forEach(function(e){})},e.prototype.validateDependencies=function(e){var t=new C;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new T(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach(function(e){e.eagerRelations.forEach(function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw Error("Circular eager relations are disallowed. "+e.targetName+"#"+t.propertyPath+' contains "eager: true", and its inverse side '+t.inverseEntityMetadata.targetName+"#"+t.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')})})},e}(),S=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerProviderAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",n}return(0,s.ZT)(t,e),t}(Error),O=n(497),x=function(e){function t(){var n=e.call(this)||this;return n.name="NoNeedToReleaseEntityManagerError",Object.setPrototypeOf(n,t.prototype),n.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",n}return(0,s.ZT)(t,e),t}(Error),P=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.manager).merge.apply(t,(0,s.fl)([this.metadata.target,e],n))},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.softRemove=function(e,t){return this.manager.softRemove(this.metadata.target,e,t)},e.prototype.recover=function(e,t){return this.manager.recover(this.metadata.target,e,t)},e.prototype.insert=function(e){return this.manager.insert(this.metadata.target,e)},e.prototype.update=function(e,t){return this.manager.update(this.metadata.target,e,t)},e.prototype.delete=function(e){return this.manager.delete(this.metadata.target,e)},e.prototype.softDelete=function(e){return this.manager.softDelete(this.metadata.target,e)},e.prototype.restore=function(e){return this.manager.restore(this.metadata.target,e)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e.prototype.increment=function(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)},e.prototype.decrement=function(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)},e}(),I=n(3595),D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.findTrees=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t=this;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return[4,Promise.all((e=n.sent()).map(function(e){return t.findDescendantsTree(e)}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,this.metadata.primaryColumns[0].propertyName);return this.createQueryBuilder("treeEntity").where(this.manager.connection.driver.escape("treeEntity")+"."+this.manager.connection.driver.escape(e)+" IS NULL").getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)};if("closure-table"===this.metadata.treeType){var a=this.metadata.closureJunctionTable.descendantColumns.map(function(n){return i(t)+"."+i(n.propertyPath)+" = "+i(e)+"."+i(n.referencedColumn.propertyPath)}).join(" AND "),o={},s=this.metadata.closureJunctionTable.ancestorColumns.map(function(e){return o[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+"."+i(e.propertyPath)+" = :"+e.referencedColumn.propertyName}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(s).setParameters(o)}if("nested-set"===this.metadata.treeType){var s=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath,u={},a=this.metadata.treeParentRelation.joinColumns.map(function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return u[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",s).where(a,u)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return(t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof I.w)?e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE "+i.getQuery()+" || '%'":e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE CONCAT("+i.getQuery()+", '%')"});throw Error("Supported only in tree entities")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this;if("closure-table"===this.metadata.treeType){var i=this.metadata.closureJunctionTable.ancestorColumns.map(function(n){return t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath}).join(" AND "),a={},o=this.metadata.closureJunctionTable.descendantColumns.map(function(e){return a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(o).setParameters(a)}if("nested-set"===this.metadata.treeType){var i="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath,s={},o=this.metadata.treeParentRelation.joinColumns.map(function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return s[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",i).where(o,s)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return(t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof I.w)?i.getQuery()+" LIKE "+e+"."+r.metadata.materializedPathColumn.propertyPath+" || '%'":i.getQuery()+" LIKE CONCAT("+e+"."+r.metadata.materializedPathColumn.propertyPath+", '%')"});throw Error("Supported only in tree entities")},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){var r=n.metadata.treeParentRelation.joinColumns[0],i=r.givenDatabaseName||r.databaseName,a=t[e+"_"+n.metadata.primaryColumns[0].databaseName],o=t[e+"_"+i];return{id:n.manager.connection.driver.prepareHydratedValue(a,n.metadata.primaryColumns[0]),parentId:n.manager.connection.driver.prepareHydratedValue(o,r)}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.filter(function(e){return e.parentId===a}),s=new Set(o.map(function(e){return e.id}));e[i]=t.filter(function(e){return s.has(e[r.metadata.primaryColumns[0].propertyName])}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.find(function(e){return e.id===a}),s=t.find(function(e){return!!o&&e[r.metadata.primaryColumns[0].propertyName]===o.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(P),q=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),1===n.length?r.message='Relation "'+n[0]+'" was not found; please check if it is correct and really exists in your entity.':r.message="Relations "+n.map(function(e){return'"'+e+'"'}).join(", ")+" were not found; please check if relations are correct and they exist in your entities.",r}return(0,s.ZT)(t,e),t}(Error),_=function(){function e(){}return e.isFindOneOptions=function(e){return e&&(Array.isArray(e.select)||e.where instanceof Object||"string"==typeof e.where||Array.isArray(e.relations)||e.join instanceof Object||e.order instanceof Object||e.cache instanceof Object||"boolean"==typeof e.cache||"number"==typeof e.cache||e.lock instanceof Object||e.loadRelationIds instanceof Object||"boolean"==typeof e.loadRelationIds||"boolean"==typeof e.loadEagerRelations||"boolean"==typeof e.withDeleted||"boolean"==typeof e.transaction)},e.isFindManyOptions=function(e){return e&&(this.isFindOneOptions(e)||"number"==typeof e.skip||"number"==typeof e.take||"string"==typeof e.skip||"string"==typeof e.take)},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t)||(!0===t.transaction&&(e.expressionMap.useTransaction=!0),!e.expressionMap.mainAlias||!e.expressionMap.mainAlias.hasMetadata))return e;var n=e.expressionMap.mainAlias.metadata;if(t.select&&(e.select([]),t.select.forEach(function(t){if(!n.findColumnWithPropertyPath(String(t)))throw Error(t+" column was not found in the "+n.name+" entity.");e.addSelect(e.alias+"."+t)})),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(r){var i=t.order[r];if(!n.findColumnWithPropertyPath(r))throw Error(r+" column was not found in the "+n.name+" entity.");switch(i){case 1:case"ASC":e.addOrderBy(e.alias+"."+r,"ASC");break;case -1:case"DESC":e.addOrderBy(e.alias+"."+r,"DESC")}}),t.relations){var r=t.relations.map(function(e){return e});if(this.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new q(r)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),t.cache){if(t.cache instanceof Object){var i=t.cache;e.cache(i.id,i.milliseconds)}else e.cache(t.cache)}return t.lock&&("optimistic"===t.lock.mode?e.setLock(t.lock.mode,t.lock.version):("pessimistic_read"===t.lock.mode||"pessimistic_write"===t.lock.mode||"dirty_read"===t.lock.mode||"pessimistic_partial_write"===t.lock.mode||"pessimistic_write_or_fail"===t.lock.mode)&&e.setLock(t.lock.mode)),t.withDeleted&&e.withDeleted(),!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),e},e.applyRelationsRecursively=function(e,t,n,r,i){var a=this,o=[];if(i){var s=RegExp("^"+i.replace(".","\\.")+"\\.");o=t.filter(function(e){return e.match(s)}).map(function(e){return e.replace(s,"")}).filter(function(e){return r.findRelationWithPropertyPath(e)})}else o=t.filter(function(e){return r.findRelationWithPropertyPath(e)});o.forEach(function(o){var s=n+"__"+o;e.connection.driver.maxAliasLength&&s.length>e.connection.driver.maxAliasLength&&(s=(0,c.OV)(s));var u=n+"."+o;e.leftJoinAndSelect(u,s);var l=r.relations.find(function(e){return e.propertyName===o});l&&a.joinEagerRelations(e,s,l.inverseEntityMetadata),t.splice(t.indexOf(i?i+"."+o:o),1);var h=e.expressionMap.joinAttributes.find(function(e){return e.entityOrProperty===u});a.applyRelationsRecursively(e,t,h.alias.name,h.metadata,i?i+"."+o:o)})},e.joinEagerRelations=function(e,t,n){var r=this;n.eagerRelations.forEach(function(n){var i=e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath);e.leftJoinAndSelect(t+"."+n.propertyPath,i),r.joinEagerRelations(e,i,n.inverseEntityMetadata)})},e}(),j=function(){function e(){}return e.prototype.transform=function(e,t,n,r){return void 0===r&&(r=!1),this.groupAndTransform(e,t,n,r),e},e.prototype.groupAndTransform=function(e,t,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach(function(n){var r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)}),n.relations.length&&n.relations.forEach(function(n){var a=n.getEntityValue(e),o=n.getEntityValue(t,r);if(void 0!==o){if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(o))return;a||(a=[],n.setEntityValue(e,a)),o.forEach(function(e){var t=a.find(function(t){return n.inverseEntityMetadata.compareEntities(e,t)});t||(t=n.inverseEntityMetadata.create(),a.push(t)),i.groupAndTransform(t,e,n.inverseEntityMetadata,r)})}else{if(!(o instanceof Object)){a instanceof Object||n.setEntityValue(e,o);return}a||(a=n.inverseEntityMetadata.create(),n.setEntityValue(e,a)),i.groupAndTransform(a,o,n.inverseEntityMetadata,r)}}})},e}(),L=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e}(),B=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.metadata.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),U=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,s.Jh)(this,function(a){switch(a.label){case 0:if(!t.hasAllPrimaryKeys(e))return[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];return n=new B,(r=function(e,i,a,o){var u=new L(e,i,a,o);n.addLoadMap(u),i.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!=e}).forEach(function(e){var t=(0,s.CR)(e,3),n=t[0];return r(t[1],t[2],u,n)})})(e,t),[4,Promise.all(n.groupByTargetIds().map(function(e){return i.manager.findByIds(e.target,e.ids).then(function(t){return n.fillEntities(e.target,t)})}))];case 1:return a.sent(),n.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}})})},e}(),F=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",r}return(0,s.ZT)(t,e),t}(Error),J=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryDoesNotHaveEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ",r}return(0,s.ZT)(t,e),t}(Error),k=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new J(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new J(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new J(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=tI().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new F(e);return t.entity},e}(),G=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryCannotInheritRepositoryError",Object.setPrototypeOf(r,t.prototype),r.message="Custom entity repository "+(n instanceof Function?n.name:n.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.",r}return(0,s.ZT)(t,e),t}(Error),V=function(e){function t(n,r){var i,a=e.call(this)||this;return a.name="RepositoryNotFoundError",Object.setPrototypeOf(a,t.prototype),i=r instanceof ti.I?r.options.name:"function"==typeof r?r.name:"object"==typeof r&&"name"in r?r.name:r,a.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+n+'" connection?',a}return(0,s.ZT)(t,e),t}(Error),Q=function(e){function t(n){var r,i=e.call(this)||this;return i.name="RepositoryNotTreeError",Object.setPrototypeOf(i,t.prototype),r=n instanceof ti.I?n.options.name:"function"==typeof n?n.name:"object"==typeof n&&"name"in n?n.name:n,i.message='Repository of the "'+r+'" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',i}return(0,s.ZT)(t,e),t}(Error),K=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.treeType){var r=new D;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}var r=void 0;return Object.assign(r=e.connection.driver instanceof g.Qd?new g.yX:new P,{manager:e,metadata:t,queryRunner:n}),r},e}(),z=function(e){function t(n){var r=e.call(this)||this;return r.name="TreeRepositoryNotSupportedError",Object.setPrototypeOf(r,t.prototype),r.message="Tree repositories are not supported in "+n.options.type+" driver.",r}return(0,s.ZT)(t,e),t}(Error),W=function(e){function t(n,r){var i=e.call(this)||this;return i.name="MustBeEntityError",Object.setPrototypeOf(i,t.prototype),i.message="Cannot "+n+', given value must be an entity, instead "'+r+'" is given.',i}return(0,s.ZT)(t,e),t}(Error),Y=n(7349),H=function(){function e(e){this.subjects=(0,s.fl)(e),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var n=[];if("delete"===e){var r=this.subjects.filter(function(e){return!e.entity&&!e.databaseEntity});n.push.apply(n,(0,s.fl)(r)),this.removeAlreadySorted(r)}var i=this.getNonNullableDependencies(),a=this.toposort(i);"insert"===e&&(a=a.reverse()),a.forEach(function(e){var r=t.subjects.filter(function(t){return t.metadata.targetName===e});n.push.apply(n,(0,s.fl)(r)),t.removeAlreadySorted(r)});var o=this.getDependencies(),u=this.toposort(o);return"insert"===e&&(u=u.reverse()),u.forEach(function(e){var r=t.subjects.filter(function(t){return t.metadata.targetName===e});n.push.apply(n,(0,s.fl)(r)),t.removeAlreadySorted(r)}),n.push.apply(n,(0,s.fl)(this.subjects)),n},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach(function(e){t.subjects.splice(t.subjects.indexOf(e),1)})},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)}),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(n){n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])}),e},[])},e.prototype.getDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(n){n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])}),e},[])},e.prototype.toposort=function(e){for(var t=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];0>t.indexOf(i[0])&&t.push(i[0]),0>t.indexOf(i[1])&&t.push(i[1])}return t}(e),n=t.length,r=Array(n),i={},a=n;a--;)i[a]||function a(o,s,u){if(u.indexOf(o)>=0)throw Error("Cyclic dependency: "+JSON.stringify(o));if(!~t.indexOf(o))throw Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(o));if(!i[s]){i[s]=!0;var c=e.filter(function(e){return e[0]===o});if(s=c.length){var l=u.concat(o);do{var h=c[--s][1];a(h,t.indexOf(h),l)}while(s)}r[--n]=o}}(t[a],a,[]);return r},e}(),Z=n(8893),X=n(5738),$=n(8535),ee=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach(function(n){t.computeDiffColumns(n),t.computeDiffRelationalColumns(e,n)})},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach(function(t){if(!t.isVirtual&&!t.isDiscriminator){var n=e.changeMaps.find(function(e){return e.column===t});n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);var r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i=t.getEntityValue(e.databaseEntity,!0);if(t.relationMetadata&&null!=t.relationMetadata.getEntityValue(e.entity))return;var a=r;if(null!==r){switch(t.type){case"date":a=Z.E.mixedDateToDateString(r);break;case"time":case"time with time zone":case"time without time zone":case"timetz":a=Z.E.mixedDateToTimeString(r);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":a=Z.E.mixedDateToUtcDatetimeString(r),i=Z.E.mixedDateToUtcDatetimeString(i);break;case"json":case"jsonb":if(X.s.deepCompare(r,i))return;break;case"simple-array":a=Z.E.simpleArrayToString(r),i=Z.E.simpleArrayToString(i);break;case"simple-enum":a=Z.E.simpleEnumToString(r),i=Z.E.simpleEnumToString(i);break;case"simple-json":a=Z.E.simpleJsonToString(r),i=Z.E.simpleJsonToString(i)}t.transformer&&(a=$.A.transformTo(t.transformer,r))}if(a===i)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}})},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach(function(n){var r=n.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var a=n.getEntityValue(t.databaseEntity);if(X.s.compareIds(i,a))return;t.diffRelations.push(n)}var o=e.find(function(e){return e.mustBeInserted&&e.entity===r});o&&(r=o);var s=t.changeMaps.find(function(e){return e.relation===n});s?s.value=r:t.changeMaps.push({relation:n,value:r})}})},e}(),et=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectWithoutIdentifierError",Object.setPrototypeOf(r,t.prototype),r.message="Internal error. Subject "+n.metadata.targetName+" must have an identifier to perform operation. Please report a github issue if you face this error.",r}return(0,s.ZT)(t,e),t}(Error),en=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectRemovedAndUpdatedError",Object.setPrototypeOf(r,t.prototype),r.message='Removed entity "'+n.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).',r}return(0,s.ZT)(t,e),t}(Error),er=n(1444),ei=n(1429),ea=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t,n,r,i,a,o,u,c=this;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(t=function(e){return c.queryRunner.connection.driver.escape(e)},n=this.getTableName(e.metadata.tablePath),r=t(e.metadata.nestedSetLeftColumn.databaseName),i=t(e.metadata.nestedSetRightColumn.databaseName),(a=e.metadata.treeParentRelation.getEntityValue(e.entity))||!e.parentSubject||!e.parentSubject.entity||(a=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),o=e.metadata.getEntityIdMap(a),u=void 0,!o)return[3,2];return[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(o).getRawOne().then(function(e){var t=e?e.right:void 0;return"string"==typeof t?parseInt(t):t})];case 1:u=s.sent(),s.label=2;case 2:if(!(void 0!==u))return[3,4];return[4,this.queryRunner.query("UPDATE "+n+" SET "+(r+" = CASE WHEN "+r+" > "+u+" THEN "+r)+" + 2 ELSE "+r+" END,"+i+" = "+i+" + 2 WHERE "+i+" >= "+u)];case 3:return s.sent(),X.s.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(u),e.metadata.nestedSetRightColumn.createValueMap(u+1)),[3,5];case 4:X.s.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2)),s.label=5;case 5:return[2]}})})},e.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)}).join(".")},e}(),eo=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotAttachTreeChildrenEntityError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot attach entity "'+n+'" to its parent. Please make sure parent is saved in the database before saving children nodes.',r}return(0,s.ZT)(t,e),t}(Error),es=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t,n,r,i,a,o,u,c,l,h,p=this;return(0,s.Jh)(this,function(f){switch(f.label){case 0:return t={},e.metadata.closureJunctionTable.ancestorColumns.forEach(function(n){t[n.databaseName]=e.identifier}),e.metadata.closureJunctionTable.descendantColumns.forEach(function(n){t[n.databaseName]=e.identifier}),[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute()];case 1:if(f.sent(),(n=e.metadata.treeParentRelation.getEntityValue(e.entity))||!e.parentSubject||!e.parentSubject.entity||(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),!n)return[3,3];return r=function(e){return p.queryRunner.connection.driver.escape(e)},i=this.getTableName(e.metadata.closureJunctionTable.tablePath),a=e.metadata.closureJunctionTable.ancestorColumns.map(function(e){return r(e.databaseName)}),o=e.metadata.closureJunctionTable.descendantColumns.map(function(e){return r(e.databaseName)}),u=[],c=e.metadata.primaryColumns.map(function(t){return t.getEntityValue(e.insertedValueSet)}),l=e.metadata.primaryColumns.map(function(e,t){return u.push(c[t]),p.queryRunner.connection.driver.createParameter("child_entity_"+e.databaseName,u.length-1)}),h=e.metadata.closureJunctionTable.descendantColumns.map(function(t){var i=r(t.databaseName),a=t.referencedColumn.getEntityValue(n);if(!a)throw new eo(e.metadata.name);return u.push(a),i+" = "+p.queryRunner.connection.driver.createParameter("parent_entity_"+t.referencedColumn.databaseName,u.length-1)}).join(", "),[4,this.queryRunner.query("INSERT INTO "+i+" ("+(0,s.fl)(a,o).join(", ")+") "+("SELECT "+a.join(", ")+", "+l.join(", ")+" FROM ")+i+" WHERE "+h,u)];case 2:f.sent(),f.label=3;case 3:return[2]}})})},e.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)}).join(".")},e}(),eu=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t,n,r,i,a;return(0,s.Jh)(this,function(o){switch(o.label){case 0:if((t=e.metadata.treeParentRelation.getEntityValue(e.entity))||!e.parentSubject||!e.parentSubject.entity||(t=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n=e.metadata.getEntityIdMap(t),r="",!n)return[3,2];return[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(n).getRawOne().then(function(e){return e?e.path:void 0})];case 1:r=o.sent(),o.label=2;case 2:return i=e.metadata.treeParentRelation.joinColumns.map(function(t){return t.referencedColumn.getEntityValue(e.insertedValueSet)}).join("_"),[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set(((a={})[e.metadata.materializedPathColumn.propertyPath]=r+i+".",a)).where(e.identifier).execute()];case 3:return o.sent(),[2]}})})},e}(),ec=function(){function e(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}return e.prototype.execute=function(){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(e=void 0,!(!this.options||!1!==this.options.listeners)||!((e=this.broadcastBeforeEventsForAll()).promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:t.sent(),t.label=2;case 2:return e&&e.count>0&&(this.insertSubjects.forEach(function(e){return e.recompute()}),this.updateSubjects.forEach(function(e){return e.recompute()}),this.removeSubjects.forEach(function(e){return e.recompute()}),this.softRemoveSubjects.forEach(function(e){return e.recompute()}),this.recoverSubjects.forEach(function(e){return e.recompute()}),this.recompute()),this.insertSubjects=new H(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new H(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return t.sent(),this.softRemoveSubjects=this.allSubjects.filter(function(e){return e.mustBeSoftRemoved}),[4,this.executeSoftRemoveOperations()];case 6:return t.sent(),this.recoverSubjects=this.allSubjects.filter(function(e){return e.mustBeRecovered}),[4,this.executeRecoverOperations()];case 7:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 8:if(t.sent(),!(!this.options||!1!==this.options.listeners)||!((e=this.broadcastAfterEventsForAll()).promises.length>0))return[3,10];return[4,Promise.all(e.promises)];case 9:t.sent(),t.label=10;case 10:return[2]}})})},e.prototype.validate=function(){this.allSubjects.forEach(function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new en(e)})},e.prototype.recompute=function(){new ee().compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(function(e){return e.mustBeInserted}),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=this.allSubjects.filter(function(e){return e.mustBeRemoved}),this.softRemoveSubjects=this.allSubjects.filter(function(e){return e.mustBeSoftRemoved}),this.recoverSubjects=this.allSubjects.filter(function(e){return e.mustBeRecovered}),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new er.D;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)}),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.recoverSubjects.length&&this.recoverSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new er.D;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)}),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.recoverSubjects.length&&this.recoverSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),t},e.prototype.executeInsertOperations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u,c,l=this;return(0,s.Jh)(this,function(h){switch(h.label){case 0:t=(e=(0,s.CR)(this.groupBulkSubjects(this.insertSubjects,"insert"),2))[0],n=e[1],r=function(e){var n,r,a,o,u,c,h,p,f,d,m;return(0,s.Jh)(this,function(y){switch(y.label){case 0:if(n=t[e],r=[],a=[],o=[],i.queryRunner.connection.driver instanceof g.Qd?n.forEach(function(e){e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),a.push(e),r.push(e.entity)}):i.queryRunner.connection.driver instanceof ei.X?n.forEach(function(e){o.push(e)}):n.forEach(function(e){0===e.changeMaps.length||e.metadata.treeType||l.queryRunner.connection.driver instanceof ei.X||l.queryRunner.connection.driver instanceof Y.t?o.push(e):(a.push(e),r.push(e.createValueSetAndPopChangeMap()))}),!(i.queryRunner instanceof g.En))return[3,2];return[4,i.queryRunner.manager.insert(n[0].metadata.target,r)];case 1:return u=y.sent(),n.forEach(function(e,t){e.identifier=u.identifiers[t],e.generatedMap=u.generatedMaps[t],e.insertedValueSet=r[t]}),[3,12];case 2:if(!(r.length>0))return[3,4];return[4,i.queryRunner.manager.createQueryBuilder().insert().into(n[0].metadata.target).values(r).updateEntity(!i.options||!1!==i.options.reload).callListeners(!1).execute()];case 3:c=y.sent(),a.forEach(function(e,t){e.identifier=c.identifiers[t],e.generatedMap=c.generatedMaps[t],e.insertedValueSet=r[t]}),y.label=4;case 4:if(!(o.length>0))return[3,12];h=function(e){return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"!==e.metadata.treeType)return[3,2];return[4,new ea(i.queryRunner).insert(e)];case 1:t.sent(),t.label=2;case 2:return[4,i.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!i.options||!1!==i.options.reload).callListeners(!1).execute().then(function(t){e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]})];case 3:if(t.sent(),"closure-table"!==e.metadata.treeType)return[3,5];return[4,new es(i.queryRunner).insert(e)];case 4:return t.sent(),[3,7];case 5:if("materialized-path"!==e.metadata.treeType)return[3,7];return[4,new eu(i.queryRunner).insert(e)];case 6:t.sent(),t.label=7;case 7:return[2]}})},y.label=5;case 5:y.trys.push([5,10,11,12]),d=void 0,f=(p=(0,s.XA)(o)).next(),y.label=6;case 6:if(f.done)return[3,9];return[5,h(f.value)];case 7:y.sent(),y.label=8;case 8:return f=p.next(),[3,6];case 9:return[3,12];case 10:return d={error:y.sent()},[3,12];case 11:try{f&&!f.done&&(m=p.return)&&m.call(p)}finally{if(d)throw d.error}return[7];case 12:return n.forEach(function(e){e.generatedMap&&e.metadata.columns.forEach(function(t){var n=t.getEntityValue(e.generatedMap);if(null!=n){var r=l.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}})}),[2]}})},i=this,h.label=1;case 1:h.trys.push([1,6,7,8]),o=(a=(0,s.XA)(n)).next(),h.label=2;case 2:if(o.done)return[3,5];return[5,r(o.value)];case 3:h.sent(),h.label=4;case 4:return o=a.next(),[3,2];case 5:return[3,8];case 6:return u={error:h.sent()},[3,8];case 7:try{o&&!o.done&&(c=a.return)&&c.call(a)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.executeUpdateOperations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return(0,s.mG)(e,void 0,void 0,function(){var e,n,r,i,a=this;return(0,s.Jh)(this,function(o){switch(o.label){case 0:if(!t.identifier)throw new et(t);if(!(this.queryRunner instanceof g.En))return[3,2];return e=X.s.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)];case 1:return o.sent(),[3,4];case 2:return n=t.createValueSetAndPopChangeMap(),r=this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?r.whereEntity(t.identifier):r.where(t.identifier),[4,r.execute()];case 3:i=o.sent(),t.generatedMap=i.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),o.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.executeRemoveOperations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u,c;return(0,s.Jh)(this,function(l){switch(l.label){case 0:t=(e=(0,s.CR)(this.groupBulkSubjects(this.removeSubjects,"delete"),2))[0],n=e[1],l.label=1;case 1:l.trys.push([1,8,9,10]),i=(r=(0,s.XA)(n)).next(),l.label=2;case 2:if(i.done)return[3,7];if(o=(a=t[i.value]).map(function(e){if(!e.identifier)throw new et(e);return e.identifier}),!(this.queryRunner instanceof g.En))return[3,4];return[4,this.queryRunner.manager.delete(a[0].metadata.target,o)];case 3:return l.sent(),[3,6];case 4:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(a[0].metadata.target).where(o).callListeners(!1).execute()];case 5:l.sent(),l.label=6;case 6:return i=r.next(),[3,2];case 7:return[3,10];case 8:return u={error:l.sent()},[3,10];case 9:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},e.prototype.executeSoftRemoveOperations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.softRemoveSubjects.map(function(t){return(0,s.mG)(e,void 0,void 0,function(){var e,n,r,i=this;return(0,s.Jh)(this,function(a){switch(a.label){case 0:if(!t.identifier)throw new et(t);if(!(this.queryRunner instanceof g.En))return[3,2];return e=X.s.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)];case 1:return a.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().softDelete().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:r=a.sent(),t.generatedMap=r.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=i.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),a.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.executeRecoverOperations=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.recoverSubjects.map(function(t){return(0,s.mG)(e,void 0,void 0,function(){var e,n,r,i=this;return(0,s.Jh)(this,function(a){switch(a.label){case 0:if(!t.identifier)throw new et(t);if(!(this.queryRunner instanceof g.En))return[3,2];return e=X.s.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=null),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)];case 1:return a.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().restore().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:r=a.sent(),t.generatedMap=r.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=i.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),a.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){var e=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(function(e){e.entity&&e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(function(t){t.entity&&(t.metadata.relationIds.forEach(function(e){e.setValue(t.entity)}),e.queryRunner instanceof g.En&&t.metadata.objectIdColumn&&t.metadata.objectIdColumn.databaseName&&t.metadata.objectIdColumn.databaseName!==t.metadata.objectIdColumn.propertyName&&delete t.entity[t.metadata.objectIdColumn.databaseName])})},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach(function(e){e.entity&&(e.metadata.columns.forEach(function(t){e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map(function(e){return e.target}).indexOf(t.target)||t.isVirtual||(t.isNullable&&void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null),e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach(function(t){t.relation.joinColumns.forEach(function(n){!0!==n.isVirtual&&n.setEntityValue(e.entity,t.value instanceof Object?n.referencedColumn.getEntityValue(t.value):t.value)})}))}),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))})},e.prototype.groupBulkSubjects=function(e,t){var n={},r=[],i="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach(function(e,t){var a=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[a]?n[a].push(e):(n[a]=[e],r.push(a))}),[n,r]},e}(),el=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotDetermineEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Cannot "+n+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.",r}return(0,s.ZT)(t,e),t}(Error),eh=function(){function e(e){var t;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,(0,s.fl)(e.changeMaps)),this.recompute()}return Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeSoftRemoved",{get:function(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeRecovered",{get:function(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],r=this.changeMaps.reduce(function(r,i){var a,o=i.value;if(o instanceof e&&(o=o.insertedValueSet?o.insertedValueSet:o.entity),t.metadata.isJunction&&i.column)a=i.column.createValueMap(i.column.referencedColumn.getEntityValue(o));else if(i.column)a=i.column.createValueMap(o);else if(i.relation){if(o instanceof Object){var s=i.relation.getRelationIdMap(o);if(void 0===s)return n.push(i),t.canBeUpdated=!0,r;a=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s})}else a=i.relation.createValueMap(o),t.updatedRelationMaps.push({relation:i.relation,value:o})}return X.s.mergeDeep(r,a),r},{});return this.changeMaps=n,r},e.prototype.recompute=function(){var e=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach(function(t){if(t.relationMetadata&&t.relationMetadata.inverseEntityMetadata===e.parentSubject.metadata){var n=t.referencedColumn.getEntityValue(e.parentSubject.entity);t.setEntityValue(e.entityWithFulfilledIds,n)}}),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},e}(),ep=n(6097),ef=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0!==i){var a=[];i.forEach(function(i){var o=t.inverseEntityMetadata.getEntityIdMap(i),s=n.subjects.find(function(e){return e.entity===i});if(s&&(o=s.identifier),!o){if(!s)return;s.changeMaps.push({relation:t.inverseRelation,value:e});return}r.find(function(e){return X.s.compareIds(o,e)})||(s||(s=new eh({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:o}),n.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),a.push(o)}),ep.T.difference(r,a).forEach(function(r){var i=new eh({metadata:t.inverseEntityMetadata,parentSubject:e,identifier:r});t.inverseRelation&&"nullify"!==t.inverseRelation.orphanedRowAction?"delete"===t.inverseRelation.orphanedRowAction&&(i.mustBeRemoved=!0):(i.canBeUpdated=!0,i.changeMaps=[{relation:t.inverseRelation,value:null}]),n.subjects.push(i)})}},e}(),ed=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToOneRelations.forEach(function(n){n.isOwning||!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=void 0;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));var r=t.getEntityValue(e.entity);if(void 0!==r){if(null===r){if(n){var i=new eh({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(i)}return}var a=t.inverseEntityMetadata.getEntityIdMap(r),o=this.subjects.find(function(e){return!!e.entity&&e.entity===r});if(o&&(a=o.identifier),!a){if(!o)return;o.changeMaps.push({relation:t.inverseRelation,value:e})}n&&X.s.compareIds(a,n)||(o||(o=new eh({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:a}),this.subjects.push(o)),o.changeMaps.push({relation:t.inverseRelation,value:e}))}},e}(),em=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.entity&&t.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)})})},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&n.getEntityValue(e.databaseEntity).forEach(function(r){var i=new eh({metadata:n.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,r)});t.subjects.push(i)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),Array.isArray(i)){i.forEach(function(i){var a=t.inverseEntityMetadata.getEntityIdMap(i),o=n.subjects.find(function(e){return e.entity===i});if(o&&(a=o.identifier),(a||o)&&!r.find(function(e){return X.s.compareIds(e,a)})){var s=t.isOwning?e:o||i,u=t.isOwning?o||i:e,c=new eh({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});n.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach(function(e){c.changeMaps.push({column:e,value:s})}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){c.changeMaps.push({column:e,value:u})})}});var a=[];i.forEach(function(e){var r=t.inverseEntityMetadata.getEntityIdMap(e),i=n.subjects.find(function(t){return t.entity===e});i&&(r=i.identifier),null!=r&&a.push(r)}),r.filter(function(e){return!a.find(function(t){return X.s.compareIds(t,e)})}).forEach(function(r){var i=new eh({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,r)});n.subjects.push(i)})}},e.prototype.buildJunctionIdentifier=function(e,t,n){var r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach(function(e){X.s.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){X.s.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))}),a},e}(),ey=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t=this;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,Promise.all(this.groupByEntityTargets().map(function(n){return(0,s.mG)(t,void 0,void 0,function(){var t,r,i,a,o,u,c,l,h=this;return(0,s.Jh)(this,function(p){switch(p.label){case 0:if(t=[],r=[],n.subjects.forEach(function(e){!e.databaseEntity&&e.identifier&&(t.push(e.identifier),r.push(e))}),!t.length)return[2];return i=[],"save"===e||"soft-remove"===e||"recover"===e?n.subjects.forEach(function(e){e.metadata.relations.forEach(function(t){void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===i.indexOf(t.propertyPath)&&i.push(t.propertyPath)})}):i.push.apply(i,(0,s.fl)(n.subjects[0].metadata.manyToManyRelations.map(function(e){return e.propertyPath}))),a={loadEagerRelations:!1,loadRelationIds:{relations:i,disableMixedMap:!0},withDeleted:!0},[4,this.queryRunner.manager.getRepository(n.target).findByIds(t,a)];case 1:p.sent().forEach(function(e){h.findByPersistEntityLike(n.target,e).forEach(function(t){t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)})});try{for(u=(o=(0,s.XA)(r)).next();!u.done;u=o.next())u.value.databaseEntityLoaded=!0}catch(e){c={error:e}}finally{try{u&&!u.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2]}})})}))];case 1:return n.sent(),[2]}})})},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.filter(function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))})},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.metadata.target});return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),ev=function(){function e(e){this.allSubjects=e}return e.prototype.build=function(e,t){var n=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach(function(r){var i=(0,s.CR)(r,3),a=i[0],o=i[1],u=i[2];if(null!=o&&(a.isCascadeInsert||a.isCascadeUpdate||a.isCascadeSoftRemove||a.isCascadeRecover)&&o instanceof Object){var c=n.findByPersistEntityLike(u.target,o);if(c){!1===c.canBeInserted&&(c.canBeInserted=!0===a.isCascadeInsert&&"save"===t),!1===c.canBeUpdated&&(c.canBeUpdated=!0===a.isCascadeUpdate&&"save"===t),!1===c.canBeSoftRemoved&&(c.canBeSoftRemoved=!0===a.isCascadeSoftRemove&&"soft-remove"===t),!1===c.canBeRecovered&&(c.canBeRecovered=!0===a.isCascadeRecover&&"recover"===t);return}var l=new eh({metadata:u,parentSubject:e,entity:o,canBeInserted:!0===a.isCascadeInsert&&"save"===t,canBeUpdated:!0===a.isCascadeUpdate&&"save"===t,canBeSoftRemoved:!0===a.isCascadeSoftRemove&&"soft-remove"===t,canBeRecovered:!0===a.isCascadeRecover&&"recover"===t});n.allSubjects.push(l),n.build(l,t)}})},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find(function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))})},e}(),eg=function(){function e(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}return e.prototype.execute=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,u,c,l=this;return(0,s.Jh)(this,function(h){switch(h.label){case 0:if(!this.entity||"object"!=typeof this.entity)return[2,Promise.reject(new W(this.mode,this.entity))];return[4,Promise.resolve()];case 1:h.sent(),e=this.queryRunner||this.connection.createQueryRunner(),this.options&&this.options.data&&(e.data=this.options.data),h.label=2;case 2:return h.trys.push([2,,22,25]),t=Array.isArray(this.entity)?this.entity:[this.entity],[4,Promise.all((this.options&&this.options.chunk&&this.options.chunk>0?X.s.chunk(t,this.options.chunk):[t]).map(function(t){return(0,s.mG)(l,void 0,void 0,function(){var n,r,i=this;return(0,s.Jh)(this,function(a){switch(a.label){case 0:return n=[],t.forEach(function(e){var t=i.target?i.target:e.constructor;if(t===Object)throw new el(i.mode);n.push(new eh({metadata:i.connection.getMetadata(t),entity:e,canBeInserted:"save"===i.mode,canBeUpdated:"save"===i.mode,mustBeRemoved:"remove"===i.mode,canBeSoftRemoved:"soft-remove"===i.mode,canBeRecovered:"recover"===i.mode}))}),r=new ev(n),n.forEach(function(e){r.build(e,i.mode)}),[4,new ey(e,n).load(this.mode)];case 1:return a.sent(),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new ef(n).build(),new ed(n).build(),new em(n).build()):n.forEach(function(e){e.mustBeRemoved&&new em(n).buildForAllRemoval(e)}),[2,new ec(e,n,this.options)]}})})}))];case 3:if(0===(n=h.sent().filter(function(e){return e.hasExecutableOperations})).length)return[2];r=!1,h.label=4;case 4:if(h.trys.push([4,16,,21]),e.isTransactionActive||!(!this.options||!1!==this.options.transaction))return[3,6];return r=!0,[4,e.startTransaction()];case 5:h.sent(),h.label=6;case 6:h.trys.push([6,11,12,13]),a=(i=(0,s.XA)(n)).next(),h.label=7;case 7:if(a.done)return[3,10];return[4,a.value.execute()];case 8:h.sent(),h.label=9;case 9:return a=i.next(),[3,7];case 10:return[3,13];case 11:return u={error:h.sent()},[3,13];case 12:try{a&&!a.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 13:if(!0!==r)return[3,15];return[4,e.commitTransaction()];case 14:h.sent(),h.label=15;case 15:return[3,21];case 16:if(o=h.sent(),!r)return[3,20];h.label=17;case 17:return h.trys.push([17,19,,20]),[4,e.rollbackTransaction()];case 18:case 19:return h.sent(),[3,20];case 20:throw o;case 21:return[3,25];case 22:if(this.queryRunner)return[3,24];return[4,e.release()];case 23:h.sent(),h.label=24;case 24:return[7];case 25:return[2]}})})},e}(),eb=n(7264),eE=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new j,this.connection=e,t&&(this.queryRunner=t,eb.g.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r,i,a,o;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(n="string"==typeof e?e:void 0,!(r="function"==typeof e?e:t))throw Error("Transaction method requires callback in second paramter if isolation level is supplied.");if(this.connection.driver instanceof g.Qd)throw Error("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new S;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw Error("Cannot start transaction because its already started");i=this.queryRunner||this.connection.createQueryRunner(),s.label=1;case 1:if(s.trys.push([1,8,13,16]),!n)return[3,3];return[4,i.startTransaction(n)];case 2:return s.sent(),[3,5];case 3:return[4,i.startTransaction()];case 4:s.sent(),s.label=5;case 5:return[4,r(i.manager)];case 6:return a=s.sent(),[4,i.commitTransaction()];case 7:return s.sent(),[2,a];case 8:o=s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,i.rollbackTransaction()];case 10:case 11:return s.sent(),[3,12];case 12:throw o;case 13:if(this.queryRunner)return[3,15];return[4,i.release()];case 14:s.sent(),s.label=15;case 15:return[7];case 16:return[2]}})})},e.prototype.query=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){return[2,this.connection.query(e,t,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2==arguments.length?e:e.constructor,r=2==arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2==arguments.length?e:e.constructor,r=2==arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);if(!t)return r.create(this.queryRunner);if(Array.isArray(t))return t.map(function(t){return n.create(e,t)});var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,r,!0),i},e.prototype.merge=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=this.connection.getMetadata(e);return r.forEach(function(e){return n.plainObjectToEntityTransformer.transform(t,e,a)}),t},e.prototype.preload=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:return n=this.connection.getMetadata(e),[4,new U(this.connection.manager).transform(t,n)];case 1:if(r=i.sent())return[2,this.merge(e,r,t)];return[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof ti.I||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return(r instanceof ti.I&&(r=r.options.name),Array.isArray(i)&&0===i.length)?Promise.resolve(i):new eg(this.connection,this.queryRunner,"save",r,i,a).execute().then(function(){return i})},e.prototype.remove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,i=r?t:e;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new eg(this.connection,this.queryRunner,"remove",r,i,r?n:t).execute().then(function(){return i})},e.prototype.softRemove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof ti.I||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return(r instanceof ti.I&&(r=r.options.name),Array.isArray(i)&&0===i.length)?Promise.resolve(i):new eg(this.connection,this.queryRunner,"soft-remove",r,i,a).execute().then(function(){return i})},e.prototype.recover=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof ti.I||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return(r instanceof ti.I&&(r=r.options.name),Array.isArray(i)&&0===i.length)?Promise.resolve(i):new eg(this.connection,this.queryRunner,"recover",r,i,a).execute().then(function(){return i})},e.prototype.insert=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]})})},e.prototype.update=function(e,t,n){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(Error("Empty criteria(s) are not allowed for the update method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()},e.prototype.delete=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.softDelete=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()},e.prototype.restore=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(Error("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()},e.prototype.count=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(t)||n.name),[2,_.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getCount()]})})},e.prototype.find=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(t)||n.name),_.isFindManyOptions(t)&&!1===t.loadEagerRelations||_.joinEagerRelations(r,r.alias,n),[2,_.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getMany()]})})},e.prototype.findAndCount=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n,r;return(0,s.Jh)(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(t)||n.name),_.isFindManyOptions(t)&&!1===t.loadEagerRelations||_.joinEagerRelations(r,r.alias,n),[2,_.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getManyAndCount()]})})},e.prototype.findByIds=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i;return(0,s.Jh)(this,function(a){return t.length?(r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(n)||r.name),_.applyFindManyOptionsOrConditionsToQueryBuilder(i,n),_.isFindManyOptions(n)&&!1===n.loadEagerRelations||_.joinEagerRelations(i,i.alias,r),[2,i.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]})})},e.prototype.findOne=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,a,o,u,c;return(0,s.Jh)(this,function(l){return r=void 0,_.isFindOneOptions(t)?r=t:n&&_.isFindOneOptions(n)&&(r=n),i=void 0,t instanceof Object&&!_.isFindOneOptions(t)&&(i=t),o=(a=this.connection.getMetadata(e)).name,r&&r.join?o=r.join.alias:n&&_.isFindOneOptions(n)&&n.join&&(o=n.join.alias),u=this.createQueryBuilder(e,o),r&&!1===r.loadEagerRelations||_.joinEagerRelations(u,u.alias,u.expressionMap.mainAlias.metadata),(c="string"==typeof t||"number"==typeof t||t instanceof Date)||(r=(0,s.pi)((0,s.pi)({},r||{}),{take:1})),_.applyOptionsToQueryBuilder(u,r),i?u.where(i):c&&u.andWhereInIds(a.ensureEntityIdMap(t)),[2,u.getOne()]})})},e.prototype.findOneOrFail=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(r){return[2,this.findOne(e,t,n).then(function(n){return void 0===n?Promise.reject(new O.E(e,t)):Promise.resolve(n)})]})})},e.prototype.clear=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t,n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(t.tablePath)];case 2:return[2,r.sent()];case 3:if(this.queryRunner)return[3,5];return[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.increment=function(e,t,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,a,o,u=this;return(0,s.Jh)(this,function(s){if(!(a=(i=this.connection.getMetadata(e)).findColumnWithPropertyPath(n)))throw Error("Column "+n+" was not found in "+i.targetName+" entity.");if(isNaN(Number(r)))throw Error('Value "'+r+'" is not a number.');return o=n.split(".").reduceRight(function(e,t){var n;return(n={})[t]=e,n},function(){return u.connection.driver.escape(a.databaseName)+" + "+r}),[2,this.createQueryBuilder(e,"entity").update(e).set(o).where(t).execute()]})})},e.prototype.decrement=function(e,t,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,a,o,u=this;return(0,s.Jh)(this,function(s){if(!(a=(i=this.connection.getMetadata(e)).findColumnWithPropertyPath(n)))throw Error("Column "+n+" was not found in "+i.targetName+" entity.");if(isNaN(Number(r)))throw Error('Value "'+r+'" is not a number.');return o=n.split(".").reduceRight(function(e,t){var n;return(n={})[t]=e,n},function(){return u.connection.driver.escape(a.databaseName)+" - "+r}),[2,this.createQueryBuilder(e,"entity").update(e).set(o).where(t).execute()]})})},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new V(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find(function(e){return e.metadata===t});if(n)return n;var r=new K().create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new z(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof D))throw new Q(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=tI().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new F(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof k&&!r.manager&&(r.manager=this),r instanceof P){if(!n)throw new G(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){if(!this.queryRunner)throw new x;return[2,this.queryRunner.release()]})})},e}(),eT=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return(0,s.ZT)(t,e),t.prototype.loadDatabase=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,this.driver.load(e)];case 1:return t.sent(),[2]}})})},t.prototype.saveDatabase=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}})})},t.prototype.exportDatabase=function(){return this.driver.export()},t}(eE),eN=n(2106),eC=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof g.Qd?new g.$2(e):e.driver instanceof eN.x?new eT(e,t):new eE(e,t)},e}(),ew=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDriverError",Object.setPrototypeOf(r,t.prototype),r.message='Wrong driver: "'+n+'" given. Supported drivers are: "cordova", "expo", "mariadb", "mongodb", "mssql", "mysql", "oracle", "postgres", "sqlite", "better-sqlite3", "sqljs", "react-native", "aurora-data-api", "aurora-data-api-pg".',r}return(0,s.ZT)(t,e),t}(Error),eA=n(5128),eM=n(7316),eR=n(4726),eS=n(4894),eO=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new eS.a(n),n}return(0,s.ZT)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new eA.Y;return new Promise(function(r,i){return(0,s.mG)(n,void 0,void 0,function(){var n,a,o=this;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.executeSql(e,t,function(n){var i=o.driver.connection.options.maxQueryExecutionTime,s=+new Date-a;if(i&&s>i&&o.driver.connection.logger.logQuerySlow(s,e,t,o),"INSERT INTO"===e.substr(0,11))r(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));r(u)}},function(n){o.driver.connection.logger.logQueryError(n,e,t,o),i(new eM.O(e,t,n))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(eR.J),ex=n(4547),eP=n(6908),eI=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new ex.f("database");if(!n.options.location)throw new ex.f("location");return n.loadDependencies(),n}return(0,s.ZT)(t,e),t.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new eO(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],function(n){t(e)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new eP.z("Cordova-SQLite","cordova-sqlite-storage")}},t}(I.w),eD=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new eS.a(n),n}return(0,s.ZT)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new eA.Y;return new Promise(function(r,i){return(0,s.mG)(n,void 0,void 0,function(){var n,a,o=this;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.executeSql(e,t,function(n){var i=o.driver.connection.options.maxQueryExecutionTime,s=+new Date-a;if(i&&s>i&&o.driver.connection.logger.logQuerySlow(s,e,t,o),"INSERT INTO"===e.substr(0,11))r(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));r(u)}},function(n){o.driver.connection.logger.logQueryError(n,e,t,o),i(new eM.O(e,t,n))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(eR.J),eq=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new ex.f("database");if(!n.options.location)throw new ex.f("location");return n.loadDependencies(),n}return(0,s.ZT)(t,e),t.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new eD(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],function(n){t(e)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=n(Object(function(){var e=Error("Cannot find module 'react-native-sqlite-storage'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){throw new eP.z("React-Native","react-native-sqlite-storage")}},t}(I.w),e_=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new eS.a(n),n}return(0,s.ZT)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new eA.Y;var r=this.driver.connection;return new Promise(function(i,a){var o="INSERT INTO"===e.substr(0,11),s=function(n,o){var s=r.options.maxQueryExecutionTime,c=+new Date-u;s&&c>s&&r.logger.logQuerySlow(c,e,t,this),n?(r.logger.logQueryError(n,e,t,this),a(new eM.O(e,t,n))):i(o)};n.driver.connection.logger.logQuery(e,t,n);var u=+new Date;n.connect().then(function(n){o?n.execSQL(e,t,s):n.all(e,t,s)})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'"'+e+'"=?'})},t}(eR.J),ej=n(8764).Buffer,eL=function(e){function t(t){var n=e.call(this,t)||this;if(n.connection=t,n.options=t.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new ex.f("database");return n.loadDependencies(),n}return(0,s.ZT)(t,e),t.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close().then(t).catch(n)})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new e_(this)),this.queryRunner},t.prototype.normalizeType=function(t){return t.type===ej?"blob":e.prototype.normalizeType.call(this,t)},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{readOnly:e.options.readOnly,key:e.options.key,multithreading:e.options.multithreading,migrate:e.options.migrate,iosFlags:e.options.iosFlags,androidFlags:e.options.androidFlags},e.options.extra||{});new e.sqlite(e.options.database,r,function(r,i){if(r)return n(r);i.resultType(e.sqlite.RESULTSASOBJECT),i.execSQL("PRAGMA foreign_keys = ON;",[],function(e,r){if(e)return n(e);t(i)})})})},t.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new eP.z("Nativescript","nativescript-sqlite")},t}(I.w),eB=n(8956),eU=n(6556),eF=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new eS.a(n),n}return(0,s.ZT)(t,e),t.prototype.startTransaction=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(this.isTransactionActive&&void 0!==this.transaction)throw new eB.S;if(e=new er.D,this.broadcaster.broadcastBeforeTransactionStartEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:if(this.isTransactionActive=!0,t=new er.D,this.broadcaster.broadcastAfterTransactionStartEvent(t),!(t.promises.length>0))return[3,4];return[4,Promise.all(t.promises)];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.prototype.commitTransaction=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new eU.W;if(e=new er.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:if(this.isTransactionActive=!1,this.transaction=void 0,t=new er.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),!(t.promises.length>0))return[3,4];return[4,Promise.all(t.promises)];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new eU.W;if(e=new er.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:if(this.isTransactionActive=!1,this.transaction=void 0,t=new er.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),!(t.promises.length>0))return[3,4];return[4,Promise.all(t.promises)];case 3:n.sent(),n.label=4;case 4:return[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new eA.Y;return new Promise(function(r,i){return(0,s.mG)(n,void 0,void 0,function(){var n,a,o=this;return(0,s.Jh)(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.transaction(function(n){void 0===o.transaction&&(o.startTransaction(),o.transaction=n),o.transaction.executeSql(e,t,function(n,i){var s=o.driver.connection.options.maxQueryExecutionTime,u=+new Date-a;if(s&&u>s&&o.driver.connection.logger.logQuerySlow(u,e,t,o),"INSERT INTO"===e.substr(0,11))r(i.insertId);else{for(var c=[],l=0;l<i.rows.length;l++)c.push(i.rows.item(l));r(c)}},function(n,r){o.driver.connection.logger.logQueryError(r,e,t,o),i(new eM.O(e,t,r))})},function(e){o.rollbackTransaction()},function(){o.isTransactionActive=!1,o.transaction=void 0}),[2]}})})})},t}(eR.J),eJ=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new ex.f("database");if(!n.options.driver)throw new ex.f("driver");return n.sqlite=n.options.driver,n}return(0,s.ZT)(t,e),t.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection._db.close(),e.databaseConnection=void 0,t()}catch(e){n(e)}})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new eF(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){try{var r=e.sqlite.openDatabase(e.options.database);r.transaction(function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],function(e,n){t(r)},function(e,t){n({transaction:e,error:t})})},function(e){n(e)})}catch(e){n(e)}})},t}(I.w),ek=n(418),eG=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.client=n,i}return(0,s.ZT)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){var n=(0,s.CR)(t,2),r=n[0],i=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=r,e.releaseCallback=i,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){var n=(0,s.CR)(t,2),r=n[0],i=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=r,e.releaseCallback=i,e.databaseConnection})),this.databaseConnectionPromise)},t.prototype.startTransaction=function(e){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(this.isTransactionActive)throw new eB.S;if(e=new er.D,this.broadcaster.broadcastBeforeTransactionStartEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!0,[4,this.client.startTransaction()];case 3:if(n.sent(),t=new er.D,this.broadcaster.broadcastAfterTransactionStartEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.commitTransaction=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new eU.W;if(e=new er.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.client.commitTransaction()];case 3:if(n.sent(),this.isTransactionActive=!1,t=new er.D,this.broadcaster.broadcastAfterTransactionCommitEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new eU.W;if(e=new er.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),!(e.promises.length>0))return[3,2];return[4,Promise.all(e.promises)];case 1:n.sent(),n.label=2;case 2:return[4,this.client.rollbackTransaction()];case 3:if(n.sent(),t=new er.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),!(t.promises.length>0))return[3,5];return[4,Promise.all(t.promises)];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.query=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new eA.Y;return[4,this.client.query(e,t)];case 1:if((n=r.sent()).records)return[2,n.records];return[2,n]}})})},t}(function(e){function t(t,n){return e.call(this,t,n)||this}return(0,s.ZT)(t,e),t}(n(3737).c)),eV=function(e){function t(t){var n=e.call(this)||this;return n.connection=t,n.options=t.options,n.isReplicated=!1,n.loadDependencies(),n}return(0,s.ZT)(t,e),t.prototype.connect=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return[2]})})},t.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return[2]})})},t.prototype.createQueryRunner=function(e){var t=this;return new eG(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,function(e,n){return t.connection.logger.logQuery(e,n)},this.options.serviceConfigOptions,this.options.formatOptions),e)},t.prototype.loadDependencies=function(){var e=ek.Qm.load("typeorm-aurora-data-api-driver").pg;this.DataApiDriver=e},t.prototype.executeQuery=function(e,t){return this.connection.query(t)},t.prototype.afterConnect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(t){switch(t.label){case 0:return[4,this.checkMetadataForExtensions()];case 1:if(!(e=t.sent()).hasExtensions)return[3,3];return[4,this.enableExtensions(e,this.connection)];case 2:t.sent(),t.label=3;case 3:return[2,Promise.resolve()]}})})},t}(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t}(g.U4)),eQ=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":case"mariadb":return new g.p$(e);case"postgres":return new g.U4(e);case"cockroachdb":return new g.J1(e);case"sap":return new Y.t(e);case"sqlite":return new g.Z7(e);case"better-sqlite3":return new g.R4(e);case"cordova":return new eI(e);case"nativescript":return new eL(e);case"react-native":return new eq(e);case"sqljs":return new eN.x(e);case"oracle":return new ei.X(e);case"mssql":return new y.Z(e);case"mongodb":return new g.Qd(e);case"expo":return new eJ(e);case"aurora-data-api":return new g.xI(e);case"aurora-data-api-pg":return new eV(e);default:throw new ew(t)}},e}();function eK(e,t,n){return void 0===n&&(n=[".js",".cjs",".ts"]),[]}var ez=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}());function eW(e){if(a)try{var t=a.get(e);if(t||!o||!o.fallback)return t}catch(e){if(!o||!o.fallbackOnErrors)throw e}return ez.get(e)}var eY=n(2367),eH=function(){function e(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map(function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e})).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map(function(e){return String(e)})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}this.columns=r.map(function(e){var n=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(n)return[n];var r=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(r)return r.joinColumns;throw Error("Index "+(t.givenName?'"'+t.givenName+'" ':"")+"contains column that is missing in the entity ("+t.entityMetadata.targetName+"): "+e)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databasePath]=n[r]),e},{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tablePath,this.columns.map(function(e){return e.databaseName}),this.where),this},e}(),eZ=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("recover"),this.isPrimary=t.options.primary||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.orphanedRowAction=t.options.orphanedRowAction||"nullify",this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});return ep.T.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});if(t.length>1)throw Error("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){if(this.embeddedMetadata){var n=(0,s.fl)(this.embeddedMetadata.parentPropertyNames),r=function(e,t){var n=e.shift();return n?t[n]?r(e,t[n]):void 0:t},i=r(n,e);return this.isLazy?void 0!==i["__"+this.propertyName+"__"]?i["__"+this.propertyName+"__"]:!0===t?i[this.propertyName]:void 0:i?i[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var r=function(e,i){var a=e.shift();return a?(i[a.propertyName]||(i[a.propertyName]=a.create()),r(e,i[a.propertyName]),i):(i[n]=t,i)};return r((0,s.fl)(this.embeddedMetadata.embeddedMetadataTree),e)}e[n]=t},e.prototype.createValueMap=function(e){var t,n=this;if(!this.embeddedMetadata)return(t={})[this.propertyName]=e,t;var r=(0,s.fl)(this.embeddedMetadata.parentPropertyNames),i=function(t,r){var a=t.shift();return a?(r[a]={},i(t,r[a]),r):(r[n.propertyName]=e,r)};return i(r,{})},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,(0,s.fl)(t)),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;else if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName;return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),eX=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw Error("Invalid prefix option given for "+this.entityMetadata.targetName+"#"+this.propertyName)},e.prototype.buildPrefix=function(e){if(e.driver instanceof g.Qd)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push.apply(t,(0,s.fl)(this.buildPartialPrefix())),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildListenersFromTree())},this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildIndicesFromTree())},this.indices)},e.prototype.buildUniquesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildUniquesFromTree())},this.uniques)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationIdsFromTree())},this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationCountsFromTree())},this.relationCounts)},e}(),e$=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(Array.isArray(n))e[this.propertyName]=n.map(function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)}).filter(function(e){return null!=e});else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),e0=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),e1=function(){function e(){}return e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove",e}(),e2=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),e3=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=e.foreignKeyName(this.entityMetadata.tablePath,this.columnNames,this.referencedTablePath,this.referencedColumnNames)},e}(),e4=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this,r=this.collectReferencedColumns(e,t),i=this.collectInverseReferencedColumns(e,t),a=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),o=new ep.T({connection:this.connection,args:{target:"",name:a,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});o.build();var u=r.map(function(r){var i=t.joinColumns?t.joinColumns.find(function(e){return(!e.referencedColumnName||e.referencedColumnName===r.propertyName)&&!!e.name}):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new eY.T({connection:n.connection,entityMetadata:o,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{name:a,length:!r.length&&(n.connection.driver instanceof g.p$||n.connection.driver instanceof g.xI)&&("uuid"===r.generationStrategy||"uuid"===r.type)?"36":r.length,width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,nullable:!1,primary:!0}}})}),c=i.map(function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return(!e.referencedColumnName||e.referencedColumnName===r.propertyName)&&!!e.name}):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new eY.T({connection:n.connection,entityMetadata:o,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{length:!r.length&&(n.connection.driver instanceof g.p$||n.connection.driver instanceof g.xI)&&("uuid"===r.generationStrategy||"uuid"===r.type)?"36":r.length,width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,name:a,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(u,c),o.ownerColumns=u,o.inverseColumns=c,o.ownColumns=(0,s.fl)(u,c),o.ownColumns.forEach(function(t){return t.relationMetadata=e}),o.foreignKeys=[new e3({entityMetadata:o,referencedEntityMetadata:e.entityMetadata,columns:u,referencedColumns:r,onDelete:e.onDelete||"CASCADE"}),new e3({entityMetadata:o,referencedEntityMetadata:e.inverseEntityMetadata,columns:c,referencedColumns:i,onDelete:e.onDelete||"CASCADE"})],o.ownIndices=[new eH({entityMetadata:o,columns:u,args:{target:o.target,synchronize:!0}}),new eH({entityMetadata:o,columns:c,args:{target:o.target,synchronize:!0}})],o},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return t.joinColumns&&(!t.joinColumns||n)?t.joinColumns.map(function(t){var n=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n}):e.entityMetadata.columns.filter(function(e){return e.isPrimary})},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return n&&(!n||r)?t.inverseJoinColumns.map(function(t){var n=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n}):e.inverseEntityMetadata.primaryColumns},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach(function(e){t.forEach(function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}})})},e}(),e5=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new ep.T({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return n.build(),e.primaryColumns.forEach(function(r){n.ownColumns.push(new eY.T({connection:t.connection,entityMetadata:n,closureType:"ancestor",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(r):r.propertyName+"_ancestor",options:{primary:!0,length:r.length,type:r.type}}})),n.ownColumns.push(new eY.T({connection:t.connection,entityMetadata:n,closureType:"descendant",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(r):r.propertyName+"_descendant",options:{primary:!0,length:r.length,type:r.type}}}))}),n.ownIndices=[new eH({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new eH({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],e.treeLevelColumn&&n.ownColumns.push(new eY.T({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new e3({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns}),new e3({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns})],n},e}(),e6=function(){function e(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map(function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e})).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map(function(e){return String(e)})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return String(e)}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}this.columns=r.map(function(e){var n=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(n)return[n];var r=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(r)return r.joinColumns;throw Error("Unique constraint "+(t.givenName?'"'+t.givenName+'" ':"")+"contains column that is missing in the entity ("+t.entityMetadata.targetName+"): "+e)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databasePath]=n[r]),e},{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tablePath,this.columns.map(function(e){return e.databaseName})),this},e}(),e7=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(!n.length)return{foreignKey:void 0,uniqueConstraint:void 0};var r=this.collectColumns(e,t,n),i=new e3({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if(this.connection.driver instanceof ei.X&&r.every(function(e){return e.isPrimary}))return{foreignKey:i,uniqueConstraint:void 0};if(n.length>0&&t.isOneToOne){var a=new e6({entityMetadata:t.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tablePath,i.columns.map(function(e){return e.databaseName})),target:t.entityMetadata.target}});return a.build(this.connection.namingStrategy),{foreignKey:i,uniqueConstraint:a}}return{foreignKey:i,uniqueConstraint:void 0}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var n=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!n)throw Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n})},e.prototype.collectColumns=function(e,t,n){var r=this;return n.map(function(n){var i=e.find(function(e){return(!e.referencedColumnName||e.referencedColumnName===n.propertyName)&&!!e.name}),a=i?i.name:r.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),o=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return o||(o=new eY.T({connection:r.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:n.type,length:!n.length&&(r.connection.driver instanceof g.p$||r.connection.driver instanceof g.xI)&&("uuid"===n.generationStrategy||"uuid"===n.type)?"36":n.length,width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(o)),o.referencedColumn=n,o.type=n.type,o.relationMetadata=t,o.build(r.connection),o})},e}(),e8=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&e[n]&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),e9=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),te=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),tt=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new e4(e),this.closureJunctionEntityMetadataBuilder=new e5(e),this.relationJoinColumnBuilder=new e7(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return"regular"===e.type||"closure"===e.type||"entity-child"===e.type||"view"===e.type}).map(function(e){return t.createEntityMetadata(e)});return n.forEach(function(e){return t.computeParentEntityMetadata(n,e)}),n.forEach(function(e){e.childEntityMetadatas=n.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&e2.isInherited(t.target,e.target)})}),n.filter(function(e){return"entity-child"!==e.tableType}).forEach(function(e){return e.build()}),n.filter(function(e){return"entity-child"===e.tableType}).forEach(function(e){return e.build()}),n.filter(function(e){return"entity-child"!==e.tableType}).forEach(function(e){return t.computeEntityMetadataStep1(n,e)}),n.filter(function(e){return"entity-child"===e.tableType}).forEach(function(e){return t.computeEntityMetadataStep1(n,e)}),n.forEach(function(e){return t.computeEntityMetadataStep2(e)}),n.forEach(function(e){return t.computeInverseProperties(e,n)}),n.filter(function(e){return"entity-child"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n),a=i.foreignKey,o=i.uniqueConstraint;if(a&&(n.registerForeignKeys(a),e.foreignKeys.push(a)),o){if(t.connection.driver instanceof g.p$||t.connection.driver instanceof g.xI||t.connection.driver instanceof y.Z||t.connection.driver instanceof Y.t){var s=new eH({entityMetadata:o.entityMetadata,columns:o.columns,args:{target:o.target,name:o.name,unique:!0,synchronize:!0}});t.connection.driver instanceof y.Z&&(s.where=s.columns.map(function(e){return t.connection.driver.escape(e.databaseName)+" IS NOT NULL"}).join(" AND ")),n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}else n.embeddedMetadata?n.embeddedMetadata.uniques.push(o):n.entityMetadata.ownUniques.push(o),t.computeEntityMetadataStep2(e)}if(a&&t.connection.driver instanceof g.J1){var s=new eH({entityMetadata:n.entityMetadata,columns:a.columns,args:{target:n.entityMetadata.target,synchronize:!0}});n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var r=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(r){var i=t.junctionEntityMetadataBuilder.build(e,r);e.registerForeignKeys.apply(e,(0,s.fl)(i.foreignKeys)),e.registerJunctionEntityMetadata(i),t.computeEntityMetadataStep2(i),t.computeInverseProperties(i,n),n.push(i)}})}),n.forEach(function(e){e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),n.filter(function(e){return"closure-table"===e.treeType}).forEach(function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadataStep2(r),t.computeInverseProperties(r,n),n.push(r)}),n.filter(function(e){return"STI"===e.inheritancePattern&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),n.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.uniques.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.checks.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.exclusions.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(n){t.connection.relationLoader.enableLazyLoad(n,e.target.prototype)})}),n.forEach(function(e){e.columns.forEach(function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,"uuid"===r.strategy?n.type="uuid":"rowid"===r.strategy?n.type="int":n.type=n.type||Number,n.build(t.connection),t.computeEntityMetadataStep2(e))})}),n},e.prototype.createEntityMetadata=function(e){var t,n=e.target instanceof Function?e2.getInheritanceTree(e.target):[e.target],r=this.metadataArgsStorage.findInheritanceType(e.target),i=this.metadataArgsStorage.findTree(e.target);return(r&&"STI"===r.pattern||"entity-child"===e.type)&&(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),n.push.apply(n,(0,s.fl)(t))),new ep.T({connection:this.connection,args:e,inheritanceTree:n,tableTree:i,inheritancePattern:r?r.pattern:void 0})},e.prototype.computeParentEntityMetadata=function(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find(function(e){return -1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern}))},e.prototype.computeEntityMetadataStep1=function(e,t){var n,r,i,a=this,o=this.metadataArgsStorage.findInheritanceType(t.target),u=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(void 0!==u?t.discriminatorValue=u.value:t.discriminatorValue=t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map(function(e){return"STI"===t.inheritancePattern&&(e.columns=e.columns.map(function(e){return e.isNullable=!0,e})),e}),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map(function(n){if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find(function(e){return e.propertyName===n.propertyName});var r=new eY.T({connection:a.connection,entityMetadata:t,args:n});return e.find(function(e){return"entity-child"===e.tableType&&e.target===n.target})&&(r.isNullable=!0),r}),o&&o.column){var c=o.column&&o.column.name?o.column.name:"type",l=t.ownColumns.find(function(e){return e.propertyName===c});l?l.isDiscriminator=!0:((l=new eY.T({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:c,options:o.column||{name:c,type:"varchar",nullable:!1}}})).isVirtual=!0,l.isDiscriminator=!0,t.ownColumns.push(l))}if("entity-child"===t.tableType){var h=t.parentEntityMetadata.ownColumns.find(function(e){return e.isDiscriminator});h&&!t.ownColumns.find(function(e){return e===h})&&t.ownColumns.push(h)}var p=this.connection.namingStrategy;if("materialized-path"===t.treeType)t.ownColumns.push(new eY.T({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:p.materializedPathColumnName,type:"varchar",nullable:!0,default:""}}}));else if("nested-set"===t.treeType){var f=p.nestedSetColumnNames,d=f.left,m=f.right;t.ownColumns.push(new eY.T({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:d,options:{name:d,type:"integer",nullable:!1,default:1}}})),t.ownColumns.push(new eY.T({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:m,options:{name:m,type:"integer",nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map(function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.ownRelations.find(function(t){return t.propertyName===e.propertyName}):new eZ({entityMetadata:t,args:e})}),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map(function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find(function(t){return t.propertyName===e.propertyName}):new e$({entityMetadata:t,args:e})}),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map(function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find(function(t){return t.propertyName===e.propertyName}):new e0({entityMetadata:t,args:e})}),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map(function(e){return new e8({entityMetadata:t,args:e})}),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map(function(e){return new e9({entityMetadata:t,args:e})}),this.connection.driver instanceof g.U4&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map(function(e){return new te({entityMetadata:t,args:e})})),this.connection.driver instanceof g.J1){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter(function(e){return!e.unique}).map(function(e){return new eH({entityMetadata:t,args:e})});var y=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter(function(e){return e.unique}).map(function(e){return new e6({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})});(n=t.ownUniques).push.apply(n,(0,s.fl)(y))}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map(function(e){return new eH({entityMetadata:t,args:e})});if(this.connection.driver instanceof g.p$||this.connection.driver instanceof g.xI||this.connection.driver instanceof Y.t){var v=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map(function(e){return new eH({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})});(r=t.ownIndices).push.apply(r,(0,s.fl)(v))}else{var y=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map(function(e){return new e6({entityMetadata:t,args:e})});(i=t.ownUniques).push.apply(i,(0,s.fl)(y))}},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map(function(t){var r=new eX({entityMetadata:e,args:t}),i=e2.getInheritanceTree(r.type);return r.columns=n.metadataArgsStorage.filterColumns(i).map(function(t){return new eY.T({connection:n.connection,entityMetadata:e,embeddedMetadata:r,args:t})}),r.relations=n.metadataArgsStorage.filterRelations(i).map(function(t){return new eZ({entityMetadata:e,embeddedMetadata:r,args:t})}),r.listeners=n.metadataArgsStorage.filterListeners(i).map(function(t){return new e8({entityMetadata:e,embeddedMetadata:r,args:t})}),r.indices=n.metadataArgsStorage.filterIndices(i).map(function(t){return new eH({entityMetadata:e,embeddedMetadata:r,args:t})}),r.uniques=n.metadataArgsStorage.filterUniques(i).map(function(t){return new e6({entityMetadata:e,embeddedMetadata:r,args:t})}),r.relationIds=n.metadataArgsStorage.filterRelationIds(i).map(function(t){return new e$({entityMetadata:e,args:t})}),r.relationCounts=n.metadataArgsStorage.filterRelationCounts(i).map(function(t){return new e0({entityMetadata:e,args:t})}),r.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i)),r.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=r}),e.allEmbeddeds.push(r),r})},e.prototype.computeEntityMetadataStep2=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.eagerRelations=e.relations.filter(function(e){return e.isEager}),e.lazyRelations=e.relations.filter(function(e){return e.isLazy}),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.listeners=e.embeddeds.reduce(function(e,t){return e.concat(t.listenersFromTree)},e.ownListeners),e.afterLoadListeners=e.listeners.filter(function(e){return e.type===e1.AFTER_LOAD}),e.afterInsertListeners=e.listeners.filter(function(e){return e.type===e1.AFTER_INSERT}),e.afterUpdateListeners=e.listeners.filter(function(e){return e.type===e1.AFTER_UPDATE}),e.afterRemoveListeners=e.listeners.filter(function(e){return e.type===e1.AFTER_REMOVE}),e.beforeInsertListeners=e.listeners.filter(function(e){return e.type===e1.BEFORE_INSERT}),e.beforeUpdateListeners=e.listeners.filter(function(e){return e.type===e1.BEFORE_UPDATE}),e.beforeRemoveListeners=e.listeners.filter(function(e){return e.type===e1.BEFORE_REMOVE}),e.indices=e.embeddeds.reduce(function(e,t){return e.concat(t.indicesFromTree)},e.ownIndices),e.uniques=e.embeddeds.reduce(function(e,t){return e.concat(t.uniquesFromTree)},e.ownUniques),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.nonVirtualColumns=e.columns.filter(function(e){return!e.isVirtual}),e.ancestorColumns=e.columns.filter(function(e){return"ancestor"===e.closureType}),e.descendantColumns=e.columns.filter(function(e){return"descendant"===e.closureType}),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter(function(e){return e.isGenerated||e.isObjectId}),e.hasUUIDGeneratedColumns=e.columns.filter(function(e){return e.isGenerated||"uuid"===e.generationStrategy}).length>0,e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.deleteDateColumn=e.columns.find(function(e){return e.isDeleteDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.nestedSetLeftColumn=e.columns.find(function(e){return e.isNestedSetLeft}),e.nestedSetRightColumn=e.columns.find(function(e){return e.isNestedSetRight}),e.materializedPathColumn=e.columns.find(function(e){return e.isMaterializedPath}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(n){var r=t.find(function(e){return e.target===n.type||"string"==typeof n.type&&e.targetName===n.type});if(!r)throw Error("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(e){return e.propertyPath===n.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new eH({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))},e}(),tn=function(){function e(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find(function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t})},e.prototype.findTree=function(e){return this.trees.find(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterUniques=function(e){return this.uniques.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterChecks=function(e){return this.checks.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterExclusions=function(e){return this.exclusions.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e,t){return this.transactionEntityManagers.filter(function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t})},e.prototype.filterTransactionRepository=function(e,t){return this.transactionRepositories.filter(function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t})},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&e2.isInherited(t.target,e)&&"entity-child"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e.prototype.filterByTarget=function(e,t){return e.filter(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach(function(e){(Array.isArray(t)?-1===t.indexOf(e.target):e.target!==t)||n.find(function(t){return t.propertyName===e.propertyName})||n.push(e)}),n},e.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(e,t){var n=[];return e.forEach(function(e){(Array.isArray(t)?-1===t.indexOf(e.target):e.target!==t)||n.find(function(t){return t.prefix===e.prefix&&t.propertyName===e.propertyName})||n.push(e)}),n},e}(),tr=function(){function e(){}return e.prototype.transform=function(e){var t=new tn;return e.forEach(function(e){var n=e.options,r={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize,expression:n.expression};t.tables.push(r),Object.keys(n.columns).forEach(function(e){var r=n.columns[e],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.deleteDate&&(i="deleteDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel"),r.objectId&&(i="objectId");var a={target:n.target||n.name,mode:i,propertyName:e,options:{type:r.type,name:r.objectId?"_id":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,update:r.update,select:r.select,insert:r.insert,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer,spatialFeatureType:r.spatialFeatureType,srid:r.srid}};if(t.columns.push(a),r.generated){var o={target:n.target||n.name,propertyName:e,strategy:"string"==typeof r.generated?r.generated:"increment"};t.generations.push(o)}r.unique&&t.uniques.push({target:n.target||n.name,columns:[e]})}),n.relations&&Object.keys(n.relations).forEach(function(e){var r,i,a=n.relations[e],o={target:n.target||n.name,propertyName:e,relationType:a.type,isLazy:a.lazy||!1,type:a.target,inverseSideProperty:a.inverseSide,isTreeParent:a.treeParent,isTreeChildren:a.treeChildren,options:{eager:a.eager||!1,cascade:a.cascade,nullable:a.nullable,onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,primary:a.primary,persistence:a.persistence}};if(t.relations.push(o),a.joinColumn){if("boolean"==typeof a.joinColumn){var u={target:n.target||n.name,propertyName:e};t.joinColumns.push(u)}else{var c=Array.isArray(a.joinColumn)?a.joinColumn:[a.joinColumn];try{for(var l=(0,s.XA)(c),h=l.next();!h.done;h=l.next()){var p=h.value,u={target:n.target||n.name,propertyName:e,name:p.name,referencedColumnName:p.referencedColumnName};t.joinColumns.push(u)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}}if(a.joinTable){if("boolean"==typeof a.joinTable){var f={target:n.target||n.name,propertyName:e};t.joinTables.push(f)}else{var f={target:n.target||n.name,propertyName:e,name:a.joinTable.name,database:a.joinTable.database,schema:a.joinTable.schema,joinColumns:a.joinTable.joinColumn?[a.joinTable.joinColumn]:a.joinTable.joinColumns,inverseJoinColumns:a.joinTable.inverseJoinColumn?[a.joinTable.inverseJoinColumn]:a.joinTable.inverseJoinColumns};t.joinTables.push(f)}}}),n.indices&&n.indices.forEach(function(e){var r={target:n.target||n.name,name:e.name,unique:!0===e.unique,spatial:!0===e.spatial,fulltext:!0===e.fulltext,parser:e.parser,synchronize:!1!==e.synchronize,where:e.where,sparse:e.sparse,columns:e.columns};t.indices.push(r)}),n.uniques&&n.uniques.forEach(function(e){var r={target:n.target||n.name,name:e.name,columns:e.columns};t.uniques.push(r)}),n.checks&&n.checks.forEach(function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.checks.push(r)}),n.exclusions&&n.exclusions.forEach(function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.exclusions.push(r)})}),t},e}(),ti=n(4962),ta=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=(0,s.CR)(X.s.splitClassesAndStrings(e),2),n=t[0],r=t[1];return(0,s.fl)(n,eK(this.connection.logger,r)).map(function(e){return eW(e)})},e.prototype.buildSubscribers=function(e){var t=(0,s.CR)(X.s.splitClassesAndStrings(e||[]),2),n=t[0],r=t[1],i=(0,s.fl)(n,eK(this.connection.logger,r));return tI().filterSubscribers(i).map(function(e){return eW(e.target)})},e.prototype.buildEntityMetadatas=function(e){var t=(0,s.CR)(X.s.splitClassesAndStrings(e||[]),2),n=t[0],r=t[1],i=n.filter(function(e){return e instanceof ti.I==!1}),a=n.filter(function(e){return e instanceof ti.I}),o=(0,s.fl)(i,eK(this.connection.logger,r));o.forEach(function(e){e instanceof ti.I&&(a.push(e),o.slice(o.indexOf(e),1))});var u=new tt(this.connection,tI()).build(o),c=new tr().transform(a),l=new tt(this.connection,c).build();return(0,s.fl)(u,l)},e}(),to=n(7884),ts=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query"))&&console.log("query: "+e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):""))},e.prototype.logQueryError=function(e,t,n,r){("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error"))&&(console.log("query failed: "+t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"")),console.log("error:",e))},e.prototype.logQuerySlow=function(e,t,n,r){console.log("query is slow: "+t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"")),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),tu=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");ek.Qm.logInfo("query:",ek.Qm.highlightSql(r))}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");ek.Qm.logError("query failed:",ek.Qm.highlightSql(i)),ek.Qm.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");ek.Qm.logWarn("query is slow:",ek.Qm.highlightSql(i)),ek.Qm.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&ek.Qm.log(e)},e.prototype.logMigration=function(e,t){ek.Qm.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&ek.Qm.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&ek.Qm.logInfo("INFO:",t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(ek.Qm.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),tc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t}(function(){function e(){}return e.prototype.logQuery=function(){throw Error("This logger is not applicable in a browser context")},e.prototype.logQueryError=function(){throw Error("This logger is not applicable in a browser context")},e.prototype.logQuerySlow=function(){throw Error("This logger is not applicable in a browser context")},e.prototype.logSchemaBuild=function(){throw Error("This logger is not applicable in a browser context")},e.prototype.logMigration=function(){throw Error("This logger is not applicable in a browser context")},e.prototype.log=function(){throw Error("This logger is not applicable in a browser context")},e}()),tl=n(1227),th=n.n(tl),tp=function(){function e(){this.debugQueryLog=th()("typeorm:query:log"),this.debugQueryError=th()("typeorm:query:error"),this.debugQuerySlow=th()("typeorm:query:slow"),this.debugSchemaBuild=th()("typeorm:schema"),this.debugMigration=th()("typeorm:migration"),this.debugLog=th()("typeorm:log"),this.debugInfo=th()("typeorm:info"),this.debugWarn=th()("typeorm:warn")}return e.prototype.logQuery=function(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(ek.Qm.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))},e.prototype.logQueryError=function(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(ek.Qm.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))},e.prototype.logQuerySlow=function(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(ek.Qm.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),tf=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new ts(t);case"file":return new tc(t);case"advanced-console":break;case"debug":return new tp}return new tu(t)},e}(),td=function(){function e(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}return e.prototype.connect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(t){if(e=this.connection.options.cache,"redis"===this.clientType)e&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient();else if("ioredis"===this.clientType)e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType){if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else if(e&&e.options&&e.options.startupNodes)this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options);else throw Error("options.startupNodes required for "+this.clientType+".")}return[2]})})},e.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,new Promise(function(t,n){e.client.quit(function(r,i){if(r)return n(r);t(),e.client=void 0})})]})})},e.prototype.synchronize=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return[2]})})},e.prototype.getFromCache=function(e,t){var n=this;return new Promise(function(t,r){e.identifier?n.client.get(e.identifier,function(e,n){if(e)return r(e);t(JSON.parse(n))}):e.query?n.client.get(e.query,function(e,n){if(e)return r(e);t(JSON.parse(n))}):t(void 0)})},e.prototype.isExpired=function(e){return e.time+e.duration<new Date().getTime()},e.prototype.storeInCache=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){var t=this;return(0,s.Jh)(this,function(n){return[2,new Promise(function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,function(e,t){if(e)return r(e);n()}):e.query&&t.client.set(e.query,JSON.stringify(e),"PX",e.duration,function(e,t){if(e)return r(e);n()})})]})})},e.prototype.clear=function(e){return(0,s.mG)(this,void 0,void 0,function(){var e=this;return(0,s.Jh)(this,function(t){return[2,new Promise(function(t,n){e.client.flushdb(function(e,r){if(e)return n(e);t()})})]})})},e.prototype.remove=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var t=this;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return t.deleteKey(e)}))];case 1:return n.sent(),[2]}})})},e.prototype.deleteKey=function(e){var t=this;return new Promise(function(n,r){t.client.del(e,function(e,t){if(e)return r(e);n()})})},e.prototype.loadRedis=function(){try{if("ioredis/cluster"===this.clientType)return ek.Qm.load("ioredis");return ek.Qm.load(this.clientType)}catch(e){throw Error("Cannot use cache because "+this.clientType+' is not installed. Please run "npm i '+this.clientType+' --save".')}},e}(),tm=function(){function e(e){this.connection=e;var t=this.connection.driver.options,n=("object"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheTable=this.connection.driver.buildTableName(n,t.schema,t.database)}return e.prototype.connect=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return[2]})})},e.prototype.disconnect=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){return[2]})})},e.prototype.synchronize=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(this.queryResultCacheTable)];case 1:if(n.sent())return[2];return[4,e.createTable(new l.i({name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return n.sent(),[2]}})})},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof y.Z?new v.R(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?this.connection.driver instanceof ei.X?n.where("dbms_lob.compare("+n.escape("cache")+"."+n.escape("query")+", :query) = 0",{query:e.query}).getRawOne():n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof y.Z?new v.R(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){var t="string"==typeof e.duration?parseInt(e.duration):e.duration;return("string"==typeof e.time?parseInt(e.time):e.time)+t<new Date().getTime()},e.prototype.storeInCache=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i;return(0,s.Jh)(this,function(a){switch(a.label){case 0:if(n=this.getQueryRunner(n),r=e,this.connection.driver instanceof y.Z&&(r={identifier:new v.R(e.identifier,"nvarchar"),time:new v.R(e.time,"bigint"),duration:new v.R(e.duration,"int"),query:new v.R(e.query,"nvarchar"),result:new v.R(e.result,"nvarchar")}),!(t&&t.identifier))return[3,2];return(i=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r)).where(i.escape("identifier")+" = :condition",{condition:r.identifier}),[4,i.execute()];case 1:case 3:return a.sent(),[3,6];case 2:if(!(t&&t.query))return[3,4];return i=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r),this.connection.driver instanceof ei.X?i.where('dbms_lob.compare("query", :condition) = 0',{condition:r.query}):i.where(i.escape("query")+" = :condition",{condition:r.query}),[4,i.execute()];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(r).execute()];case 5:a.sent(),a.label=6;case 6:return[2]}})})},e.prototype.clear=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){return[2,this.getQueryRunner(e).clearTable(this.queryResultCacheTable)]})})},e.prototype.remove=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){var n=this;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){var r=n.getQueryRunner(t).manager.createQueryBuilder();return r.delete().from(n.queryResultCacheTable).where(r.escape("identifier")+" = :identifier",{identifier:e}).execute()}))];case 1:return r.sent(),[2]}})})},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner()},e}(),ty=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw Error("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");var e=this.connection.options.cache;return e.provider&&"function"==typeof e.provider?e.provider(this.connection):"redis"===e.type||"ioredis"===e.type||"ioredis/cluster"===e.type?new td(this.connection,e.type):new tm(this.connection)},e}(),tv=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n){return(n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner)?this.loadManyToOneOrOneToOneOwner(e,t,n):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n):this.loadManyToManyNotOwner(e,t,n)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.entityMetadata.primaryColumns,a=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(function(t){return e.entityMetadata.name+"."+t.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName}).join(" AND "),o=e.entityMetadata.name,s=this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,o,a);if(1===i.length)s.where(o+"."+i[0].propertyPath+" IN (:..."+o+"_"+i[0].propertyName+")"),s.setParameter(o+"_"+i[0].propertyName,r.map(function(e){return i[0].getEntityValue(e)}));else{var u=r.map(function(e,t){return i.map(function(n,r){var i=o+"_entity_"+t+"_"+r;return s.setParameter(i,n.getEntityValue(e)),o+"."+n.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ");s.where(u)}return s.getMany()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.inverseRelation.joinColumns,o=this.connection.createQueryBuilder(n).select(i).from(e.inverseRelation.entityMetadata.target,i);if(1===a.length)o.where(i+"."+a[0].propertyPath+" IN (:..."+i+"_"+a[0].propertyName+")"),o.setParameter(i+"_"+a[0].propertyName,r.map(function(e){return a[0].referencedColumn.getEntityValue(e)}));else{var s=r.map(function(e,t){return a.map(function(n,r){var a=i+"_entity_"+t+"_"+r;return o.setParameter(a,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+a}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ");o.where(s)}return o.getMany()},e.prototype.loadManyToManyOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.junctionEntityMetadata.tableName,o=e.joinColumns.map(function(e){return a+"."+e.propertyName+" IN (:..."+e.propertyName+")"}),u=e.inverseJoinColumns.map(function(e){return a+"."+e.propertyName+"="+i+"."+e.referencedColumn.propertyName}),c=e.joinColumns.reduce(function(e,t){return e[t.propertyName]=r.map(function(e){return t.referencedColumn.getEntityValue(e)}),e},{});return this.connection.createQueryBuilder(n).select(i).from(e.type,i).innerJoin(a,a,(0,s.fl)(o,u).join(" AND ")).setParameters(c).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.junctionEntityMetadata.tableName,o=e.inverseRelation.joinColumns.map(function(e){return a+"."+e.propertyName+" = "+i+"."+e.referencedColumn.propertyName}),u=e.inverseRelation.inverseJoinColumns.map(function(e){return a+"."+e.propertyName+" IN (:..."+e.propertyName+")"}),c=e.inverseRelation.inverseJoinColumns.reduce(function(e,t){return e[t.propertyName]=r.map(function(e){return t.referencedColumn.getEntityValue(e)}),e},{});return this.connection.createQueryBuilder(n).select(i).from(e.type,i).innerJoin(a,a,(0,s.fl)(o,u).join(" AND ")).setParameters(c).getMany()},e.prototype.enableLazyLoad=function(e,t,n){var r=this,i="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",o="__has_"+e.propertyName+"__",s=function(e,t){return e[i]=t,e[o]=!0,delete e[a],t},u=function(e,t){return delete e[o],delete e[i],e[a]=t,t.then(function(n){return e[a]===t?s(e,n):n}),t};Object.defineProperty(t,e.propertyName,{get:function(){return!0===this[o]||void 0!==this[i]?Promise.resolve(this[i]):this[a]?this[a]:u(this,r.load(e,this,n).then(function(t){return e.isOneToOne||e.isManyToOne?0===t.length?null:t[0]:t}))},set:function(e){e instanceof Promise?u(this,e):s(this,e)},configurable:!0})},e}(),tg=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n,r){return(0,s.mG)(this,void 0,void 0,function(){var i,a,o,u;return(0,s.Jh)(this,function(s){if(e instanceof eZ)i=e,a=Array.isArray(t)?t:[t],o=Array.isArray(n)?n:n?[n]:void 0;else{if(!(i=(u=this.connection.getMetadata(e)).findRelationWithPropertyPath(t)))throw Error('Relation "'+i+'" was not found in "'+u.name+'".');a=Array.isArray(n)?n:[n],o=Array.isArray(r)?r:r?[r]:void 0}return i.isManyToMany?[2,this.loadForManyToMany(i,a,o)]:i.isManyToOne||i.isOneToOneOwner?[2,this.loadForManyToOneAndOneToOneOwner(i,a,o)]:[2,this.loadForOneToManyAndOneToOneNotOwner(i,a,o)]})})},e.prototype.loadManyToManyRelationIdsAndGroup=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){var r,i,a,o,u,c;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(r=e.isManyToMany||e.isOneToMany,i=Array.isArray(t)?t:[t],n)return[3,2];return[4,this.connection.relationLoader.load(e,t)];case 1:if(!(n=s.sent()).length)return[2,i.map(function(e){return{entity:e,related:r?[]:void 0}})];s.label=2;case 2:return[4,this.load(e,t,n)];case 3:return a=s.sent(),o=Array.isArray(n)?n:[n],e.isManyToManyOwner?(u=e.junctionEntityMetadata.inverseColumns.map(function(e){return e.referencedColumn}),c=e.junctionEntityMetadata.ownerColumns.map(function(e){return e.referencedColumn})):e.isManyToManyNotOwner?(u=e.junctionEntityMetadata.ownerColumns.map(function(e){return e.referencedColumn}),c=e.junctionEntityMetadata.inverseColumns.map(function(e){return e.referencedColumn})):e.isManyToOne||e.isOneToOneOwner?(u=e.joinColumns.map(function(e){return e.referencedColumn}),c=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(u=e.inverseRelation.entityMetadata.primaryColumns,c=e.inverseRelation.joinColumns.map(function(e){return e.referencedColumn})),[2,i.map(function(t){var n={entity:t,related:r?[]:void 0};return a.forEach(function(i){c.every(function(e){return e.getEntityValue(t)===i[e.entityMetadata.name+"_"+e.propertyPath.replace(".","_")]})&&o.forEach(function(t){u.every(function(n){return n.getEntityValue(t)===i[n.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+n.propertyPath.replace(".","_")]})&&(r?n.related.push(t):n.related=t)})}),n})]}})})},e.prototype.loadForManyToMany=function(e,t,n){var r=e.junctionEntityMetadata,i=r.name,a=e.isOwning?r.ownerColumns:r.inverseColumns,o=e.isOwning?r.inverseColumns:r.ownerColumns,s=this.connection.createQueryBuilder();r.ownerColumns.forEach(function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+e.propertyPath,t)}),r.inverseColumns.forEach(function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+t.propertyPath,n)});var u="";1===a.length?(s.setParameter("values1",t.map(function(e){return a[0].referencedColumn.getEntityValue(e)})),u=i+"."+a[0].propertyPath+" IN (:...values1)"):u="("+t.map(function(e,t){return a.map(function(n){var r="entity1_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ")+")";var c="";return n&&(1===o.length?(s.setParameter("values2",n.map(function(e){return o[0].referencedColumn.getEntityValue(e)})),c=i+"."+o[0].propertyPath+" IN (:...values2)"):c="("+n.map(function(e,t){return o.map(function(n){var r="entity2_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ")+")"),s.from(r.target,i).where(u+(c?" AND "+c:"")).getRawMany()},e.prototype.loadForManyToOneAndOneToOneOwner=function(e,t,n){var r=e.entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach(function(e){var t=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)}),e.joinColumns.forEach(function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)});var a="";return 1===e.entityMetadata.primaryColumns.length?(i.setParameter("values",t.map(function(t){return e.entityMetadata.primaryColumns[0].getEntityValue(t)})),a=r+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)"):a=t.map(function(t,n){return e.entityMetadata.primaryColumns.map(function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e.prototype.loadForOneToManyAndOneToOneNotOwner=function(e,t,n){var r=(e=e.inverseRelation).entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach(function(t){var n=t.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+t.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)}),e.joinColumns.forEach(function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)});var a="";return 1===e.joinColumns.length?(i.setParameter("values",t.map(function(t){return e.joinColumns[0].referencedColumn.getEntityValue(t)})),a=r+"."+e.joinColumns[0].propertyPath+" IN (:...values)"):a=t.map(function(t,n){return e.joinColumns.map(function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.referencedColumn.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e}(),tb=n(7677),tE=function(){function e(e){this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=new tf().create(this.options.logger,this.options.logging),this.driver=new eQ().create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new h,this.queryResultCache=e.cache?new ty(this).create():void 0,this.relationLoader=new tv(this),this.relationIdLoader=new tg(this),this.isConnected=!1}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof g.$2))throw Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof eT))throw Error("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return(0,s.mG)(this,void 0,void 0,function(){var e;return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new f(this.name);return[4,this.driver.connect()];case 1:if(t.sent(),!this.queryResultCache)return[3,3];return[4,this.queryResultCache.connect()];case 2:t.sent(),t.label=3;case 3:eb.g.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:if(t.sent(),!this.options.dropSchema)return[3,7];return[4,this.dropDatabase()];case 6:t.sent(),t.label=7;case 7:if(!this.options.synchronize)return[3,9];return[4,this.synchronize()];case 8:t.sent(),t.label=9;case 9:if(!this.options.migrationsRun)return[3,11];return[4,this.runMigrations({transaction:this.options.migrationsTransactionMode})];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}})})},e.prototype.close=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new p(this.name);return[4,this.driver.disconnect()];case 1:if(e.sent(),!this.queryResultCache)return[3,3];return[4,this.queryResultCache.disconnect()];case 2:e.sent(),e.label=3;case 3:return eb.g.assign(this,{isConnected:!1}),[2]}})})},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new p(this.name);if(!e)return[3,2];return[4,this.dropDatabase()];case 1:t.sent(),t.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return t.sent(),[2]}})})},e.prototype.dropDatabase=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t,n,r,i,a,o;return(0,s.Jh)(this,function(u){switch(u.label){case 0:e=this.createQueryRunner(),u.label=1;case 1:if(u.trys.push([1,,13,15]),!(this.driver instanceof y.Z||this.driver instanceof g.p$||this.driver instanceof g.xI))return[3,10];t=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)}),u.label=2;case 2:u.trys.push([2,7,8,9]),r=(n=(0,s.XA)(t)).next(),u.label=3;case 3:if(r.done)return[3,6];return i=r.value,[4,e.clearDatabase(i)];case 4:u.sent(),u.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return a={error:u.sent()},[3,9];case 8:try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 9:return[3,12];case 10:return[4,e.clearDatabase()];case 11:u.sent(),u.label=12;case 12:return[3,15];case 13:return[4,e.release()];case 14:return u.sent(),[7];case 15:return[2]}})})},e.prototype.runMigrations=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new p(this.name);return(t=new b(this)).transaction=e&&e.transaction||"all",[4,t.executePendingMigrations()];case 1:return[2,n.sent()]}})})},e.prototype.undoLastMigration=function(e){return(0,s.mG)(this,void 0,void 0,function(){var t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new p(this.name);return(t=new b(this)).transaction=e&&e.transaction||"all",[4,t.undoLastMigration()];case 1:return n.sent(),[2]}})})},e.prototype.showMigrations=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new p(this.name);return[4,new b(this).showMigrations()];case 1:return[2,e.sent()]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new d(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof g.Qd))throw Error("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(n){return[2,this.manager.transaction(e,t)]})})},e.prototype.query=function(e,t,n){return(0,s.mG)(this,void 0,void 0,function(){var r;return(0,s.Jh)(this,function(i){switch(i.label){case 0:if(this instanceof g.$2)throw Error("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new S;r=n||this.createQueryRunner(),i.label=1;case 1:return i.trys.push([1,,3,6]),[4,r.query(e,t)];case 2:return[2,i.sent()];case 3:if(n)return[3,5];return[4,r.release()];case 4:i.sent(),i.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof g.$2)throw Error("Query Builder is not supported by MongoDB.");if(!t)return new to.Z(this,e);var r=this.getMetadata(e);return new to.Z(this,n).select(t).from(r.target,t)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw Error('Relation "'+t+'" was not found in '+e+" entity.");if(!n.isManyToMany)throw Error('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return new eC().create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find(function(t){return t.target===e||(e instanceof ti.I?t.name===e.options.name:"string"==typeof e&&(-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e))})},e.prototype.buildMetadatas=function(){var e=new ta(this),t=new R,n=e.buildSubscribers(this.options.subscribers||[]);eb.g.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[]);eb.g.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);eb.g.assign(this,{migrations:i}),this.driver.database=this.getDatabaseName(),t.validateMany(this.entityMetadatas.filter(function(e){return"view"!==e.tableType}),this.driver)},e.prototype.getDatabaseName=function(){var e=this.options;switch(e.type){case"mysql":case"mariadb":case"postgres":case"cockroachdb":case"mssql":case"oracle":return tb.z.buildDriverOptions(e.replication?e.replication.master:e).database;default:return tb.z.buildDriverOptions(e).database}},e}(),tT=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message='Connection "'+n+'" was not found.',r}return(0,s.ZT)(t,e),t}(Error),tN=function(e){function t(n){var r=e.call(this)||this;return r.name="AlreadyHasActiveConnectionError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a new connection named "'+n+'", because connection with such name already exist and it now has an active connection session.',r}return(0,s.ZT)(t,e),t}(Error),tC=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new tT(e);return t},e.prototype.create=function(e){var t=this.connections.find(function(t){return t.name===(e.name||"default")});if(t){if(t.isConnected)throw new tN(e.name||"default");this.connections.splice(this.connections.indexOf(t),1)}var n=new tE(e);return this.connections.push(n),n},e}();(function(){}).prototype.read=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){throw Error("Cannot read connection options in a browser context.")})})},(function(){}).prototype.read=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){throw Error("Cannot read connection options in a browser context.")})})},(function(){}).prototype.read=function(e){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){throw Error("Cannot read connection options in a browser context.")})})},function(){function e(){}e.prototype.all=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){throw Error("Cannot read connection options in a browser context.")})})},e.prototype.get=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){throw Error("Cannot read connection options in a browser context.")})})},e.prototype.has=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(e){throw Error("Cannot read connection options in a browser context.")})})}}();var tw=function(e){function t(n,r){var i=e.call(this)||this;return i.name="ColumnTypeUndefinedError",Object.setPrototypeOf(i,t.prototype),i.message="Column type for "+n.constructor.name+"#"+r+' is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.',i}return(0,s.ZT)(t,e),t}(Error);function tA(e,t){return function(n,r){"string"==typeof e||e instanceof Function?i=e:e&&(t=e,i=e.type),t||(t={});var i,a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),"hstore"!==t.type||t.hstoreType||(t.hstoreType=a===Object?"object":"string"),e instanceof Function)tI().embeddeds.push({target:n.constructor,propertyName:r,isArray:a===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:e});else{if(!t.type)throw new tw(n,r);!0===t.unique&&tI().uniques.push({target:n.constructor,columns:[r]}),tI().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&tI().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}function tM(e,t){var n,r={};return e?("string"==typeof e&&(n=e),e instanceof Object&&(n="increment",Object.assign(r,e))):n="increment",t instanceof Object&&Object.assign(r,t),function(e,t){r.type||("increment"===n?r.type=Number:"uuid"===n?r.type="uuid":"rowid"!==n||(r.type="int")),r.primary=!0,tI().columns.push({target:e.constructor,propertyName:t,mode:"regular",options:r}),tI().generations.push({target:e.constructor,propertyName:t,strategy:n})}}function tR(e){return function(t,n){(Array.isArray(e)?e:[e||{}]).forEach(function(e){tI().joinColumns.push({target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName})})}}function tS(e,t,n){var r;return"object"==typeof t?n=t:r=t,function(t,i){n||(n={});var a=!!n&&!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}tI().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function tO(e,t,n){return function(r,i){n||(n={});var a=!!n&&!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",r,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}tI().relations.push({target:r.constructor,propertyName:i,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n})}}function tx(e,t){var n=("object"==typeof e?e:t)||{},r="string"==typeof e?e:n.name;return function(e){tI().tables.push({target:e,name:r,type:"regular",orderBy:n.orderBy?n.orderBy:void 0,engine:n.engine?n.engine:void 0,database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:n.synchronize,withoutRowid:n.withoutRowid})}}function tP(e,t,n){var r="string"==typeof e?e:void 0,i="string"==typeof e?t:e,a="object"!=typeof e||Array.isArray(e)?n:e;return a||(a="object"!=typeof t||Array.isArray(t)?n:t),function(e,t){tI().indices.push({target:t?e.constructor:e,name:r,columns:t?[t]:i,synchronize:!a||!1!==a.synchronize,where:a?a.where:void 0,unique:!!a&&!!a.unique,spatial:!!a&&!!a.spatial,fulltext:!!a&&!!a.fulltext,parser:a?a.parser:void 0,sparse:!!a&&!!a.sparse,background:!!a&&!!a.background,expireAfterSeconds:a?a.expireAfterSeconds:void 0})}}/*!
 */function tI(){var e=ek.Qm.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new tn),e.typeormMetadataArgsStorage}function tD(e){return void 0===e&&(e="default"),eW(tC).get(e)}r=Error,(0,s.ZT)(function e(t,n){var i=r.call(this)||this;return i.name="PrimaryColumnCannotBeNullableError",Object.setPrototypeOf(i,e.prototype),i.message="Primary column "+t.constructor.name+"#"+n+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",i},r),i=Error,(0,s.ZT)(function e(t,n){var r=i.call(this)||this;return r.name="CannotReflectMethodParameterTypeError",Object.setPrototypeOf(r,e.prototype),r.message='Cannot get reflected type for a "'+n+'" method\'s parameter of "'+t.name+'" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.',r},i),n(4759),n(8518),function(){function e(){}e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(e){return this.constructor.getRepository().save(this,e)},e.prototype.remove=function(e){return this.constructor.getRepository().remove(this,e)},e.prototype.softRemove=function(e){return this.constructor.getRepository().softRemove(this,e)},e.prototype.recover=function(e){return this.constructor.getRepository().recover(this,e)},e.prototype.reload=function(){return(0,s.mG)(this,void 0,void 0,function(){var e,t;return(0,s.Jh)(this,function(n){switch(n.label){case 0:return[4,(e=this.constructor).getRepository().findOneOrFail(e.getId(this))];case 1:return t=n.sent(),eb.g.assign(this,t),[2]}})})},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||tD()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.getRepository()).merge.apply(t,(0,s.fl)([e],n))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.softRemove=function(e,t){return this.getRepository().softRemove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.findOneOrFail=function(e,t){return this.getRepository().findOneOrFail(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()}}(),n(879),n(124),n(9033),n(9396),n(9652),n(1959),n(7229),n(7612),n(6864),n(8394),n(6930),n(480),n(2593),n(1568),n(3528)},2367:function(e,t,n){"use strict";n.d(t,{T:function(){return u}});var r=n(274),i=n(5738),a=n(7089),o=n(4759),s=n(8535),u=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.comment="",this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),void 0!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter(function(e){return isNaN(+e)}).map(function(t){return e.args.options.enum[t]}):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isDeleteDate="deleteDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),void 0===this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}return e.prototype.createValueMap=function(e,t){var n,i=this;if(void 0===t&&(t=!1),!this.embeddedMetadata)return("increment"===this.generationStrategy||"rowid"===this.generationStrategy)&&"bigint"===this.type&&null!==e&&(e=String(e)),(n={})[t?this.databaseName:this.propertyName]=e,n;var a=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),o=function(n,r){var a=n.shift();return a?(r[a]={},o(n,r[a]),r):(("increment"===i.generationStrategy||"rowid"===i.generationStrategy)&&"bigint"===i.type&&null!==e&&(e=String(e)),r[t?i.databaseName:i.propertyName]=e,r)};return o(a,{})},e.prototype.getEntityValueMap=function(e,t){var n,a,o=this;if(this.embeddedMetadata){var s=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),u=function(e,t,n){var r=e.shift();if(void 0===t)return n;if(r){var i={};return u(e,t[r],i),Object.keys(i).length>0&&(n[r]=i),n}return void 0!==t[o.propertyName]&&(n[o.propertyName]=t[o.propertyName]),n},c={};return u(s,e,c),Object.keys(c).length>0?c:void 0}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var c=this.relationMetadata.joinColumns.reduce(function(t,n){var r=n.referencedColumn.getEntityValueMap(e[o.propertyName]);return void 0===r?t:i.s.mergeDeep(t,r)},{});return Object.keys(c).length>0?((n={})[this.propertyName]=c,n):void 0}return void 0!==e[this.propertyName]?((a={})[this.propertyName]=e[this.propertyName],a):void 0},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){var n=void 0;if(this.embeddedMetadata){var i=(0,r.fl)(this.embeddedMetadata.parentPropertyNames),a=function(e,t){var n=e.shift();return n&&t?a(e,t[n]):t},u=a(i,e);if(u){if(this.relationMetadata&&this.referencedColumn){var c=this.relationMetadata.getEntityValue(u);n=c&&c instanceof Object&&!(c instanceof o.J)?this.referencedColumn.getEntityValue(c):u[this.propertyName]&&u[this.propertyName]instanceof Object&&!(u[this.propertyName]instanceof o.J)?this.referencedColumn.getEntityValue(u[this.propertyName]):u[this.propertyName]}else n=this.referencedColumn?this.referencedColumn.getEntityValue(u[this.propertyName]):u[this.propertyName]}}else if(this.relationMetadata&&this.referencedColumn){var c=this.relationMetadata.getEntityValue(e);n=!c||!(c instanceof Object)||c instanceof o.J||c instanceof Function?!e[this.propertyName]||!(e[this.propertyName]instanceof Object)||e[this.propertyName]instanceof o.J||e[this.propertyName]instanceof Function?e[this.propertyName]:this.referencedColumn.getEntityValue(e[this.propertyName]):this.referencedColumn.getEntityValue(c)}else n=this.referencedColumn?this.referencedColumn.getEntityValue(e[this.propertyName]):e[this.propertyName];return t&&this.transformer&&(n=s.A.transformTo(this.transformer,n)),n}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n.propertyName]=t,r)};return i((0,r.fl)(this.embeddedMetadata.embeddedMetadataTree),e)}!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=t):e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof a.Qd&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}()},6097:function(e,t,n){"use strict";n.d(t,{T:function(){return h}});var r=n(274),i=n(7089),a=n(7349),o=n(9772),s=n(1429),u=function(e){function t(n,r){var i=e.call(this)||this;i.name="CannotCreateEntityIdMapError",Object.setPrototypeOf(i,t.prototype);var a=n.primaryColumns.reduce(function(e,t,n){return t.setEntityValue(e,n+1),e},{});return i.message='Cannot use given entity id "'+r+'" because "'+n.targetName+'" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(a)+" as an id.",i}return(0,r.ZT)(t,e),t}(Error),c=n(5738),l=n(5022),h=function(){function e(e){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid}return e.prototype.create=function(e){var t,n=this;if(this.target instanceof Function)return t=new this.target,this.lazyRelations.forEach(function(r){return n.connection.relationLoader.enableLazyLoad(r,t,e)}),t;var r={};return this.lazyRelations.forEach(function(t){return n.connection.relationLoader.enableLazyLoad(t,r,e)}),r},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!=n&&""!==n})},e.prototype.hasAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){return null!=t.getEntityValue(e)})},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new u(this,e);return this.primaryColumns[0].createValueMap(e)},e.prototype.getEntityIdMap=function(t){if(t)return e.getValueMap(t,this.primaryColumns,{skipNulls:!0})},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);if(this.hasMultiplePrimaryKeys);else if(t)return this.primaryColumns[0].getEntityValue(t);return t},e.prototype.compareEntities=function(e,t){var n=this.getEntityIdMap(e);if(!n)return!1;var r=this.getEntityIdMap(t);return!!r&&c.s.compareIds(n,r)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find(function(t){return t.propertyName===e})},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find(function(t){return t.databaseName===e})},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return t;var n=this.relations.find(function(t){return t.propertyPath===e});if(n&&1===n.joinColumns.length)return n.joinColumns[0]},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return[t];var n=this.relations.find(function(t){return t.propertyPath===e});return n&&n.joinColumns?n.joinColumns:[]},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.hasEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.some(function(t){return t.propertyPath===e})},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find(function(t){return t.propertyPath===e})},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=this,r=[];return t.forEach(function(t){var i=t.getEntityValue(e);Array.isArray(i)?i.forEach(function(e){return r.push([t,e,n.getInverseEntityMetadata(e,t)])}):i&&r.push([t,i,n.getInverseEntityMetadata(i,t)])}),r},e.prototype.getInverseEntityMetadata=function(e,t){return t.inverseEntityMetadata.childEntityMetadatas.find(function(t){return t.target===e.constructor})||t.inverseEntityMetadata},e.createPropertyPath=function(e,t,n){var i=this;void 0===n&&(n="");var a=[];return Object.keys(t).forEach(function(o){var s=n?n+"."+o:o;if(e.hasEmbeddedWithPropertyPath(s)){var u=i.createPropertyPath(e,t[o],s);a.push.apply(a,(0,r.fl)(u))}else{var c=n?n+"."+o:o;a.push(c)}}),a},e.difference=function(e,t){return e.filter(function(e){return!t.find(function(t){return c.s.compareIds(e,t)})})},e.getValueMap=function(e,t,n){return t.reduce(function(t,r){var i=r.getEntityValueMap(e,n);if(void 0!==t&&null!=i)return r.isObjectId?Object.assign(t,i):c.s.mergeDeep(t,i)},{})},e.prototype.build=function(){var e=this.connection.namingStrategy,t=this.connection.options.entityPrefix;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:this.schema=this.connection.options.schema,this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=(0,l.OV)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=t?e.prefixTableName(t,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.buildTablePath(),this.schemaPath=this.buildSchemaPath(),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type},e.prototype.registerColumn=function(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter(function(e){return e.isGenerated||"uuid"===e.generationStrategy}).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach(function(t){return t.registerColumn(e)}))},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return c.s.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return c.s.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e.prototype.buildTablePath=function(){var e=this.tableName;return this.schema&&(this.connection.driver instanceof s.X||this.connection.driver instanceof i.U4||this.connection.driver instanceof o.Z||this.connection.driver instanceof a.t)&&(e=this.schema+"."+e),!this.database||this.connection.driver instanceof i.U4||(e=!this.schema&&this.connection.driver instanceof o.Z?this.database+".."+e:this.database+"."+e),e},e.prototype.buildSchemaPath=function(){if(this.schema)return!this.database||this.connection.driver instanceof i.U4?this.schema:this.database+"."+this.schema},e}()},7089:function(e,t,n){"use strict";n.d(t,{$2:function(){return a},En:function(){return i},J1:function(){return c},Qd:function(){return r},R4:function(){return p},U4:function(){return s},Z7:function(){return h},p$:function(){return l},xI:function(){return u},yX:function(){return o}});var r=function(){},i=function(){},a=function(){},o=function(){},s=function(){},u=function(){},c=function(){},l=function(){},h=function(){},p=function(){}},418:function(e,t,n){"use strict";n.d(t,{Qm:function(){return r}});var r=function(){function e(){}return e.getGlobalVariable=function(){return"undefined"!=typeof window?window:n.g},e.load=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormalize=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.dotenv=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "'+e+'" }).')},e.getEnvVariable=function(e){},e.readFileSync=function(e){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},e.appendFileSync=function(e,t){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},e.writeFile=function(e,t){if("browser"===this.type)throw Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},e.highlightSql=function(e){return e},e.highlightJson=function(e){return e},e.logInfo=function(e,t){console.info(e+" ",t)},e.logError=function(e,t){console.error(e+" ",t)},e.logWarn=function(e,t){console.warn(e+" ",t)},e.log=function(e){console.log(e)},e.warn=function(e){return e},e.type="browser",e}();"undefined"!=typeof window&&(window.Buffer=n(8764).Buffer),void 0!==n.g&&(n.g.Buffer=n(8764).Buffer)},480:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var r=function(e){this.whereFactory=e}},7612:function(e,t,n){"use strict";n.d(t,{T:function(){return f}});var r=n(274),i=n(7089),a=n(1429),o=n(7229),s=n(9772),u=n(3528),c=n(581),l=n(2106),h=n(1444),p=n(4678),f=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createDeleteExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,o,c,p,f,d,m,y;return(0,r.Jh)(this,function(v){switch(v.label){case 0:t=(e=(0,r.CR)(this.getQueryAndParameters(),2))[0],n=e[1],o=this.obtainQueryRunner(),c=!1,v.label=1;case 1:if(v.trys.push([1,11,16,21]),!(!0===this.expressionMap.useTransaction&&!1===o.isTransactionActive))return[3,3];return[4,o.startTransaction()];case 2:v.sent(),c=!0,v.label=3;case 3:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(p=new h.D,o.broadcaster.broadcastBeforeRemoveEvent(p,this.expressionMap.mainAlias.metadata),!(p.promises.length>0)))return[3,5];return[4,Promise.all(p.promises)];case 4:v.sent(),v.label=5;case 5:return f=new u.y,[4,o.query(t,n)];case 6:if(d=v.sent(),(m=o.connection.driver)instanceof i.p$||m instanceof i.xI?(f.raw=d,f.affected=d.affectedRows):m instanceof s.Z||m instanceof i.U4||m instanceof i.J1?(f.raw=d[0]?d[0]:null,f.affected="number"==typeof d[1]?d[1]:null):m instanceof a.X?f.affected=d:m instanceof i.R4?(f.raw=d,f.affected=d.changes):f.raw=d,!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(p=new h.D,o.broadcaster.broadcastAfterRemoveEvent(p,this.expressionMap.mainAlias.metadata),!(p.promises.length>0)))return[3,8];return[4,Promise.all(p.promises)];case 7:v.sent(),v.label=8;case 8:if(!c)return[3,10];return[4,o.commitTransaction()];case 9:v.sent(),v.label=10;case 10:return[2,f];case 11:if(y=v.sent(),!c)return[3,15];v.label=12;case 12:return v.trys.push([12,14,,15]),[4,o.rollbackTransaction()];case 13:case 14:return v.sent(),[3,15];case 15:throw y;case 16:if(!(o!==this.queryRunner))return[3,18];return[4,o.release()];case 17:v.sent(),v.label=18;case 18:if(!(this.connection.driver instanceof l.x&&!o.isTransactionActive))return[3,20];return[4,this.connection.driver.autoSave()];case 19:v.sent(),v.label=20;case 20:return[7];case 21:return[2]}})})},t.prototype.from=function(e,t){e=e instanceof p.IU?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new c.y;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression();return n&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof i.J1)?"DELETE FROM "+e+t+" RETURNING "+n:""!==n&&this.connection.driver instanceof s.Z?"DELETE FROM "+e+" OUTPUT "+n+t:"DELETE FROM "+e+t},t}(o.z)},6864:function(e,t,n){"use strict";n.d(t,{O:function(){return g}});var r=n(274),i=n(7089),a=n(7349),o=n(7229),s=n(9772),u=n(8664),c=n(2593),l=n(581),h=function(e){function t(){var n=e.call(this)||this;return n.name="InsertValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.',n}return(0,r.ZT)(t,e),t}(Error),p=n(6120),f=n(3595),d=n(2106),m=n(1444),y=n(4962),v=n(1429),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createInsertExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,u,l,h,f,y,g,b,E,T,N=this;return(0,r.Jh)(this,function(C){switch(C.label){case 0:if(0===(e=this.getValueSets()).length)return[2,new c.t];t=this.obtainQueryRunner(),n=!1,C.label=1;case 1:if(C.trys.push([1,13,18,23]),!(!0===this.expressionMap.useTransaction&&!1===t.isTransactionActive))return[3,3];return[4,t.startTransaction()];case 2:C.sent(),n=!0,C.label=3;case 3:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(i=new m.D,e.forEach(function(e){t.broadcaster.broadcastBeforeInsertEvent(i,N.expressionMap.mainAlias.metadata,e)}),!(i.promises.length>0)))return[3,5];return[4,Promise.all(i.promises)];case 4:C.sent(),C.label=5;case 5:return a=null,o=null,u=new p.v(t,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver instanceof v.X||(this.expressionMap.extraReturningColumns=u.getInsertionReturningColumns()),this.expressionMap.extraReturningColumns.length>0&&this.connection.driver instanceof s.Z&&(a=this.connection.driver.buildTableVariableDeclaration("@OutputTable",this.expressionMap.extraReturningColumns),o="SELECT * FROM @OutputTable")),h=(l=(0,r.CR)(this.getQueryAndParameters(),2))[0],f=l[1],y=new c.t,g=[a,h,o],b=y,[4,t.query(g.filter(function(e){return null!=e}).join(";\n\n"),f)];case 6:if(b.raw=C.sent(),!(!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata))return[3,8];return[4,u.insert(y,e)];case 7:C.sent(),C.label=8;case 8:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(E=new m.D,e.forEach(function(e){t.broadcaster.broadcastAfterInsertEvent(E,N.expressionMap.mainAlias.metadata,e)}),!(E.promises.length>0)))return[3,10];return[4,Promise.all(E.promises)];case 9:C.sent(),C.label=10;case 10:if(!n)return[3,12];return[4,t.commitTransaction()];case 11:C.sent(),C.label=12;case 12:return[2,y];case 13:if(T=C.sent(),!n)return[3,17];C.label=14;case 14:return C.trys.push([14,16,,17]),[4,t.rollbackTransaction()];case 15:case 16:return C.sent(),[3,17];case 17:throw T;case 18:if(!(t!==this.queryRunner))return[3,20];return[4,t.release()];case 19:C.sent(),C.label=20;case 20:if(!(this.connection.driver instanceof d.x&&!t.isTransactionActive))return[3,22];return[4,this.connection.driver.autoSave()];case 21:C.sent(),C.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.into=function(e,t){e=e instanceof y.I?e.options.name:e;var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.y;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.orIgnore=function(e){return void 0===e&&(e=!0),this.expressionMap.onIgnore=e,this},t.prototype.orUpdate=function(e){return this.expressionMap.onUpdate={},e&&Array.isArray(e.conflict_target)&&(this.expressionMap.onUpdate.conflict=" ( "+e.conflict_target.join(", ")+" ) "),e&&"string"==typeof e.conflict_target&&(this.expressionMap.onUpdate.conflict=" ON CONSTRAINT "+e.conflict_target+" "),e&&Array.isArray(e.columns)&&(this.expressionMap.onUpdate.columns=e.columns.map(function(e){return e+" = :"+e}).join(", ")),e&&Array.isArray(e.overwrite)&&(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI?this.expressionMap.onUpdate.overwrite=e.overwrite.map(function(e){return e+" = VALUES("+e+")"}).join(", "):(this.connection.driver instanceof i.U4||this.connection.driver instanceof f.w||this.connection.driver instanceof i.J1)&&(this.expressionMap.onUpdate.overwrite=e.overwrite.map(function(e){return e+" = EXCLUDED."+e}).join(", "))),this},t.prototype.createInsertExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n=this.connection.driver instanceof v.X&&this.getValueSets().length>1?null:this.createReturningExpression(),r=this.createColumnNamesExpression(),a="INSERT ";if((this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)&&(a+=this.expressionMap.onIgnore?" IGNORE ":""),a+="INTO "+e,r?a+="("+r+")":!t&&(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)&&(a+="()"),n&&this.connection.driver instanceof s.Z&&(a+=" OUTPUT "+n),t?this.connection.driver instanceof v.X&&this.getValueSets().length>1?a+=" "+t:a+=" VALUES "+t:this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI?a+=" VALUES ()":a+=" DEFAULT VALUES",this.connection.driver instanceof i.U4||this.connection.driver instanceof f.w||this.connection.driver instanceof i.J1){if(a+=(this.expressionMap.onIgnore?" ON CONFLICT DO NOTHING ":"")+(this.expressionMap.onConflict?" ON CONFLICT "+this.expressionMap.onConflict:""),this.expressionMap.onUpdate){var o=this.expressionMap.onUpdate,u=o.overwrite,c=o.columns,l=o.conflict;a+=(c?" ON CONFLICT "+l+" DO UPDATE SET "+c:"")+(u?" ON CONFLICT "+l+" DO UPDATE SET "+u:"")}}else if((this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)&&this.expressionMap.onUpdate){var h=this.expressionMap.onUpdate,u=h.overwrite,c=h.columns;a+=(c?" ON DUPLICATE KEY UPDATE "+c:"")+(u?" ON DUPLICATE KEY UPDATE "+u:"")}return n&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof v.X||this.connection.driver instanceof i.J1)&&(a+=" RETURNING "+n),a},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(function(t){return e.expressionMap.insertColumns.length?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):!!t.isInsert&&(!t.isGenerated||"increment"!==t.generationStrategy||e.connection.driver instanceof v.X||e.connection.driver instanceof f.w||e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI)}):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(t.length>0)return t.map(function(t){return e.escape(t.databaseName)}).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var n=this.getValueSets();if(1===n.length)return Object.keys(n[0]).map(function(t){return e.escape(t)}).join(", ")}return this.expressionMap.insertColumns.map(function(t){return e.escape(t)}).join(", ")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){var r="",o=Object.keys(this.expressionMap.nativeParameters).length;return(t.forEach(function(c,l){n.forEach(function(h,p){0===p&&(e.connection.driver instanceof v.X&&t.length>1?r+=" SELECT ":r+="(");var d="i"+l+"_"+h.databaseName,m=h.getEntityValue(c);if(m instanceof Function||(m=e.connection.driver.preparePersistentValue(m,h)),h.isVersion&&void 0===m)r+="1";else if(h.isDiscriminator)e.expressionMap.nativeParameters["discriminator_value_"+o]=e.expressionMap.mainAlias.metadata.discriminatorValue,r+=e.connection.driver.createParameter("discriminator_value_"+o,o),o++;else if(h.isGenerated&&"uuid"===h.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===m){var y="uuid_"+h.databaseName+l;m=u.f.uuid4(),e.expressionMap.nativeParameters[y]=m,r+=e.connection.driver.createParameter(y,o),o++}else if(void 0===m)e.connection.driver instanceof v.X&&t.length>1||e.connection.driver instanceof f.w||e.connection.driver instanceof a.t?void 0!==h.default?r+=e.connection.driver.normalizeDefault(h):r+="NULL":r+="DEFAULT";else if(m instanceof Function)r+=m();else{if(e.connection.driver instanceof s.Z&&(m=e.connection.driver.parametrizeValue(h,m)),e.expressionMap.nativeParameters[d]=m,(e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI)&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)){var g=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";null!=h.srid?r+=g+"("+e.connection.driver.createParameter(d,o)+", "+h.srid+")":r+=g+"("+e.connection.driver.createParameter(d,o)+")"}else e.connection.driver instanceof i.U4&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)?null!=h.srid?r+="ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(d,o)+"), "+h.srid+")::"+h.type:r+="ST_GeomFromGeoJSON("+e.connection.driver.createParameter(d,o)+")::"+h.type:e.connection.driver instanceof s.Z&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)?r+=h.type+"::STGeomFromText("+e.connection.driver.createParameter(d,o)+", "+(h.srid||"0")+")":r+=e.connection.driver.createParameter(d,o);o++}p===n.length-1?l===t.length-1?e.connection.driver instanceof v.X&&t.length>1?r+=" FROM DUAL ":r+=")":e.connection.driver instanceof v.X&&t.length>1?r+=" FROM DUAL UNION ALL ":r+="), ":r+=", "})}),"()"===r)?"":r}var c="",l=Object.keys(this.expressionMap.nativeParameters).length;return(t.forEach(function(n,r){Object.keys(n).forEach(function(i,o){0===o&&(c+="(");var s="i"+r+"_"+i,u=n[i];u instanceof Function?c+=u():void 0===u?e.connection.driver instanceof f.w||e.connection.driver instanceof a.t?c+="NULL":c+="DEFAULT":(e.expressionMap.nativeParameters[s]=u,c+=e.connection.driver.createParameter(s,l),l++),o===Object.keys(n).length-1?r===t.length-1?c+=")":c+="), ":c+=", "})}),"()"===c)?"":c},t.prototype.getValueSets=function(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new h},t}(o.z)},5784:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var r=n(274),i=n(2749),a=n(7264),o=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,a.g.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){var e=this;return this.isSelectedEvaluated||(this.isSelectedCache=function(){var t,n,i=function(t){if(t.selection===e.alias.name||e.metadata&&e.metadata.columns.find(function(n){return t.selection===e.alias.name+"."+n.propertyPath}))return{value:!0}};try{for(var a=(0,r.XA)(e.queryExpressionMap.selects),o=a.next();!o.done;o=a.next()){var s=o.value,u=i(s);if("object"==typeof u)return u.value}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1}(),this.isSelectedEvaluated=!0),this.isSelectedCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(i.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(i.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){var e=this;return this.relationEvaluated||(this.relationCache=(function(){if(i.G.isAliasProperty(e.entityOrProperty)){var t=e.queryExpressionMap.findAliasByName(e.parentAlias),n=t.metadata.findRelationWithPropertyPath(e.relationPropertyPath);if(n||t.metadata.parentEntityMetadata&&(n=t.metadata.parentEntityMetadata.findRelationWithPropertyPath(e.relationPropertyPath)))return n;throw Error("Relation with property path "+e.relationPropertyPath+" in entity was not found.")}}).bind(this)(),this.relationEvaluated=!0),this.relationCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},7229:function(e,t,n){"use strict";n.d(t,{z:function(){return E}});var r=n(274),i=n(7264),a=function(){function e(e){i.g.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),o=n(5784),s=n(6869),u=n(58),c=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={}}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce(function(n,r){return n[e.mainAlias.name+"."+r]=t[r],n},{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=(0,r.CR)(e.split("."),2),n=t[0],i=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(i)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw Error("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw Error("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map(function(e){return e}),n.selectDistinct=this.selectDistinct,n.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(function(e){return n.aliases.push(new a(e))}),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.onIgnore=this.onIgnore,n.onUpdate=this.onUpdate,n.joinAttributes=this.joinAttributes.map(function(e){return new o.k(t.connection,t,e)}),n.relationIdAttributes=this.relationIdAttributes.map(function(e){return new s.b(t,e)}),n.relationCountAttributes=this.relationCountAttributes.map(function(e){return new u.$(t,e)}),n.wheres=this.wheres.map(function(e){return(0,r.pi)({},e)}),n.havings=this.havings.map(function(e){return(0,r.pi)({},e)}),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map(function(e){return e}),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.withDeleted=this.withDeleted,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n.insertColumns=this.insertColumns,n.whereEntities=this.whereEntities,n.updateEntity=this.updateEntity,n.callListeners=this.callListeners,n.useTransaction=this.useTransaction,n.nativeParameters=Object.assign({},this.nativeParameters),n.comment=this.comment,n},e}(),l=n(480),h=n(6097),p=n(2106),f=n(7089),d=n(9772),m=n(1429),y=n(4678),v=n(4759),g=n(8518),b=n(5072),E=function(){function e(t,n){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new c(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=n(7884).Z;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=n(6864).O;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if((e=e instanceof y.IU?e.options.name:e)instanceof Function||"string"==typeof e){var i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;var a=n(8394).T;return this instanceof a?this:new a(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=n(7612).T;return this instanceof e?this:new e(this)},e.prototype.softDelete=function(){this.expressionMap.queryType="soft-delete";var e=n(9617).B;return this instanceof e?this:new e(this)},e.prototype.restore=function(){this.expressionMap.queryType="restore";var e=n(9617).B;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2==arguments.length?e:void 0,i=2==arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){var a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}var o=n(6930).K;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every(function(e){return!!n.findRelationWithPropertyPath(e)})},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach(function(t){if(e[t]instanceof Function)throw Error("Function parameter isn't supported in the parameters. Please check \""+t+'" parameter.')}),this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach(function(n){return t.setParameter(n,e[n])}),this},e.prototype.setNativeParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(function(n){t.expressionMap.nativeParameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.printSql=function(){var e=(0,r.CR)(this.getQueryAndParameters(),2),t=e[0],n=e[1];return this.connection.logger.logQuery(t,n),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i;return(0,r.Jh)(this,function(a){switch(a.label){case 0:t=(e=(0,r.CR)(this.getQueryAndParameters(),2))[0],n=e[1],i=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,3,8]),[4,i.query(t,n)];case 2:return[2,a.sent()];case 3:if(!(i!==this.queryRunner))return[3,5];return[4,i.release()];case 4:a.sent(),a.label=5;case 5:if(!(this.connection.driver instanceof p.x))return[3,7];return[4,this.connection.driver.autoSave()];case 6:a.sent(),a.label=7;case 7:return[7];case 8:return[2]}})})},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.comment=function(e){return this.expressionMap.comment=e,this},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(".").map(function(e){return""===e?e:t.escape(e)}).join(".")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}if("string"==typeof e){var r="("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:r?void 0:e,subQuery:r?e:void 0})}var i=e(this.subQuery());this.setParameters(i.getParameters());var a=i.getQuery();return this.expressionMap.createAlias({type:"from",name:t,subQuery:a})},e.prototype.replacePropertyNames=function(e){var t,n,i=this,a=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},o=this;try{for(var s=(0,r.XA)(this.expressionMap.aliases),u=s.next();!u.done;u=s.next()){var c=u.value;!function(t){if(t.hasMetadata){var n,s,u,c,l,h,p,f,d,m,y,v,g=o.expressionMap.aliasNamePrefixingEnabled?t.name+".":"",b=o.expressionMap.aliasNamePrefixingEnabled?o.escape(t.name)+".":"",E={};try{for(var T=(n=void 0,(0,r.XA)(t.metadata.relations)),N=T.next();!N.done;N=T.next()){var C=N.value;C.joinColumns.length>0&&(E[C.propertyPath]=C.joinColumns[0].databaseName)}}catch(e){n={error:e}}finally{try{N&&!N.done&&(s=T.return)&&s.call(T)}finally{if(n)throw n.error}}try{for(var w=(u=void 0,(0,r.XA)(t.metadata.relations)),A=w.next();!A.done;A=w.next()){var C=A.value;try{for(var M=(l=void 0,(0,r.XA)((0,r.fl)(C.joinColumns,C.inverseJoinColumns))),R=M.next();!R.done;R=M.next()){var S=R.value;E[C.propertyPath+"."+S.referencedColumn.propertyPath]=S.databaseName}}catch(e){l={error:e}}finally{try{R&&!R.done&&(h=M.return)&&h.call(M)}finally{if(l)throw l.error}}}}catch(e){u={error:e}}finally{try{A&&!A.done&&(c=w.return)&&c.call(w)}finally{if(u)throw u.error}}try{for(var O=(p=void 0,(0,r.XA)(t.metadata.columns)),x=O.next();!x.done;x=O.next()){var P=x.value;E[P.databaseName]=P.databaseName}}catch(e){p={error:e}}finally{try{x&&!x.done&&(f=O.return)&&f.call(O)}finally{if(p)throw p.error}}try{for(var I=(d=void 0,(0,r.XA)(t.metadata.columns)),D=I.next();!D.done;D=I.next()){var P=D.value;E[P.propertyName]=P.databaseName}}catch(e){d={error:e}}finally{try{D&&!D.done&&(m=I.return)&&m.call(I)}finally{if(d)throw d.error}}try{for(var q=(y=void 0,(0,r.XA)(t.metadata.columns)),_=q.next();!_.done;_=q.next()){var P=_.value;E[P.propertyPath]=P.databaseName}}catch(e){y={error:e}}finally{try{_&&!_.done&&(v=q.return)&&v.call(q)}finally{if(y)throw y.error}}var j=Object.keys(E);j.length&&(e=e.replace(RegExp("(?<=[ =(]|^.{0})"+a(g)+"("+j.map(a).join("|")+")(?=[ =),]|.{0}$)","gm"),function(e,t){return""+b+i.escape(E[t])}))}}(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return e},e.prototype.createComment=function(){return this.expressionMap.comment?"/* "+this.expressionMap.comment.replace("*/","")+" */ ":""},e.prototype.createWhereExpression=function(){var e=[];if(this.createWhereExpressionString().trim()&&e.push(this.createWhereExpressionString()),this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&t.deleteDateColumn){var n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.deleteDateColumn.propertyName:t.deleteDateColumn.propertyName,r=this.replacePropertyNames(n)+" IS NULL";e.push(r)}if(t.discriminatorColumn&&t.parentEntityMetadata){var n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,r=this.replacePropertyNames(n)+" IN (:...discriminatorColumnValues)";e.push(r)}}if(this.expressionMap.extraAppendedAndWhereCondition){var r=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(r)}return e.length?1===e.length?" WHERE "+e[0]:" WHERE ( "+e.join(" ) AND ( ")+" )":" "},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns(),n=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported()&&t.push.apply(t,(0,r.fl)(this.expressionMap.extraReturningColumns.filter(function(e){return -1===t.indexOf(e)}))),t.length){var i=t.map(function(t){var r=e.escape(t.databaseName);return n instanceof d.Z?"insert"===e.expressionMap.queryType||"update"===e.expressionMap.queryType||"soft-delete"===e.expressionMap.queryType||"restore"===e.expressionMap.queryType?"INSERTED."+r:e.escape(e.getMainTableName())+"."+r:r}).join(", ");return n instanceof m.X&&(i+=" INTO "+t.map(function(t){var r="output_"+t.databaseName;return e.expressionMap.nativeParameters[r]={type:n.columnTypeToNativeParameter(t.type),dir:n.oracle.BIND_OUT},e.connection.driver.createParameter(r,Object.keys(e.expressionMap.nativeParameters).length)}).join(", ")),n instanceof d.Z&&("insert"===this.expressionMap.queryType||"update"===this.expressionMap.queryType)&&(i+=" INTO @OutputTable"),i}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""},e.prototype.getReturningColumns=function(){var e=this,t=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(function(n){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,(0,r.fl)(e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n)))}),t},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ")},e.prototype.createWhereIdsExpression=function(e){var t,n=this,r=this.expressionMap.mainAlias.metadata,i=(Array.isArray(e)?e:[e]).map(function(e){return r.ensureEntityIdMap(e)});if(!r.hasMultiplePrimaryKeys&&0===r.embeddeds.length){var a=r.primaryColumns[0];if(!a.transformer)return this.computeWhereParameter(((t={})[a.propertyName]=(0,g.In)(i.map(function(e){return a.getEntityValue(e,!1)})),t))}var o=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+".":"",s=Object.keys(this.expressionMap.nativeParameters).length,u=i.map(function(e,t){var i=[];return r.primaryColumns.forEach(function(r,a){var u="id_"+t+"_"+a;i.push(o+n.escape(r.databaseName)+" = "+n.connection.driver.createParameter(u,s)),n.expressionMap.nativeParameters[u]=r.getEntityValue(e,!0),s++}),i.join(" AND ")});return u.length>1?"("+u.map(function(e){return"("+e+")"}).join(" OR ")+")":u[0]},e.prototype.computeWhereParameter=function(e){var t=this;if("string"==typeof e)return e;if(e instanceof l.D){var n=this.createQueryBuilder();n.expressionMap.mainAlias=this.expressionMap.mainAlias,n.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,n.expressionMap.nativeParameters=this.expressionMap.nativeParameters,e.whereFactory(n);var r=n.createWhereExpressionString();return this.setParameters(n.getParameters()),r?"("+r+")":""}if(e instanceof Function)return e(this);if(e instanceof Object){var i=Array.isArray(e)?e:[e],a=void 0,o=Object.keys(this.expressionMap.nativeParameters).length;return(a=this.expressionMap.mainAlias.hasMetadata?i.map(function(e,n){return h.T.createPropertyPath(t.expressionMap.mainAlias.metadata,e).map(function(r,i){var a=t.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(r);if(!a.length)throw new b.n(r);return a.map(function(a,s){var u=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:a.propertyPath,c=a.getEntityValue(e,!0),l="where_"+n+"_"+i+"_"+s,h=Object.keys(t.expressionMap.nativeParameters).filter(function(e){return e.startsWith(l)}).length;if(null===c)return u+" IS NULL";if(!(c instanceof v.J))return t.expressionMap.nativeParameters[l]=c,o++,u+" = "+t.connection.driver.createParameter(l,o-1);var p=[];return c.useParameter&&(c.objectLiteralParameters?t.setParameters(c.objectLiteralParameters):(c.multipleParameters?c.value:[c.value]).forEach(function(e,n){t.expressionMap.nativeParameters[l+(h+n)]=e,o++,p.push(t.connection.driver.createParameter(l+(h+n),o-1))})),t.computeFindOperatorExpression(c,u,p)}).filter(function(e){return!!e}).join(" AND ")}).filter(function(e){return!!e}).join(" AND ")}):i.map(function(e,n){return Object.keys(e).map(function(r,i){var a=e[r],o=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:r;if(null===a)return o+" IS NULL";var s="where_"+n+"_"+i;return t.expressionMap.nativeParameters[s]=a,i++,o+" = "+t.connection.driver.createParameter(s,i-1)}).join(" AND ")})).length>1?a.map(function(e){return"("+e+")"}).join(" OR "):a.join("")}return""},e.prototype.computeFindOperatorExpression=function(e,t,n){var r=this.connection.driver;switch(e.type){case"not":if(e.child)return"NOT("+this.computeFindOperatorExpression(e.child,t,n)+")";return t+" != "+n[0];case"lessThan":return t+" < "+n[0];case"lessThanOrEqual":return t+" <= "+n[0];case"moreThan":return t+" > "+n[0];case"moreThanOrEqual":return t+" >= "+n[0];case"equal":return t+" = "+n[0];case"ilike":if(r instanceof f.U4||r instanceof f.J1)return t+" ILIKE "+n[0];return"UPPER("+t+") LIKE UPPER("+n[0]+")";case"like":return t+" LIKE "+n[0];case"between":return t+" BETWEEN "+n[0]+" AND "+n[1];case"in":if(0===n.length)return"0=1";return t+" IN ("+n.join(", ")+")";case"any":return t+" = ANY("+n[0]+")";case"isNull":return t+" IS NULL";case"raw":if(e.getSql)return e.getSql(t);return t+" = "+e.value}throw TypeError("Unsupported FindOperator "+v.J.constructor.name)},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner()},e}()},2749:function(e,t,n){"use strict";n.d(t,{G:function(){return i}});var r=n(274),i=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=(0,r.CR)(e.split("."),2),n=t[0],i=t[1];return!!n&&!!i&&-1===e.indexOf("(")&&-1===e.indexOf(")")},e}()},6930:function(e,t,n){"use strict";n.d(t,{K:function(){return c}});var r=n(274),i=n(7229),a=n(7349),o=n(1429),s=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,s,u,c,l,h,p,f,d,m,y,v=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!((t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner))return[3,2];if(n=t.joinColumns.reduce(function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t},{}),!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return[2];return[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(n).whereInIds(this.expressionMap.of).execute()];case 1:case 3:case 5:case 7:return r.sent(),[3,10];case 2:if(!((t.isOneToOneNotOwner||t.isOneToMany)&&null===e))return[3,4];if(i={},t.inverseRelation.joinColumns.forEach(function(e){i[e.propertyName]=null}),s=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],u={},c=[],s.forEach(function(e,n){t.inverseRelation.joinColumns.map(function(t,r){var i="joinColumn_"+n+"_"+r;u[i]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,c.push(t.propertyPath+" = :"+i)})}),!(l=c.map(function(e){return"("+e+")"}).join(" OR ")))return[2];return[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(l).setParameters(u).execute()];case 4:if(!(t.isOneToOneNotOwner||t.isOneToMany))return[3,6];if(Array.isArray(this.expressionMap.of))throw Error("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");if(h=this.expressionMap.of,n=t.inverseRelation.joinColumns.reduce(function(e,t){var n=h instanceof Object?t.referencedColumn.getEntityValue(h):h;return t.setEntityValue(e,n),e},{}),!e||Array.isArray(e)&&!e.length)return[2];return[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).whereInIds(e).execute()];case 6:if(p=t.junctionEntityMetadata,s=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],f=Array.isArray(e)?e:[e],d=t.isManyToManyOwner?s:f,m=t.isManyToManyOwner?f:s,y=[],d.forEach(function(e){m.forEach(function(t){var n={};p.ownerColumns.forEach(function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e}),p.inverseColumns.forEach(function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t}),y.push(n)})}),!y.length)return[2];if(!(this.queryBuilder.connection.driver instanceof o.X||this.queryBuilder.connection.driver instanceof a.t))return[3,8];return[4,Promise.all(y.map(function(e){return v.queryBuilder.createQueryBuilder().insert().into(p.tableName).values(e).execute()}))];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(p.tableName).values(y).execute()];case 9:r.sent(),r.label=10;case 10:return[2]}})})},e}(),u=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l,h,p,f,d;return(0,r.Jh)(this,function(m){switch(m.label){case 0:if(!(t=this.expressionMap.relationMetadata).isOneToMany)return[3,2];if(n=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],a={},t.inverseRelation.joinColumns.forEach(function(e){a[e.propertyName]=null}),o={},s=[],n.forEach(function(e,n){s.push.apply(s,(0,r.fl)(i.map(function(i,a){return(0,r.fl)(t.inverseRelation.joinColumns.map(function(t,r){var i="joinColumn_"+n+"_"+a+"_"+r;return o[i]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+" = :"+i}),t.inverseRelation.entityMetadata.primaryColumns.map(function(e,t){var n="primaryColumn_"+a+"_"+a+"_"+t;return o[n]=i instanceof Object?e.getEntityValue(i):i,e.propertyPath+" = :"+n})).join(" AND ")})))}),!(u=s.map(function(e){return"("+e+")"}).join(" OR ")))return[2];return[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(a).where(u).setParameters(o).execute()];case 1:return m.sent(),[3,4];case 2:return c=t.junctionEntityMetadata,n=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],l=Array.isArray(e)?e:[e],h=t.isManyToManyOwner?n:l,p=t.isManyToManyOwner?l:n,f={},d=[],h.forEach(function(e,t){d.push.apply(d,(0,r.fl)(p.map(function(n,i){return(0,r.fl)(c.ownerColumns.map(function(n,r){var a="firstValue_"+t+"_"+i+"_"+r;return f[a]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+" = :"+a}),c.inverseColumns.map(function(e,r){var a="secondValue_"+t+"_"+i+"_"+r;return f[a]=n instanceof Object?e.referencedColumn.getEntityValue(n):n,e.databaseName+" = :"+a})).join(" AND ")})))}),u=d.map(function(e){return"("+e+")"}).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(c.tableName).where(u).setParameters(f).execute()];case 3:m.sent(),m.label=4;case 4:return[2]}})})},e}(),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw Error('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new s(this,this.expressionMap).update(e)]})})},t.prototype.add=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new s(this,this.expressionMap).update(e)]})})},t.prototype.remove=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return[2,new u(this,this.expressionMap).remove(e)]})})},t.prototype.addAndRemove=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}})})},t.prototype.loadOne=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2,this.loadMany().then(function(e){return e[0]})]})})},t.prototype.loadMany=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw Error("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,e)]})})},t}(i.z)},6120:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var r=n(274),i=n(5738),a=n(1429),o=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i=this;return(0,r.Jh)(this,function(o){switch(o.label){case 0:return n=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map(function(t,o){return(0,r.mG)(i,void 0,void 0,function(){var i,s,u,c,l=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!this.queryRunner.connection.driver.isReturningSqlSupported())return[3,1];return this.queryRunner.connection.driver instanceof a.X&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e},{})),i=Array.isArray(e.raw)?e.raw[o]:e.raw,(s=this.queryRunner.connection.driver.createGeneratedMap(n,i))&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s)),[3,3];case 1:if(!(this.getUpdationReturningColumns().length>0))return[3,3];if(!(u=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw Error("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+"."+e.propertyPath})).addSelect(this.getUpdationReturningColumns().map(function(e){return n.targetName+"."+e.propertyPath})).from(n.target,n.targetName).where(u).setOption("create-pojo").getOne()];case 2:(c=r.sent())&&(this.queryRunner.manager.merge(n.target,t,c),e.generatedMaps.push(c)),r.label=3;case 3:return[2]}})})}))];case 1:return o.sent(),[2]}})})},e.prototype.insert=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,o,s,u,c,l=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(n=this.expressionMap.mainAlias.metadata,o=this.getInsertionReturningColumns(),s=t.map(function(r,o){l.queryRunner.connection.driver instanceof a.X&&Array.isArray(e.raw)&&l.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e},{}));var s=Array.isArray(e.raw)?e.raw[o]:e.raw,u=l.queryRunner.connection.driver.createGeneratedMap(n,s,o,t.length)||{};return!1===l.queryRunner.connection.driver.isUUIDGenerationSupported()&&n.generatedColumns.forEach(function(e){if("uuid"===e.generationStrategy){var t=e.getEntityValue(r);t||(t=l.expressionMap.nativeParameters["uuid_"+e.databaseName+o]),i.s.mergeDeep(u,e.createValueMap(t))}}),l.queryRunner.manager.merge(n.target,r,u),u}),!(!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&o.length>0))return[3,2];return u=t.map(function(e){var t=n.getEntityIdMap(e);if(!t)throw Error("Cannot update entity because entity id is not set in the entity.");return t}),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+"."+e.propertyPath})).addSelect(o.map(function(e){return n.targetName+"."+e.propertyPath})).from(n.target,n.targetName).where(u).setOption("create-pojo").getMany()];case 1:c=r.sent(),t.forEach(function(e,t){l.queryRunner.manager.merge(n.target,s[t],c[t])}),r.label=2;case 2:return t.forEach(function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r]),l.queryRunner.manager.merge(l.expressionMap.mainAlias.metadata.target,t,s[r],s[r])}),[2]}})})},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter(function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isDeleteDate||t.isVersion})},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter(function(e){return e.isUpdateDate||e.isVersion})},e}()},7884:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(274),i=n(7349),a=n(5738),o=n(7677),s=n(8764).Buffer,u=function(){function e(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}return e.prototype.transform=function(e,t){var n=this,r=this.group(e,t),i=[];return r.forEach(function(e){var r=n.transformRawResultsGroup(e,t);void 0!==r&&i.push(r)}),i},e.prototype.group=function(e,t){var n=this,i=new Map,a=[];return"view"===t.metadata.tableType?a.push.apply(a,(0,r.fl)(t.metadata.columns.map(function(e){return o.z.buildColumnAlias(n.driver,t.name,e.databaseName)}))):a.push.apply(a,(0,r.fl)(t.metadata.primaryColumns.map(function(e){return o.z.buildColumnAlias(n.driver,t.name,e.databaseName)}))),e.forEach(function(e){var t=a.map(function(t){var n=e[t];return s.isBuffer(n)?n.toString("hex"):"object"==typeof n?JSON.stringify(n):n}).join("_"),n=i.get(t);n?n.push(e):i.set(t,[e])}),i},e.prototype.transformRawResultsGroup=function(e,t){var n=this,r=t.metadata;if(r.discriminatorColumn){var i=e.map(function(e){return e[o.z.buildColumnAlias(n.driver,t.name,t.metadata.discriminatorColumn.databaseName)]}),a=r.childEntityMetadatas.find(function(e){return void 0!==i.find(function(t){return t===e.discriminatorValue})});a&&(r=a)}var s=-1!==this.expressionMap.options.indexOf("create-pojo")?{}:r.create(this.queryRunner),u=this.transformColumns(e,t,s,r),c=this.transformJoins(e,s,t,r),l=this.transformRelationIds(e,t,s,r),h=this.transformRelationCounts(e,t,s);if(u||0===r.primaryColumns.filter(function(e){return!1===e.isVirtual}).length&&(c||l||h))return s},e.prototype.transformColumns=function(e,t,n,r){var i=this,a=!1;return r.columns.forEach(function(s){if(!(r.childEntityMetadatas.length>0)||-1===r.childEntityMetadatas.map(function(e){return e.target}).indexOf(s.target)){var u=e[0][o.z.buildColumnAlias(i.driver,t.name,s.databaseName)];void 0!==u&&!s.isVirtual&&i.expressionMap.selects.find(function(e){return e.selection===t.name||e.selection===t.name+"."+s.propertyPath})&&(s.setEntityValue(n,i.driver.prepareHydratedValue(u,s)),null!==u&&(a=!0))}}),a},e.prototype.transformJoins=function(e,t,n,r){var i=this,a=!1;return this.expressionMap.joinAttributes.forEach(function(o){if(o.metadata&&o.isSelected&&(!o.relation||r.relations.find(function(e){return e===o.relation}))){if(o.mapToProperty){if(o.mapToPropertyParentAlias!==n.name)return}else if(!o.relation||o.parentAlias!==n.name||o.relationPropertyPath!==o.relation.propertyPath)return;var s=i.transform(e,o.alias);s=o.isMany?s:s[0],void 0!==(s=o.isMany||void 0!==s?s:null)&&(o.mapToPropertyPropertyName?t[o.mapToPropertyPropertyName]=s:o.relation.setEntityValue(t,s),a=!0)}}),a},e.prototype.transformRelationIds=function(e,t,n,r){var i=this,o=!1;return this.rawRelationIdResults.forEach(function(r){if(r.relationIdAttribute.parentAlias===t.name){var s=r.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,r.relationIdAttribute.parentAlias,e);if(null!=u){var c=r.results.map(function(e){var t,n=i.extractEntityPrimaryIds(s,e);if(!1!==a.s.compareIds(n,u)){var o=(t=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map(function(e){return e}):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map(function(e){return e}):s.isOwning?s.inverseJoinColumns.map(function(e){return e}):s.inverseRelation.joinColumns.map(function(e){return e})).reduce(function(t,n){var r=e[n.databaseName];return s.isOneToMany||s.isOneToOneNotOwner?(n.isVirtual&&n.referencedColumn&&n.referencedColumn.propertyName!==n.propertyName&&(r=n.referencedColumn.createValueMap(r)),a.s.mergeDeep(t,n.createValueMap(r))):(n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),a.s.mergeDeep(t,n.referencedColumn.createValueMap(r)))},{});return 1===t.length&&!1===r.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?t[0].getEntityValue(o):t[0].referencedColumn.getEntityValue(o):o}}).filter(function(e){return void 0!==e}),l=r.relationIdAttribute.mapToPropertyPropertyPath.split("."),h=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void h(e,t[r],n):t};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(h(l,n,c[0]),o=!0):(h(l,n,c),c.length>0&&(o=!0))}}}),o},e.prototype.transformRelationCounts=function(e,t,n){var r=this,i=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(a){var s,u=a.relationCountAttribute.relation;s=u.isOneToMany?u.inverseRelation.joinColumns[0].referencedColumn.databaseName:u.isOwning?u.joinColumns[0].referencedColumn.databaseName:u.inverseRelation.joinColumns[0].referencedColumn.databaseName;var c=e[0][o.z.buildColumnAlias(r.driver,t.name,s)];null!=c&&(n[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter(function(e){return e.parentId===c}).forEach(function(e){n[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0}))}),i},e.prototype.createValueMapFromJoinColumns=function(e,t,n){var r=this;return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(i,a){return n.forEach(function(n){e.isManyToOne||e.isOneToOneOwner?i[a.databaseName]=r.driver.prepareHydratedValue(n[o.z.buildColumnAlias(r.driver,t,a.databaseName)],a):i[a.databaseName]=r.driver.prepareHydratedValue(n[o.z.buildColumnAlias(r.driver,t,a.referencedColumn.databaseName)],a)}),i},{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,n){return e[n.databaseName]=t[n.databaseName],e},{})},e}(),c=n(9772),l=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return(0,r.ZT)(t,e),t}(Error),h=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return(0,r.ZT)(t,e),t}(Error),p=function(e){function t(n,r,i){var a=e.call(this)||this;return a.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(a,t.prototype),a.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",a}return(0,r.ZT)(t,e),t}(Error),f=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return(0,r.ZT)(t,e),t}(Error),d=n(5784),m=n(6869),y=n(58),v=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t=this;return(0,r.Jh)(this,function(n){return[2,Promise.all(this.relationIdAttributes.map(function(n){return(0,r.mG)(t,void 0,void 0,function(){var t,i,a,s,u,c,l,h,p,f,d,m,y,v,g,b,E,T,N,C,w,A=this;return(0,r.Jh)(this,function(M){switch(M.label){case 0:if(!(n.relation.isManyToOne||n.relation.isOneToOneOwner))return[3,1];if(n.queryBuilderFactory)throw Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return t=e.map(function(e){var t={};return n.relation.joinColumns.forEach(function(r){t[r.databaseName]=A.connection.driver.prepareHydratedValue(e[o.z.buildColumnAlias(A.connection.driver,n.parentAlias,r.databaseName)],r.referencedColumn)}),n.relation.entityMetadata.primaryColumns.forEach(function(r){t[r.databaseName]=A.connection.driver.prepareHydratedValue(e[o.z.buildColumnAlias(A.connection.driver,n.parentAlias,r.databaseName)],r)}),t}),[2,{relationIdAttribute:n,results:t}];case 1:if(!(n.relation.isOneToMany||n.relation.isOneToOneNotOwner))return[3,3];if(a=(i=n.relation).isOwning?i.joinColumns:i.inverseRelation.joinColumns,s=i.inverseEntityMetadata.target,u=i.inverseEntityMetadata.tableName,c=n.alias||u,l={},!(h=e.map(function(e,t){return a.map(function(r){var i=r.databaseName+t;return l[i]=e[o.z.buildColumnAlias(A.connection.driver,n.parentAlias,r.referencedColumn.databaseName)],c+"."+r.propertyPath+" = :"+i}).join(" AND ")}).map(function(e){return"("+e+")"}).join(" OR ")))return[2,{relationIdAttribute:n,results:[]}];return p=this.connection.createQueryBuilder(this.queryRunner),a.forEach(function(e){p.addSelect(c+"."+e.propertyPath,e.databaseName)}),i.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){p.addSelect(c+"."+e.propertyPath,e.databaseName)}),p.from(s,c).where("("+h+")").setParameters(l),n.queryBuilderFactory&&n.queryBuilderFactory(p),[4,p.getRawMany()];case 2:return(t=M.sent()).forEach(function(e){a.forEach(function(t){e[t.databaseName]=A.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}),i.inverseRelation.entityMetadata.primaryColumns.forEach(function(t){e[t.databaseName]=A.connection.driver.prepareHydratedValue(e[t.databaseName],t)})}),[2,{relationIdAttribute:n,results:t}];case 3:if(d=(f=n.relation).isOwning?f.joinColumns:f.inverseRelation.inverseJoinColumns,m=f.isOwning?f.inverseJoinColumns:f.inverseRelation.joinColumns,y=n.junctionAlias,v=n.joinInverseSideMetadata.tableName,g=n.alias||v,b=f.isOwning?f.junctionEntityMetadata.tableName:f.inverseRelation.junctionEntityMetadata.tableName,0===(E=e.map(function(e){return d.reduce(function(t,r){return t[r.propertyPath]=e[o.z.buildColumnAlias(A.connection.driver,n.parentAlias,r.referencedColumn.databaseName)],t},{})})).length)return[2,{relationIdAttribute:n,results:[]}];return T={},N=E.map(function(e,t){return Object.keys(e).map(function(n){var r=n+t;return T[r]=e[n],y+"."+n+" = :"+r}).join(" AND ")}),C=m.map(function(e){return y+"."+e.propertyPath+" = "+g+"."+e.referencedColumn.propertyPath}).join(" AND "),h=N.map(function(e){return"("+e+" AND "+C+")"}).join(" OR "),w=this.connection.createQueryBuilder(this.queryRunner),m.forEach(function(e){w.addSelect(y+"."+e.propertyPath,e.databaseName).addOrderBy(y+"."+e.propertyPath)}),d.forEach(function(e){w.addSelect(y+"."+e.propertyPath,e.databaseName).addOrderBy(y+"."+e.propertyPath)}),w.from(v,g).innerJoin(b,y,h).setParameters(T),n.queryBuilderFactory&&n.queryBuilderFactory(w),[4,w.getRawMany()];case 4:return(t=M.sent()).forEach(function(e){(0,r.fl)(d,m).forEach(function(t){e[t.databaseName]=A.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})}),[2,{relationIdAttribute:n,results:t}]}})})}))]})})},e}(),g=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new m.b(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),b=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n=this;return(0,r.Jh)(this,function(i){return t=function(e,t,n){return n.indexOf(e)===t},[2,Promise.all(this.relationCountAttributes.map(function(i){return(0,r.mG)(n,void 0,void 0,function(){var n,a,o,s,u,c,l,h,p,f,d,m,y,v,g,b,E,T;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!i.relation.isOneToMany)return[3,2];if(o=(a=(n=i.relation).inverseRelation).joinColumns[0].referencedColumn.propertyName,s=n.inverseEntityMetadata.target,u=n.inverseEntityMetadata.tableName,c=i.alias||u,l=a.propertyName,0===(h=(h=e.map(function(e){return e[i.parentAlias+"_"+o]}).filter(function(e){return!!e})).filter(t)).length)return[2,{relationCountAttribute:i,results:[]}];return(p=this.connection.createQueryBuilder(this.queryRunner)).select(c+"."+l,"parentId").addSelect("COUNT(*)","cnt").from(s,c).where(c+"."+l+" IN (:...ids)").addGroupBy(c+"."+l).setParameter("ids",h),i.queryBuilderFactory&&i.queryBuilderFactory(p),f={relationCountAttribute:i},[4,p.getRawMany()];case 1:return[2,(f.results=r.sent(),f)];case 2:if(m=void 0,y=void 0,v=void 0,i.relation.isOwning?(d=i.relation.joinColumns[0].referencedColumn.databaseName,m=i.relation.inverseJoinColumns[0].referencedColumn.databaseName,y=i.relation.junctionEntityMetadata.columns[0],v=i.relation.junctionEntityMetadata.columns[1]):(d=i.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,m=i.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,y=i.relation.junctionEntityMetadata.columns[1],v=i.relation.junctionEntityMetadata.columns[0]),0===(h=(h=e.map(function(e){return e[i.parentAlias+"_"+d]}).filter(function(e){return!!e})).filter(t)).length)return[2,{relationCountAttribute:i,results:[]}];return g=i.junctionAlias,u=i.joinInverseSideMetadata.tableName,c=i.alias||u,b=i.relation.junctionEntityMetadata.tableName,E=g+"."+y.propertyName+" IN ("+h.map(function(e){return isNaN(e)?"'"+e+"'":e})+") AND "+g+"."+v.propertyName+" = "+c+"."+m,(p=this.connection.createQueryBuilder(this.queryRunner)).select(g+"."+y.propertyName,"parentId").addSelect("COUNT("+p.escape(c)+"."+p.escape(m)+")","cnt").from(u,c).innerJoin(b,g,E).addGroupBy(g+"."+y.propertyName),i.queryBuilderFactory&&i.queryBuilderFactory(p),T={relationCountAttribute:i},[4,p.getRawMany()];case 3:return[2,(T.results=r.sent(),T)]}})})}))]})})},e}(),E=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new y.$(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),T=n(7229),N=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on given driver.",n}return(0,r.ZT)(t,e),t}(Error),C=n(7089),w=n(1429),A=n(3595),M=function(e){function t(){var n=e.call(this)||this;return n.name="OffsetWithoutLimitNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).",n}return(0,r.ZT)(t,e),t}(Error),R=n(1444),S=n(7264),O=n(497),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return e+=this.createSelectExpression()+this.createJoinExpression()+this.createWhereExpression()+this.createGroupByExpression()+this.createHavingExpression()+this.createOrderByExpression()+this.createLimitOffsetExpression()+this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map(function(e){return{selection:e}});else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.distinct=function(e){return void 0===e&&(e=!0),this.expressionMap.selectDistinct=e,this},t.prototype.distinctOn=function(e){return this.expressionMap.selectDistinctOn=e,this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new m.b(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new y.$(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(n){(void 0===e||void 0===e.relations||-1!==e.relations.indexOf(n.propertyPath))&&t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+n.propertyPath,t.expressionMap.mainAlias.name+"."+n.propertyPath,e)}),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return e?this.expressionMap.groupBys=[e]:this.expressionMap.groupBys=[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){var r,i;if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return e?e instanceof Object?this.expressionMap.orderBys=e:n?this.expressionMap.orderBys=((r={})[e]={order:t,nulls:n},r):this.expressionMap.orderBys=((i={})[e]=t,i):this.expressionMap.orderBys={},this},t.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return n?this.expressionMap.orderBys[e]={order:t,nulls:n}:this.expressionMap.orderBys[e]=t,this},t.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw Error('Provided "limit" value is not a number. Please provide a numeric value.');return this},t.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw Error('Provided "offset" value is not a number. Please provide a numeric value.');return this},t.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw Error('Provided "take" value is not a number. Please provide a numeric value.');return this},t.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw Error('Provided "skip" value is not a number. Please provide a numeric value.');return this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.withDeleted=function(){return this.expressionMap.withDeleted=!0,this},t.prototype.getRawOne=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}})})},t.prototype.getRawMany=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new f;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:if(r.trys.push([1,7,12,15]),!(!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive))return[3,3];return[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return[4,this.loadRawResults(e)];case 4:if(n=r.sent(),!t)return[3,6];return[4,e.commitTransaction()];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:if(!(e!==this.queryRunner))return[3,14];return[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getRawAndEntities=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:if(r.trys.push([1,7,12,15]),!(!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive))return[3,3];return[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:if(n=r.sent(),!t)return[3,6];return[4,e.commitTransaction()];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:if(!(e!==this.queryRunner))return[3,14];return[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getOne=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return[4,this.getRawAndEntities()];case 1:if((e=r.sent().entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion){if(t=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((n=t.updateDateColumn.getEntityValue(e)).getTime()!==this.expressionMap.lockVersion.getTime())throw new p(t.name,this.expressionMap.lockVersion,n)}else if((n=t.versionColumn.getEntityValue(e))!==this.expressionMap.lockVersion)throw new p(t.name,this.expressionMap.lockVersion,n)}return[2,e]}})})},t.prototype.getOneOrFail=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getOne()];case 1:if(!(e=t.sent()))throw new O.E(this.expressionMap.mainAlias.target,this);return[2,e]}})})},t.prototype.getMany=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new f;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}})})},t.prototype.getCount=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new f;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:if(r.trys.push([1,7,12,15]),!(!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive))return[3,3];return[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 4:if(n=r.sent(),!t)return[3,6];return[4,e.commitTransaction()];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:if(!(e!==this.queryRunner))return[3,14];return[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getManyAndCount=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new f;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:if(r.trys.push([1,8,13,16]),!(!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive))return[3,3];return[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 5:if(i=r.sent(),a=[n.entities,i],!t)return[3,7];return[4,e.commitTransaction()];case 6:r.sent(),r.label=7;case 7:return[2,a];case 8:if(o=r.sent(),!t)return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:case 11:return r.sent(),[3,12];case 12:throw o;case 13:if(!(e!==this.queryRunner))return[3,15];return[4,e.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}})})},t.prototype.stream=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.Jh)(this,function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,t=(e=(0,r.CR)(this.getQueryAndParameters(),2))[0],n=e[1],i=this.obtainQueryRunner(),a=!1,l.label=1;case 1:if(l.trys.push([1,6,,11]),!(!0===this.expressionMap.useTransaction&&!1===i.isTransactionActive))return[3,3];return[4,i.startTransaction()];case 2:l.sent(),a=!0,l.label=3;case 3:if(o=function(){if(i!==c.queryRunner)return i.release()},s=i.stream(t,n,o,o),!a)return[3,5];return[4,i.commitTransaction()];case 4:l.sent(),l.label=5;case 5:return[2,s];case 6:if(u=l.sent(),!a)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,i.rollbackTransaction()];case 8:case 9:return l.sent(),[3,10];case 10:throw u;case 11:return[2]}})})},t.prototype.cache=function(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):("string"==typeof e||"number"==typeof e)&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.setOption=function(e){return this.expressionMap.options.push(e),this},t.prototype.join=function(e,t,n,r,i,a,o){this.setParameters(i||{});var s=new d.k(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=a,s.isMappingMany=o,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var u="";if(t instanceof Function){var c=t(this.subQuery());this.setParameters(c.getParameters()),u=c.getQuery()}else u=t;var l=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===l?t:void 0,subQuery:!0===l?u:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw Error("Cannot build query because main alias is not set (call qb#from method)");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var i=this.expressionMap.mainAlias.metadata;t.push.apply(t,(0,r.fl)(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,i))),n.push.apply(n,(0,r.fl)(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,i)))}this.expressionMap.joinAttributes.forEach(function(i){if(i.metadata)t.push.apply(t,(0,r.fl)(e.buildEscapedEntityColumnSelects(i.alias.name,i.metadata))),n.push.apply(n,(0,r.fl)(e.findEntityColumnSelects(i.alias.name,i.metadata)));else if(e.expressionMap.selects.some(function(e){return e.selection===i.alias.name})){t.push({selection:e.escape(i.alias.name)+".*"});var a=e.expressionMap.selects.find(function(e){return e.selection===i.alias.name});n.push(a)}}),this.expressionMap.selects.filter(function(e){return -1===n.indexOf(e)}).forEach(function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})}),0===t.length&&t.push({selection:"*"});var a="";if(this.connection.driver instanceof c.Z)switch(this.expressionMap.lockMode){case"pessimistic_read":a=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":a=" WITH (UPDLOCK, ROWLOCK)";break;case"dirty_read":a=" WITH (NOLOCK)"}var o=this.expressionMap.aliases.filter(function(e){return"from"===e.type&&(e.tablePath||e.subQuery)}).map(function(t){return t.subQuery?t.subQuery+" "+e.escape(t.name):e.getTableName(t.tablePath)+" "+e.escape(t.name)});return this.createSelectDistinctExpression()+t.map(function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")}).join(", ")+" FROM "+o.join(", ")+a},t.prototype.createSelectDistinctExpression=function(){var e=this,t=this.expressionMap,n=t.selectDistinct,r=t.selectDistinctOn,i=this.connection.driver,a="SELECT ";return i instanceof C.U4&&r.length>0?a="SELECT DISTINCT ON ("+r.map(function(t){return e.replacePropertyNames(t)}).join(", ")+") ":n&&(a="SELECT DISTINCT "),a},t.prototype.createJoinExpression=function(){var e=this;return this.expressionMap.joinAttributes.map(function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,a=t.condition?" AND ("+t.condition+")":"",o=t.parentAlias;if(!o||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return" "+t.direction+" JOIN "+s+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){var u=n.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+o+"."+n.propertyPath+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}if(n.isOneToMany||n.isOneToOneNotOwner){var u=n.inverseRelation.joinColumns.map(function(e){return i+"."+n.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,h="",p="";return n.isOwning?(h=n.joinColumns.map(function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND "),p=n.inverseJoinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath}).join(" AND ")):(h=n.inverseRelation.inverseJoinColumns.map(function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath}).join(" AND "),p=n.inverseRelation.joinColumns.map(function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath}).join(" AND "))," "+t.direction+" JOIN "+e.getTableName(c)+" "+e.escape(l)+" ON "+e.replacePropertyNames(h)+" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(p+a)}).join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls}).join(", "):""},t.prototype.createLimitOffsetExpression=function(){var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof c.Z){var n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(this.connection.driver instanceof C.p$||this.connection.driver instanceof C.xI||this.connection.driver instanceof i.t){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new M}else if(this.connection.driver instanceof A.w){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver instanceof w.X){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""},t.prototype.createLockExpression=function(){var e=this.connection.driver;switch(this.expressionMap.lockMode){case"pessimistic_read":if(e instanceof C.p$||e instanceof C.xI)return" LOCK IN SHARE MODE";if(e instanceof C.U4)return" FOR SHARE";if(e instanceof w.X)return" FOR UPDATE";if(e instanceof c.Z)return"";else throw new N;case"pessimistic_write":if(e instanceof C.p$||e instanceof C.xI||e instanceof C.U4||e instanceof w.X)return" FOR UPDATE";if(e instanceof c.Z)return"";throw new N;case"pessimistic_partial_write":if(e instanceof C.U4||e instanceof C.p$)return" FOR UPDATE SKIP LOCKED";throw new N;case"pessimistic_write_or_fail":if(e instanceof C.U4||e instanceof C.p$)return" FOR UPDATE NOWAIT";throw new N;case"for_no_key_update":if(e instanceof C.U4)return" FOR NO KEY UPDATE";throw new N;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map(function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,i=this.expressionMap.selects.some(function(t){return t.selection===e}),a=[];if(i&&a.push.apply(a,(0,r.fl)(t.columns.filter(function(e){return!0===e.isSelect}))),a.push.apply(a,(0,r.fl)(t.columns.filter(function(t){return n.expressionMap.selects.some(function(n){return n.selection===e+"."+t.propertyPath})}))),0===a.length)return[];var s=this.expressionMap.queryEntity?t.primaryColumns.filter(function(e){return -1===a.indexOf(e)}):[];return(0,r.fl)(a,s).map(function(t){var r=n.expressionMap.selects.find(function(n){return n.selection===e+"."+t.propertyPath}),a=n.escape(e)+"."+n.escape(t.databaseName);return -1!==n.connection.driver.spatialTypes.indexOf(t.type)&&((n.connection.driver instanceof C.p$||n.connection.driver instanceof C.xI)&&(a=(n.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText")+"("+a+")"),n.connection.driver instanceof C.U4&&(a="ST_AsGeoJSON("+a+")::json"),n.connection.driver instanceof c.Z&&(a+=".ToString()")),{selection:a,aliasName:r&&r.aliasName?r.aliasName:o.z.buildColumnAlias(n.connection.driver,e,t.databaseName),virtual:r?!0===r.virtual:!i}})},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find(function(t){return t.selection===e});return n?[n]:this.expressionMap.selects.filter(function(n){return t.columns.some(function(t){return n.selection===e+"."+t.propertyPath})})},t.prototype.computeCountExpression=function(){var e=this,t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(t);if(0===this.expressionMap.joinAttributes.length&&0===this.expressionMap.relationIdAttributes.length&&0===this.expressionMap.relationCountAttributes.length)return"COUNT(1)";if(this.connection.driver instanceof C.J1||this.connection.driver instanceof C.U4)return"COUNT(DISTINCT("+n.map(function(t){return r+"."+e.escape(t.databaseName)}).join(", ")+"))";if(this.connection.driver instanceof C.p$)return"COUNT(DISTINCT "+n.map(function(t){return r+"."+e.escape(t.databaseName)}).join(", ")+")";if(this.connection.driver instanceof c.Z){var i=n.map(function(t){return r+"."+e.escape(t.databaseName)}).join(", '|;|', ");return 1===n.length?"COUNT(DISTINCT("+i+"))":"COUNT(DISTINCT(CONCAT("+i+")))"}return"COUNT(DISTINCT("+n.map(function(t){return r+"."+e.escape(t.databaseName)}).join(" || '|;|' || ")+"))"},t.prototype.executeCountQuery=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return t=this.computeCountExpression(),[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(t,"cnt").setOption("disable-global-order").loadRawResults(e)];case 1:if(!(n=r.sent())||!n[0]||!n[0].cnt)return[2,0];return[2,parseInt(n[0].cnt)]}})})},t.prototype.executeEntitiesAndRawResults=function(e){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,s,c,p,f,d,m,y,T,N,C,w,A,M,S,O,x=this;return(0,r.Jh)(this,function(P){switch(P.label){case 0:if(!this.expressionMap.mainAlias)throw Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new l;if("optimistic"===this.expressionMap.lockMode&&!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn)throw new h(n.name);if(i=new v(this.connection,e,this.expressionMap.relationIdAttributes),a=new b(this.connection,e,this.expressionMap.relationCountAttributes),new g(this.expressionMap).transform(),new E(this.expressionMap).transform(),s=[],c=[],!((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0))return[3,4];return f=(p=(0,r.CR)(this.createOrderByCombinedWithSelectExpression("distinctAlias"),2))[0],d=p[1],m=this.expressionMap.mainAlias.metadata,y=this.expressionMap.mainAlias.name,T=m.primaryColumns.map(function(e){var t=x.escape("distinctAlias"),n=x.escape(o.z.buildColumnAlias(x.connection.driver,y,e.databaseName));return d[n]||(d[n]="ASC"),t+"."+n+' as "'+o.z.buildColumnAlias(x.connection.driver,"ids_"+y,e.databaseName)+'"'}),[4,new t(this.connection,e).select("DISTINCT "+T.join(", ")).addSelect(f).from("("+this.clone().orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(d).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()];case 1:if(!((s=P.sent()).length>0))return[3,3];return N="",C={},m.hasMultiplePrimaryKeys?N=s.map(function(e,t){return m.primaryColumns.map(function(n){var r="orm_distinct_ids_"+t+"_"+n.databaseName;return C[r]=e["ids_"+y+"_"+n.databaseName],y+"."+n.propertyPath+"=:"+r}).join(" AND ")}).join(" OR "):(w=o.z.buildColumnAlias(this.connection.driver,"ids_"+y,m.primaryColumns[0].databaseName),(A=s.map(function(e){return e[w]})).every(function(e){return"number"==typeof e})?N=y+"."+m.primaryColumns[0].propertyPath+" IN ("+A.join(", ")+")":(C.orm_distinct_ids=A,N=y+"."+m.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:N}).setParameters(C).loadRawResults(e)];case 2:s=P.sent(),P.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:s=P.sent(),P.label=6;case 6:if(!(s.length>0))return[3,10];return[4,i.load(s)];case 7:return M=P.sent(),[4,a.load(s)];case 8:if(S=P.sent(),c=new u(this.expressionMap,this.connection.driver,M,S,this.queryRunner).transform(s,this.expressionMap.mainAlias),!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(O=new R.D,e.broadcaster.broadcastLoadEventsForAll(O,this.expressionMap.mainAlias.metadata,c),!(O.promises.length>0)))return[3,10];return[4,Promise.all(O.promises)];case 9:P.sent(),P.label=10;case 10:return[2,{raw:s,entities:c}]}})})},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,r=Object.keys(n).map(function(n){if(-1!==n.indexOf(".")){var r=n.split("."),i=r[0],a=r.slice(1).join("."),s=t.expressionMap.findAliasByName(i).metadata.findColumnWithPropertyPath(a);return t.escape(e)+"."+t.escape(o.z.buildColumnAlias(t.connection.driver,i,s.databaseName))}return t.expressionMap.selects.find(function(e){return e.selection===n||e.aliasName===n})?t.escape(e)+"."+n:""}).join(", "),i={};return Object.keys(n).forEach(function(r){if(-1!==r.indexOf(".")){var a=r.split("."),s=a[0],u=a.slice(1).join("."),c=t.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(u);i[t.escape(e)+"."+t.escape(o.z.buildColumnAlias(t.connection.driver,s,c.databaseName))]=n[r]}else t.expressionMap.selects.find(function(e){return e.selection===r||e.aliasName===r})?i[t.escape(e)+"."+r]=n[r]:i[r]=n[r]}),[r,i]},t.prototype.loadRawResults=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n,i,a,o,s,u;return(0,r.Jh)(this,function(c){switch(c.label){case 0:if(a=(n=(t=(0,r.CR)(this.getQueryAndParameters(),2))[0])+" -- PARAMETERS: "+JSON.stringify(i=t[1]),o="object"==typeof this.connection.options.cache?this.connection.options.cache:{},s=void 0,!(this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)))return[3,2];return[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},e)];case 1:if((s=c.sent())&&!this.connection.queryResultCache.isExpired(s))return[2,JSON.parse(s.result)];c.label=2;case 2:return[4,e.query(n,i)];case 3:if(u=c.sent(),!(this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)))return[3,5];return[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:new Date().getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(u)},s,e)];case 4:c.sent(),c.label=5;case 5:return[2,u]}})})},t.prototype.mergeExpressionMap=function(e){return S.g.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return"number"==typeof e||null==e?e:Number(e)},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},t}(T.z)},9617:function(e,t,n){"use strict";n.d(t,{B:function(){return g}});var r=n(274),i=n(7089),a=n(7229),o=n(9772),s=n(1568),u=n(581),c=n(6120),l=n(2106),h=n(1444),p=n(3595),f=n(2270),d=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDeleteDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have delete date columns.',r}return(0,r.ZT)(t,e),t}(Error),m=n(1429),y=n(210),v=n(4962),g=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return(e+=this.createOrderByExpression()+this.createLimitExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,o,u,p,f,d,m;return(0,r.Jh)(this,function(y){switch(y.label){case 0:e=this.obtainQueryRunner(),t=!1,y.label=1;case 1:if(y.trys.push([1,13,18,23]),!(!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive))return[3,3];return[4,e.startTransaction()];case 2:y.sent(),t=!0,y.label=3;case 3:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(n=new h.D,e.broadcaster.broadcastBeforeUpdateEvent(n,this.expressionMap.mainAlias.metadata),!(n.promises.length>0)))return[3,5];return[4,Promise.all(n.promises)];case 4:y.sent(),y.label=5;case 5:return a=new c.v(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=a.getUpdationReturningColumns()),u=(o=(0,r.CR)(this.getQueryAndParameters(),2))[0],p=o[1],f=new s.s,[4,e.query(u,p)];case 6:if(d=y.sent(),e.connection.driver instanceof i.U4?(f.raw=d[0],f.affected=d[1]):f.raw=d,!(!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0))return[3,8];return[4,a.update(f,this.expressionMap.whereEntities)];case 7:y.sent(),y.label=8;case 8:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(n=new h.D,e.broadcaster.broadcastAfterUpdateEvent(n,this.expressionMap.mainAlias.metadata),!(n.promises.length>0)))return[3,10];return[4,Promise.all(n.promises)];case 9:y.sent(),y.label=10;case 10:if(!t)return[3,12];return[4,e.commitTransaction()];case 11:y.sent(),y.label=12;case 12:return[2,f];case 13:if(m=y.sent(),!t)return[3,17];y.label=14;case 14:return y.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:case 16:return y.sent(),[3,17];case 17:throw m;case 18:if(!(e!==this.queryRunner))return[3,20];return[4,e.release()];case 19:y.sent(),y.label=20;case 20:if(!(this.connection.driver instanceof l.x&&!e.isTransactionActive))return[3,22];return[4,this.connection.driver.autoSave()];case 21:y.sent(),y.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.from=function(e,t){e=e instanceof v.I?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new u.y;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),e?e instanceof Object?this.expressionMap.orderBys=e:n?this.expressionMap.orderBys=((r={})[e]={order:t,nulls:n},r):this.expressionMap.orderBys=((i={})[e]=t,i):this.expressionMap.orderBys={},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),n?this.expressionMap.orderBys[e]={order:t,nulls:n}:this.expressionMap.orderBys[e]=t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach(function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)}),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw Error('Cannot get entity metadata for the given alias "'+this.expressionMap.mainAlias+'"');if(!e.deleteDateColumn)throw new d(e);var t=[];switch(this.expressionMap.queryType){case"soft-delete":t.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":t.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw Error('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),t.length<=0)throw new y.y;(this.connection.driver instanceof i.p$||this.connection.driver instanceof m.X||this.connection.driver instanceof p.w)&&(this.expressionMap.nativeParameters=Object.assign({},this.expressionMap.nativeParameters));var n=this.createWhereExpression(),r=this.createReturningExpression();return r&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof m.X||this.connection.driver instanceof i.J1)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n+" RETURNING "+r:r&&this.connection.driver instanceof o.Z?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+" OUTPUT "+r+n:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls}).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.p$)return" LIMIT "+e;throw new f.T}return""},t}(a.z)},8394:function(e,t,n){"use strict";n.d(t,{T:function(){return b}});var r=n(274),i=n(7089),a=n(7349),o=n(7229),s=n(9772),u=n(6097),c=n(1568),l=n(581),h=n(6120),p=n(2106),f=n(1444),d=n(3595),m=n(2270),y=n(1429),v=n(210),g=n(5072),b=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.ZT)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createUpdateExpression()+this.createOrderByExpression()+this.createLimitExpression()).trim()},t.prototype.execute=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,o,u,l,d,m,y,v,g,b;return(0,r.Jh)(this,function(E){switch(E.label){case 0:e=this.obtainQueryRunner(),t=!1,E.label=1;case 1:if(E.trys.push([1,13,18,23]),!(!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive))return[3,3];return[4,e.startTransaction()];case 2:E.sent(),t=!0,E.label=3;case 3:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(n=new f.D,e.broadcaster.broadcastBeforeUpdateEvent(n,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),!(n.promises.length>0)))return[3,5];return[4,Promise.all(n.promises)];case 4:E.sent(),E.label=5;case 5:return a=null,o=null,u=new h.v(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=u.getUpdationReturningColumns(),this.expressionMap.extraReturningColumns.length>0&&this.connection.driver instanceof s.Z&&(a=this.connection.driver.buildTableVariableDeclaration("@OutputTable",this.expressionMap.extraReturningColumns),o="SELECT * FROM @OutputTable")),d=(l=(0,r.CR)(this.getQueryAndParameters(),2))[0],m=l[1],y=new c.s,v=[a,d,o],[4,e.query(v.filter(function(e){return null!=e}).join(";\n\n"),m)];case 6:if(g=E.sent(),this.connection.driver instanceof i.U4?(y.raw=g[0],y.affected=g[1]):this.connection.driver instanceof i.p$?(y.raw=g,y.affected=g.affectedRows):this.connection.driver instanceof i.R4?(y.raw=g,y.affected=g.changes):y.raw=g,!(!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0))return[3,8];return[4,u.update(y,this.expressionMap.whereEntities)];case 7:E.sent(),E.label=8;case 8:if(!(!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata)||(n=new f.D,e.broadcaster.broadcastAfterUpdateEvent(n,this.expressionMap.mainAlias.metadata),!(n.promises.length>0)))return[3,10];return[4,Promise.all(n.promises)];case 9:E.sent(),E.label=10;case 10:if(!t)return[3,12];return[4,e.commitTransaction()];case 11:E.sent(),E.label=12;case 12:return[2,y];case 13:if(b=E.sent(),!t)return[3,17];E.label=14;case 14:return E.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:case 16:return E.sent(),[3,17];case 17:throw b;case 18:if(!(e!==this.queryRunner))return[3,20];return[4,e.release()];case 19:E.sent(),E.label=20;case 20:if(!(this.connection.driver instanceof p.x&&!e.isTransactionActive))return[3,22];return[4,this.connection.driver.autoSave()];case 21:E.sent(),E.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.y;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),e?e instanceof Object?this.expressionMap.orderBys=e:n?this.expressionMap.orderBys=((r={})[e]={order:t,nulls:n},r):this.expressionMap.orderBys=((i={})[e]=t,i):this.expressionMap.orderBys={},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),n?this.expressionMap.orderBys[e]={order:t,nulls:n}:this.expressionMap.orderBys[e]=t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach(function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)}),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[],o=[],c={},l=this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI||this.connection.driver instanceof y.X||this.connection.driver instanceof d.w||this.connection.driver instanceof a.t?0:Object.keys(this.expressionMap.nativeParameters).length;if(n?(u.T.createPropertyPath(n,t).forEach(function(u){var h=n.findColumnsWithPropertyPath(u);if(h.length<=0)throw new g.n(u);h.forEach(function(n){if(n.isUpdate){o.push(n);var u="upd_"+n.databaseName,h=n.getEntityValue(t);if(n.referencedColumn&&h instanceof Object?h=n.referencedColumn.getEntityValue(h):h instanceof Function||(h=e.connection.driver.preparePersistentValue(h,n)),h instanceof Function)r.push(e.escape(n.databaseName)+" = "+h());else if(e.connection.driver instanceof a.t&&null===h)r.push(e.escape(n.databaseName)+" = NULL");else{e.connection.driver instanceof s.Z&&(h=e.connection.driver.parametrizeValue(n,h)),e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI||e.connection.driver instanceof y.X||e.connection.driver instanceof d.w||e.connection.driver instanceof a.t?c[u]=h:e.expressionMap.nativeParameters[u]=h;var p=null;if((e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI)&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)){var f=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";p=null!=n.srid?f+"("+e.connection.driver.createParameter(u,l)+", "+n.srid+")":f+"("+e.connection.driver.createParameter(u,l)+")"}else p=e.connection.driver instanceof i.U4&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?null!=n.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(u,l)+"), "+n.srid+")::"+n.type:"ST_GeomFromGeoJSON("+e.connection.driver.createParameter(u,l)+")::"+n.type:e.connection.driver instanceof s.Z&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?n.type+"::STGeomFromText("+e.connection.driver.createParameter(u,l)+", "+(n.srid||"0")+")":e.connection.driver.createParameter(u,l);r.push(e.escape(n.databaseName)+" = "+p),l++}}})}),n.versionColumn&&-1===o.indexOf(n.versionColumn)&&r.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&-1===o.indexOf(n.updateDateColumn)&&r.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(t).map(function(n){var o=t[n];o instanceof Function?r.push(e.escape(n)+" = "+o()):e.connection.driver instanceof a.t&&null===o?r.push(e.escape(n)+" = NULL"):(e.connection.driver instanceof i.p$||e.connection.driver instanceof i.xI||e.connection.driver instanceof y.X||e.connection.driver instanceof d.w||e.connection.driver instanceof a.t?c[n]=o:e.expressionMap.nativeParameters[n]=o,r.push(e.escape(n)+" = "+e.connection.driver.createParameter(n,l)),l++)}),r.length<=0)throw new v.y;(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI||this.connection.driver instanceof y.X||this.connection.driver instanceof d.w||this.connection.driver instanceof a.t)&&(this.expressionMap.nativeParameters=Object.assign(c,this.expressionMap.nativeParameters));var h=this.createWhereExpression(),p=this.createReturningExpression();return p&&(this.connection.driver instanceof i.U4||this.connection.driver instanceof y.X||this.connection.driver instanceof i.J1)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+h+" RETURNING "+p:p&&this.connection.driver instanceof s.Z?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+" OUTPUT "+p+h:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+h},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map(function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls}).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)return" LIMIT "+e;throw new m.T}return""},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new v.y},t}(o.z)},58:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var r=n(274),i=n(2749),a=n(7264),o=function(){function e(e,t){this.expressionMap=e,a.g.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=(0,r.CR)(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rc"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value is a string representation of alias property");var e=(0,r.CR)(this.relationName.split("."),2),t=e[0],n=e[1],a=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!a)throw Error("Relation with property path "+n+" in entity was not found.");return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},6869:function(e,t,n){"use strict";n.d(t,{b:function(){return o}});var r=n(274),i=n(2749),a=n(7264),o=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,a.g.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.G.isAliasProperty(this.relationName))throw Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=(0,r.CR)(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rid"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}()},3528:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var r=function(){}},2593:function(e,t,n){"use strict";n.d(t,{t:function(){return r}});var r=function(){this.identifiers=[],this.generatedMaps=[]}},1568:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});var r=function(){this.generatedMaps=[]}},3003:function(e,t,n){"use strict";n.d(t,{Y:function(){return o}});var r=n(274),i=n(3298),a=function(){this.upQueries=[],this.downQueries=[]},o=function(){function e(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new a}return e.prototype.getTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadTables([e])];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables.length>0?this.loadedTables[0]:void 0]}})})},e.prototype.getTables=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadTables(e)];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables]}})})},e.prototype.getView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadViews([e])];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews.length>0?this.loadedViews[0]:void 0]}})})},e.prototype.getViews=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadViews(e)];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews]}})})},e.prototype.enableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!1},e.prototype.clearSqlMemory=function(){this.sqlInMemory=new a},e.prototype.getMemorySql=function(){return this.sqlInMemory},e.prototype.executeMemoryUpSql=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),t=(e=(0,r.XA)(this.sqlInMemory.upQueries)).next(),u.label=1;case 1:if(t.done)return[3,4];return i=(n=t.value).query,a=n.parameters,[4,this.query(i,a)];case 2:u.sent(),u.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o={error:u.sent()},[3,7];case 6:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},e.prototype.executeMemoryDownSql=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),t=(e=(0,r.XA)(this.sqlInMemory.downQueries.reverse())).next(),u.label=1;case 1:if(t.done)return[3,4];return i=(n=t.value).query,a=n.parameters,[4,this.query(i,a)];case 2:u.sent(),u.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o={error:u.sent()},[3,7];case 6:try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},e.prototype.getCachedView=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(t=this.loadedViews.find(function(t){return t.name===e}))return[2,t];return[4,this.loadViews([e])];case 1:if((n=r.sent()).length>0)return this.loadedViews.push(n[0]),[2,n[0]];throw Error('View "'+e+'" does not exist.')}})})},e.prototype.getCachedTable=function(e){return(0,r.mG)(this,void 0,void 0,function(){var t,n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(t=this.loadedTables.find(function(t){return t.name===e}))return[2,t];return[4,this.loadTables([e])];case 1:if((n=r.sent()).length>0)return this.loadedTables.push(n[0]),[2,n[0]];throw Error('Table "'+e+'" does not exist.')}})})},e.prototype.replaceCachedTable=function(e,t){var n=this.loadedTables.find(function(t){return t.name===e.name});n&&(n.name=t.name,n.columns=t.columns,n.indices=t.indices,n.foreignKeys=t.foreignKeys,n.uniques=t.uniques,n.checks=t.checks,n.justCreated=t.justCreated,n.engine=t.engine)},e.prototype.getTypeormMetadataTableName=function(){var e=this.connection.driver.options;return this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database)},e.prototype.isColumnChanged=function(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||e.enum!==t.enum},e.prototype.isDefaultColumnLength=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.length)return!1}return!!this.connection.driver.dataTypeDefaults&&!!this.connection.driver.dataTypeDefaults[t.type]&&!!this.connection.driver.dataTypeDefaults[t.type].length&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()},e.prototype.isDefaultColumnPrecision=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.precision&&void 0!==r.precision)return!1}return!!this.connection.driver.dataTypeDefaults&&!!this.connection.driver.dataTypeDefaults[t.type]&&null!==this.connection.driver.dataTypeDefaults[t.type].precision&&void 0!==this.connection.driver.dataTypeDefaults[t.type].precision&&this.connection.driver.dataTypeDefaults[t.type].precision===n},e.prototype.isDefaultColumnScale=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.scale&&void 0!==r.scale)return!1}return!!this.connection.driver.dataTypeDefaults&&!!this.connection.driver.dataTypeDefaults[t.type]&&null!==this.connection.driver.dataTypeDefaults[t.type].scale&&void 0!==this.connection.driver.dataTypeDefaults[t.type].scale&&this.connection.driver.dataTypeDefaults[t.type].scale===n},e.prototype.executeQueries=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,a,o,s,u,c,l,h,p;return(0,r.Jh)(this,function(f){switch(f.label){case 0:if(e instanceof i.A&&(e=[e]),t instanceof i.A&&(t=[t]),(c=this.sqlInMemory.upQueries).push.apply(c,(0,r.fl)(e)),(l=this.sqlInMemory.downQueries).push.apply(l,(0,r.fl)(t)),!0===this.sqlMemoryMode)return[2,Promise.resolve()];f.label=1;case 1:f.trys.push([1,6,7,8]),a=(n=(0,r.XA)(e)).next(),f.label=2;case 2:if(a.done)return[3,5];return s=(o=a.value).query,u=o.parameters,[4,this.query(s,u)];case 3:f.sent(),f.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return h={error:f.sent()},[3,8];case 7:try{a&&!a.done&&(p=n.return)&&p.call(n)}finally{if(h)throw h.error}return[7];case 8:return[2]}})})},e}()},1014:function(e,t,n){"use strict";n.d(t,{n:function(){return d}});var r=n(274),i=n(7089),a=n(5838),o=n(124),s=n(9396),u=n(9652),c=n(3350),l=n(1959),h=n(879),p=n(9033),f=n(2611),d=function(){function e(e){this.connection=e}return e.prototype.build=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(this.queryRunner=this.connection.createQueryRunner(),this.connection.driver instanceof i.J1)return[3,2];return[4,this.queryRunner.startTransaction()];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,12,18,20]),e=this.entityToSyncMetadatas.map(function(e){return e.tablePath}),!(this.viewEntityToSyncMetadatas.length>0))return[3,4];return[4,this.createTypeormMetadataTable()];case 3:n.sent(),n.label=4;case 4:return[4,this.queryRunner.getTables(e)];case 5:return n.sent(),[4,this.queryRunner.getViews([])];case 6:return n.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 7:if(n.sent(),!this.connection.queryResultCache)return[3,9];return[4,this.connection.queryResultCache.synchronize(this.queryRunner)];case 8:n.sent(),n.label=9;case 9:if(this.connection.driver instanceof i.J1)return[3,11];return[4,this.queryRunner.commitTransaction()];case 10:n.sent(),n.label=11;case 11:return[3,20];case 12:t=n.sent(),n.label=13;case 13:if(n.trys.push([13,16,,17]),this.connection.driver instanceof i.J1)return[3,15];return[4,this.queryRunner.rollbackTransaction()];case 14:n.sent(),n.label=15;case 15:return[3,17];case 16:return n.sent(),[3,17];case 17:throw t;case 18:return[4,this.queryRunner.release()];case 19:return n.sent(),[7];case 20:return[2]}})})},e.prototype.log=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){switch(t.label){case 0:this.queryRunner=this.connection.createQueryRunner(),t.label=1;case 1:if(t.trys.push([1,,9,11]),e=this.entityToSyncMetadatas.map(function(e){return e.tablePath}),!(this.viewEntityToSyncMetadatas.length>0))return[3,3];return[4,this.createTypeormMetadataTable()];case 2:t.sent(),t.label=3;case 3:return[4,this.queryRunner.getTables(e)];case 4:return t.sent(),[4,this.queryRunner.getViews([])];case 5:return t.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:if(t.sent(),!this.connection.queryResultCache)return[3,8];return[4,this.connection.queryResultCache.synchronize(this.queryRunner)];case 7:t.sent(),t.label=8;case 8:return[2,this.queryRunner.getMemorySql()];case 9:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 10:return t.sent(),[7];case 11:return[2]}})})},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(e){return e.synchronize&&"entity-child"!==e.tableType&&"view"!==e.tableType})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewEntityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(e){return"view"===e.tableType&&e.synchronize})},enumerable:!0,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){switch(e.label){case 0:return[4,this.dropOldViews()];case 1:return e.sent(),[4,this.dropOldForeignKeys()];case 2:return e.sent(),[4,this.dropOldIndices()];case 3:return e.sent(),[4,this.dropOldChecks()];case 4:return e.sent(),[4,this.dropOldExclusions()];case 5:return e.sent(),[4,this.dropCompositeUniqueConstraints()];case 6:return e.sent(),[4,this.renameColumns()];case 7:return e.sent(),[4,this.createNewTables()];case 8:return e.sent(),[4,this.dropRemovedColumns()];case 9:return e.sent(),[4,this.addNewColumns()];case 10:return e.sent(),[4,this.updatePrimaryKeys()];case 11:return e.sent(),[4,this.updateExistColumns()];case 12:return e.sent(),[4,this.createNewIndices()];case 13:return e.sent(),[4,this.createNewChecks()];case 14:return e.sent(),[4,this.createNewExclusions()];case 15:return e.sent(),[4,this.createCompositeUniqueConstraints()];case 16:return e.sent(),[4,this.createForeignKeys()];case 17:return e.sent(),[4,this.createViews()];case 18:return e.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(s){switch(s.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=n.foreignKeys.filter(function(t){var n=e.foreignKeys.find(function(e){return m(t,e)});return!n||n.onDelete&&n.onDelete!==t.onDelete||n.onUpdate&&n.onUpdate!==t.onUpdate})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("dropping old foreign keys of "+n.name+": "+i.map(function(e){return e.name}).join(", ")),[4,t.queryRunner.dropForeignKeys(n,i)];case 1:return r.sent(),[2]}})},t=this,s.label=1;case 1:s.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),s.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:s.sent(),s.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:s.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.renameTables=function(){return(0,r.mG)(this,void 0,void 0,function(){return(0,r.Jh)(this,function(e){return[2]})})},e.prototype.renameColumns=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s=this;return(0,r.Jh)(this,function(u){switch(u.label){case 0:e=function(e){var n,i,a,o;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||e.columns.length!==n.columns.length||0===(i=e.columns.filter(function(e){return!n.columns.find(function(t){return t.name===e.databaseName&&t.type===s.connection.driver.normalizeType(e)&&t.isNullable===e.isNullable&&t.isUnique===s.connection.driver.normalizeIsUnique(e)})})).length||i.length>1||0===(a=n.columns.filter(function(t){return!e.columns.find(function(e){return e.databaseName===t.name&&s.connection.driver.normalizeType(e)===t.type&&e.isNullable===t.isNullable&&s.connection.driver.normalizeIsUnique(e)===t.isUnique})})).length||a.length>1)return[2,"continue"];return(o=a[0].clone()).name=i[0].databaseName,t.connection.logger.logSchemaBuild('renaming column "'+a[0].name+'" in to "'+o.name+'"'),[4,t.queryRunner.renameColumn(n,a[0],o)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:u.sent(),u.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.dropOldIndices=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s=this;return(0,r.Jh)(this,function(u){switch(u.label){case 0:e=function(e){var n;return(0,r.Jh)(this,function(i){switch(i.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath})))return[2,"continue"];return[4,Promise.all(n.indices.filter(function(t){var n=e.indices.find(function(e){return e.name===t.name});return!n||!1!==n.synchronize&&(!!(n.isUnique!==t.isUnique||n.isSpatial!==t.isSpatial||s.connection.driver.isFullTextColumnTypeSupported()&&n.isFulltext!==t.isFulltext)||n.columns.length!==t.columnNames.length||!n.columns.every(function(e){return -1!==t.columnNames.indexOf(e.databaseName)}))}).map(function(e){return(0,r.mG)(s,void 0,void 0,function(){return(0,r.Jh)(this,function(t){switch(t.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: "'+e.name+'" from table '+n.name),[4,this.queryRunner.dropIndex(n,e)];case 1:return t.sent(),[2]}})})}))];case 1:return i.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:u.sent(),u.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.dropOldChecks=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:if(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)return[2];e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=n.checks.filter(function(t){return!e.checks.find(function(e){return e.name===t.name})})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("dropping old check constraint: "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropCheckConstraints(n,i)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),a=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(a.done)return[3,5];return[5,e(a.value)];case 3:u.sent(),u.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o={error:u.sent()},[3,8];case 7:try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},e.prototype.dropCompositeUniqueConstraints=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(s){switch(s.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=n.uniques.filter(function(t){return t.columnNames.length>1&&!e.uniques.find(function(e){return e.name===t.name})})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("dropping old unique constraint: "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropUniqueConstraints(n,i)];case 1:return r.sent(),[2]}})},t=this,s.label=1;case 1:s.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),s.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:s.sent(),s.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:s.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.dropOldExclusions=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:if(!(this.connection.driver instanceof i.U4))return[2];e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=n.exclusions.filter(function(t){return!e.exclusions.find(function(e){return e.name===t.name})})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("dropping old exclusion constraint: "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropExclusionConstraints(n,i)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),a=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(a.done)return[3,5];return[5,e(a.value)];case 3:u.sent(),u.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o={error:u.sent()},[3,8];case 7:try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},e.prototype.createNewTables=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,o,s,u=this;return(0,r.Jh)(this,function(c){switch(c.label){case 0:e=function(e){var n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(t.queryRunner.loadedTables.find(function(t){var n=e.database&&e.database!==u.connection.driver.database?e.database:void 0,r=e.schema||u.connection.driver.options.schema,i=u.connection.driver.buildTableName(e.tableName,r,n);return t.name===i}))return[2,"continue"];return t.connection.logger.logSchemaBuild("creating a new table: "+e.tablePath),n=a.i.create(e,t.connection.driver),[4,t.queryRunner.createTable(n,!1,!1)];case 1:return r.sent(),t.queryRunner.loadedTables.push(n),[2]}})},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),c.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:c.sent(),c.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o={error:c.sent()},[3,8];case 7:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},e.prototype.createViews=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s=this;return(0,r.Jh)(this,function(u){switch(u.label){case 0:e=function(e){var n;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(t.queryRunner.loadedViews.find(function(t){var n=e.database&&e.database!==s.connection.driver.database?e.database:void 0,r=e.schema||s.connection.driver.options.schema,i=s.connection.driver.buildTableName(e.tableName,r,n),a="string"==typeof t.expression?t.expression.trim():t.expression(s.connection).getQuery(),o="string"==typeof e.expression?e.expression.trim():e.expression(s.connection).getQuery();return t.name===i&&a===o}))return[2,"continue"];return t.connection.logger.logSchemaBuild("creating a new view: "+e.tablePath),n=f.G.create(e,t.connection.driver),[4,t.queryRunner.createView(n)];case 1:return r.sent(),t.queryRunner.loadedViews.push(n),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.viewEntityToSyncMetadatas)).next(),u.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:u.sent(),u.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.dropOldViews=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o,s=this;return(0,r.Jh)(this,function(u){switch(u.label){case 0:e=function(e){return(0,r.Jh)(this,function(n){switch(n.label){case 0:if(t.viewEntityToSyncMetadatas.find(function(t){var n=t.database&&t.database!==s.connection.driver.database?t.database:void 0,r=t.schema||s.connection.driver.options.schema,i=s.connection.driver.buildTableName(t.tableName,r,n),a="string"==typeof e.expression?e.expression.trim():e.expression(s.connection).getQuery(),o="string"==typeof t.expression?t.expression.trim():t.expression(s.connection).getQuery();return e.name===i&&a===o}))return[2,"continue"];return t.connection.logger.logSchemaBuild("dropping an old view: "+e.name),[4,t.queryRunner.dropView(e)];case 1:return n.sent(),t.queryRunner.loadedViews.splice(t.queryRunner.loadedViews.indexOf(e),1),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.queryRunner.loadedViews)).next(),u.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:u.sent(),u.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.dropRemovedColumns=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(s){switch(s.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=n.columns.filter(function(t){return!e.columns.find(function(e){return e.databaseName===t.name})})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("columns dropped in "+n.name+": "+i.map(function(e){return e.name}).join(", ")),[4,t.queryRunner.dropColumns(n,i)];case 1:return r.sent(),[2]}})},t=this,s.label=1;case 1:s.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),s.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:s.sent(),s.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:s.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.addNewColumns=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:e=function(e){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=e.columns.filter(function(e){return!n.columns.find(function(t){return t.name===e.databaseName})})).length||0===(a=t.metadataColumnsToTableColumnOptions(i).map(function(e){return new o.D(e)})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("new columns added: "+i.map(function(e){return e.databaseName}).join(", ")),[4,t.queryRunner.addColumns(n,a)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:u.sent(),u.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.updatePrimaryKeys=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,s,u=this;return(0,r.Jh)(this,function(l){switch(l.label){case 0:e=function(e){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath})))return[2,"continue"];if(i=e.columns.filter(function(e){return e.isPrimary}),!(n.columns.filter(function(e){return e.isPrimary}).length!==i.length&&i.length>1))return[3,2];return a=i.map(function(e){return new o.D(c.P.createTableColumnOptions(e,u.connection.driver))}),[4,t.queryRunner.updatePrimaryKeys(n,a)];case 1:r.sent(),r.label=2;case 2:return[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),l.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:l.sent()},[3,8];case 7:try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.updateExistColumns=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,s,u,l=this;return(0,r.Jh)(this,function(h){switch(h.label){case 0:e=function(e){var n,a,s,u,h,p,f,d,m,y,v,g,b,E,T,N;return(0,r.Jh)(this,function(C){switch(C.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(a=t.connection.driver.findChangedColumns(n.columns,e.columns)).length)return[2,"continue"];C.label=1;case 1:C.trys.push([1,6,7,8]),v=void 0,u=(s=(0,r.XA)(a)).next(),C.label=2;case 2:if(u.done)return[3,5];return h=u.value,[4,t.dropColumnReferencedForeignKeys(e.tablePath,h.databaseName)];case 3:C.sent(),C.label=4;case 4:return u=s.next(),[3,2];case 5:return[3,8];case 6:return v={error:C.sent()},[3,8];case 7:try{u&&!u.done&&(g=s.return)&&g.call(s)}finally{if(v)throw v.error}return[7];case 8:C.trys.push([8,13,14,15]),b=void 0,f=(p=(0,r.XA)(a)).next(),C.label=9;case 9:if(f.done)return[3,12];return h=f.value,[4,t.dropColumnCompositeIndices(e.tablePath,h.databaseName)];case 10:C.sent(),C.label=11;case 11:return f=p.next(),[3,9];case 12:return[3,15];case 13:return b={error:C.sent()},[3,15];case 14:try{f&&!f.done&&(E=p.return)&&E.call(p)}finally{if(b)throw b.error}return[7];case 15:if(t.connection.driver instanceof i.p$||t.connection.driver instanceof i.xI)return[3,23];C.label=16;case 16:C.trys.push([16,21,22,23]),T=void 0,m=(d=(0,r.XA)(a)).next(),C.label=17;case 17:if(m.done)return[3,20];return h=m.value,[4,t.dropColumnCompositeUniques(e.tablePath,h.databaseName)];case 18:C.sent(),C.label=19;case 19:return m=d.next(),[3,17];case 20:return[3,23];case 21:return T={error:C.sent()},[3,23];case 22:try{m&&!m.done&&(N=d.return)&&N.call(d)}finally{if(T)throw T.error}return[7];case 23:if(0===(y=a.map(function(e){var t=n.columns.find(function(t){return t.name===e.databaseName}),r=c.P.createTableColumnOptions(e,l.connection.driver);return{oldColumn:t,newColumn:new o.D(r)}})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild('columns changed in "'+n.name+'". updating: '+a.map(function(e){return e.databaseName}).join(", ")),[4,t.queryRunner.changeColumns(n,y)];case 24:return C.sent(),[2]}})},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),a=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),h.label=2;case 2:if(a.done)return[3,5];return[5,e(a.value)];case 3:h.sent(),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return s={error:h.sent()},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.createNewIndices=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(s){switch(s.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=e.indices.filter(function(e){return!n.indices.find(function(t){return t.name===e.name})&&!0===e.synchronize}).map(function(e){return u.s.create(e)})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("adding new indices "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createIndices(n,i)];case 1:return r.sent(),[2]}})},t=this,s.label=1;case 1:s.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),s.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:s.sent(),s.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:s.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.createNewChecks=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:if(this.connection.driver instanceof i.p$||this.connection.driver instanceof i.xI)return[2];e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=e.checks.filter(function(e){return!n.checks.find(function(t){return t.name===e.name})}).map(function(e){return h.r.create(e)})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("adding new check constraints: "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createCheckConstraints(n,i)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),a=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(a.done)return[3,5];return[5,e(a.value)];case 3:u.sent(),u.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o={error:u.sent()},[3,8];case 7:try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},e.prototype.createCompositeUniqueConstraints=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(s){switch(s.label){case 0:e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=e.uniques.filter(function(e){return e.columns.length>1&&!n.uniques.find(function(t){return t.name===e.name})}).map(function(e){return l.v.create(e)})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("adding new unique constraints: "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createUniqueConstraints(n,i)];case 1:return r.sent(),[2]}})},t=this,s.label=1;case 1:s.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),s.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:s.sent(),s.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:s.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.createNewExclusions=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,a,o,s;return(0,r.Jh)(this,function(u){switch(u.label){case 0:if(!(this.connection.driver instanceof i.U4))return[2];e=function(e){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=e.exclusions.filter(function(e){return!n.exclusions.find(function(t){return t.name===e.name})}).map(function(e){return p.N.create(e)})).length)return[2,"continue"];return t.connection.logger.logSchemaBuild("adding new exclusion constraints: "+i.map(function(e){return'"'+e.name+'"'}).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createExclusionConstraints(n,i)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),a=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(a.done)return[3,5];return[5,e(a.value)];case 3:u.sent(),u.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o={error:u.sent()},[3,8];case 7:try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},e.prototype.createForeignKeys=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t,n,i,a,o;return(0,r.Jh)(this,function(u){switch(u.label){case 0:e=function(e){var n,i,a;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))||0===(i=e.foreignKeys.filter(function(e){return!n.foreignKeys.find(function(t){return m(t,e)})})).length)return[2,"continue"];return a=i.map(function(e){return s.U.create(e)}),t.connection.logger.logSchemaBuild("creating a foreign keys: "+i.map(function(e){return e.name}).join(", ")+' on table "'+n.name+'"'),[4,t.queryRunner.createForeignKeys(n,a)];case 1:return r.sent(),[2]}})},t=this,u.label=1;case 1:u.trys.push([1,6,7,8]),i=(n=(0,r.XA)(this.entityToSyncMetadatas)).next(),u.label=2;case 2:if(i.done)return[3,5];return[5,e(i.value)];case 3:u.sent(),u.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a={error:u.sent()},[3,8];case 7:try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l,h;return(0,r.Jh)(this,function(p){switch(p.label){case 0:if(!(n=this.queryRunner.loadedTables.find(function(t){return t.name===e})))return[2];if(i=[],(a=n.foreignKeys.find(function(e){return -1!==e.columnNames.indexOf(t)}))&&((o=n.clone()).foreignKeys=[a],i.push(o),n.removeForeignKey(a)),this.queryRunner.loadedTables.forEach(function(n){var r=n.foreignKeys.filter(function(n){return n.referencedTableName===e&&-1!==n.referencedColumnNames.indexOf(t)});if(r.length>0){var a=n.clone();a.foreignKeys=r,i.push(a),r.forEach(function(e){return n.removeForeignKey(e)})}}),!(i.length>0))return[3,8];p.label=1;case 1:p.trys.push([1,6,7,8]),u=(s=(0,r.XA)(i)).next(),p.label=2;case 2:if(u.done)return[3,5];return c=u.value,this.connection.logger.logSchemaBuild("dropping related foreign keys of "+c.name+": "+c.foreignKeys.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropForeignKeys(c,c.foreignKeys)];case 3:p.sent(),p.label=4;case 4:return u=s.next(),[3,2];case 5:return[3,8];case 6:return l={error:p.sent()},[3,8];case 7:try{u&&!u.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}return[7];case 8:return[2]}})})},e.prototype.dropColumnCompositeIndices=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))||0===(i=n.indices.filter(function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)})).length)return[2];return this.connection.logger.logSchemaBuild('dropping related indices of "'+e+'"."'+t+'": '+i.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropIndices(n,i)];case 1:return r.sent(),[2]}})})},e.prototype.dropColumnCompositeUniques=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(!(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))||0===(i=n.uniques.filter(function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)})).length)return[2];return this.connection.logger.logSchemaBuild('dropping related unique constraints of "'+e+'"."'+t+'": '+i.map(function(e){return e.name}).join(", ")),[4,this.queryRunner.dropUniqueConstraints(n,i)];case 1:return r.sent(),[2]}})})},e.prototype.metadataColumnsToTableColumnOptions=function(e){var t=this;return e.map(function(e){return c.P.createTableColumnOptions(e,t.connection.driver)})},e.prototype.createTypeormMetadataTable=function(){return(0,r.mG)(this,void 0,void 0,function(){var e,t;return(0,r.Jh)(this,function(n){switch(n.label){case 0:return e=this.connection.driver.options,t=this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database),[4,this.queryRunner.createTable(new a.i({name:t,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0}]}),!0)];case 1:return n.sent(),[2]}})})},e}();function m(e,t){return e.name===t.name&&e.referencedTableName===t.referencedTablePath}},5838:function(e,t,n){"use strict";n.d(t,{i:function(){return l}});var r=n(124),i=n(9652),a=n(9396),o=n(3350),s=n(1959),u=n(879),c=n(9033),l=function(){function e(e){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,e&&(this.name=e.name,e.columns&&(this.columns=e.columns.map(function(e){return new r.D(e)})),e.indices&&(this.indices=e.indices.map(function(e){return new i.s(e)})),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map(function(e){return new a.U(e)})),e.uniques&&(this.uniques=e.uniques.map(function(e){return new s.v(e)})),e.checks&&(this.checks=e.checks.map(function(e){return new u.r(e)})),e.exclusions&&(this.exclusions=e.exclusions.map(function(e){return new c.N(e)})),void 0!==e.justCreated&&(this.justCreated=e.justCreated),this.engine=e.engine)}return Object.defineProperty(e.prototype,"primaryColumns",{get:function(){return this.columns.filter(function(e){return e.isPrimary})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e({name:this.name,columns:this.columns.map(function(e){return e.clone()}),indices:this.indices.map(function(e){return e.clone()}),foreignKeys:this.foreignKeys.map(function(e){return e.clone()}),uniques:this.uniques.map(function(e){return e.clone()}),checks:this.checks.map(function(e){return e.clone()}),exclusions:this.exclusions.map(function(e){return e.clone()}),justCreated:this.justCreated,engine:this.engine})},e.prototype.addColumn=function(e){this.columns.push(e)},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.addUniqueConstraint=function(e){if(this.uniques.push(e),1===e.columnNames.length){var t=this.columns.find(function(t){return t.name===e.columnNames[0]});t&&(t.isUnique=!0)}},e.prototype.removeUniqueConstraint=function(e){var t=this.uniques.find(function(t){return t.name===e.name});if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){var n=this.columns.find(function(e){return e.name===t.columnNames[0]});n&&(n.isUnique=!1)}},e.prototype.addCheckConstraint=function(e){this.checks.push(e)},e.prototype.removeCheckConstraint=function(e){var t=this.checks.find(function(t){return t.name===e.name});t&&this.checks.splice(this.checks.indexOf(t),1)},e.prototype.addExclusionConstraint=function(e){this.exclusions.push(e)},e.prototype.removeExclusionConstraint=function(e){var t=this.exclusions.find(function(t){return t.name===e.name});t&&this.exclusions.splice(this.exclusions.indexOf(t),1)},e.prototype.addForeignKey=function(e){this.foreignKeys.push(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.addIndex=function(e,t){if(void 0===t&&(t=!1),this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){var n=this.columns.find(function(t){return t.name===e.columnNames[0]});n&&(n.isUnique=!0)}},e.prototype.removeIndex=function(e,t){void 0===t&&(t=!1);var n=this.indices.find(function(t){return t.name===e.name});if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){var r=this.columns.find(function(e){return e.name===n.columnNames[0]});r&&(r.isUnique=this.indices.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===r.name&&!!n.isUnique}))}},e.prototype.findColumnByName=function(e){return this.columns.find(function(t){return t.name===e})},e.prototype.findColumnIndices=function(e){return this.indices.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnForeignKeys=function(e){return this.foreignKeys.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnUniques=function(e){return this.uniques.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnChecks=function(e){return this.checks.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.create=function(t,n){var r={name:n.buildTableName(t.tableName,t.schema,t.database),engine:t.engine,columns:t.columns.filter(function(e){return e}).map(function(e){return o.P.createTableColumnOptions(e,n)}),indices:t.indices.filter(function(e){return!0===e.synchronize}).map(function(e){return i.s.create(e)}),uniques:t.uniques.map(function(e){return s.v.create(e)}),checks:t.checks.map(function(e){return u.r.create(e)}),exclusions:t.exclusions.map(function(e){return c.N.create(e)})};return new e(r)},e}()},879:function(e,t,n){"use strict";n.d(t,{r:function(){return i}});var r=n(274),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,columnNames:this.columnNames?(0,r.fl)(this.columnNames):[],expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},124:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||e.unsigned||!1,this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}return e.prototype.clone=function(){return new e({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},e}()},9033:function(e,t,n){"use strict";n.d(t,{N:function(){return r}});var r=function(){function e(e){this.name=e.name,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},9396:function(e,t,n){"use strict";n.d(t,{U:function(){return i}});var r=n(274),i=function(){function e(e){this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.fl)(this.columnNames),referencedColumnNames:(0,r.fl)(this.referencedColumnNames),referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})},e.create=function(t){return new e({name:t.name,columnNames:t.columnNames,referencedColumnNames:t.referencedColumnNames,referencedTableName:t.referencedTablePath,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable})},e}()},9652:function(e,t,n){"use strict";n.d(t,{s:function(){return i}});var r=n(274),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.parser=e.parser,this.where=e.where?e.where:""}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.fl)(this.columnNames),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,parser:this.parser,where:this.where})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map(function(e){return e.databaseName}),isUnique:t.isUnique,isSpatial:t.isSpatial,isFulltext:t.isFulltext,parser:t.parser,where:t.where})},e}()},1959:function(e,t,n){"use strict";n.d(t,{v:function(){return i}});var r=n(274),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.fl)(this.columnNames)})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map(function(e){return e.databaseName})})},e}()},3350:function(e,t,n){"use strict";n.d(t,{P:function(){return r}});var r=function(){function e(){}return e.createTableColumnOptions=function(e,t){return{name:e.databaseName,length:e.length,width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map(function(e){return e+""}):e.enum,enumName:e.enumName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}},e}()},2611:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});var r=function(){function e(e){e&&(this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression,materialized:this.materialized})},e.create=function(t,n){var r={name:n.buildTableName(t.tableName,t.schema,t.database),expression:t.expression,materialized:t.tableMetadataArgs.materialized};return new e(r)},e}()},4894:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var r=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,n){var r=this;n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var a=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastBeforeUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(o.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){var u=s.beforeUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}})},e.prototype.broadcastBeforeRemoveEvent=function(e,t,n,r){var i=this;n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(a){if(i.isAllowedSubscriber(a,t.target)&&a.beforeRemove){var o=a.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastAfterInsertEvent=function(e,t,n){var r=this;n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterInsert){var a=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastBeforeTransactionStartEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.beforeTransactionStart){var r=n.beforeTransactionStart({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}})},e.prototype.broadcastAfterTransactionStartEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.afterTransactionStart){var r=n.afterTransactionStart({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}})},e.prototype.broadcastBeforeTransactionCommitEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.beforeTransactionCommit){var r=n.beforeTransactionCommit({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}})},e.prototype.broadcastAfterTransactionCommitEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.afterTransactionCommit){var r=n.afterTransactionCommit({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}})},e.prototype.broadcastBeforeTransactionRollbackEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.beforeTransactionRollback){var r=n.beforeTransactionRollback({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}})},e.prototype.broadcastAfterTransactionRollbackEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.afterTransactionRollback){var r=n.afterTransactionRollback({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}})},e.prototype.broadcastAfterUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(o.isAllowedSubscriber(s,t.target)&&s.afterUpdate){var u=s.afterUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}})},e.prototype.broadcastAfterRemoveEvent=function(e,t,n,r){var i=this;n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(a){if(i.isAllowedSubscriber(a,t.target)&&a.afterRemove){var o=a.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastLoadEventsForAll=function(e,t,n){var r=this;n.forEach(function(n){n instanceof Promise||(t.relations.length&&t.relations.forEach(function(t){if(!t.isLazy||n.hasOwnProperty(t.propertyName)){var i=t.getEntityValue(n);i instanceof Object&&r.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,Array.isArray(i)?i:[i])}}),t.afterLoadListeners.length&&t.afterLoadListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterLoad){var a=i.afterLoad(n,{connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}()},1444:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var r=function(){this.count=0,this.promises=[]}},8535:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});var r=function(){function e(){}return e.transformFrom=function(e,t){return Array.isArray(e)?e.slice().reverse().reduce(function(e,t){return t.from(e)},t):e.from(t)},e.transformTo=function(e,t){return Array.isArray(e)?e.reduce(function(e,t){return t.to(e)},t):e.to(t)},e}()},8893:function(e,t,n){"use strict";n.d(t,{E:function(){return i}});var r=n(274),i=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&"string"==typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r="string"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return(void 0===t&&(t=!1),e instanceof Date)?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"==typeof e){var t=(0,r.CR)(e.split(":"),3),n=t[0],i=t[1],a=t[2],o=new Date;return n&&o.setHours(parseInt(n)),i&&o.setMinutes(parseInt(i)),a&&o.setSeconds(parseInt(a)),o}return e},e.mixedTimeToString=function(e,t){return(void 0===t&&(t=!1),"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e))?e.split(":").map(function(e){return 1===e.length?"0"+e:e}).join(":"):e},e.mixedDateToDatetimeString=function(e,t){if("string"==typeof e&&(e=new Date(e)),e instanceof Date){var n=this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());t&&(n+="."+this.formatMilliseconds(e.getMilliseconds())),e=n}return e},e.mixedDateToUtcDatetimeString=function(e){return("string"==typeof e&&(e=new Date(e)),e instanceof Date)?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return Array.isArray(e)?e.map(function(e){return String(e)}).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.length>0?e.split(","):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){return"string"==typeof e?JSON.parse(e):e},e.simpleEnumToString=function(e){return""+e},e.stringToSimpleEnum=function(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<10?"00"+e:e<100?"0"+e:String(e)},e}()},7264:function(e,t,n){"use strict";n.d(t,{g:function(){return i}});var r=n(274),i=function(){function e(){}return e.assign=function(e){for(var t,n,i,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u=(0,r.XA)(o),c=u.next();!c.done;c=u.next()){var l=c.value;try{for(var h=(i=void 0,(0,r.XA)(Object.getOwnPropertyNames(l))),p=h.next();!p.done;p=h.next()){var f=p.value;e[f]=l[f]}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}},e}()},5738:function(e,t,n){"use strict";n.d(t,{s:function(){return a}});var r=n(274),i=n(8764).Buffer,a=function(){function e(){}return e.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),function(n,r){return e.slice(r*t,r*t+t)})},e.splitClassesAndStrings=function(e){return[e.filter(function(e){return"string"!=typeof e}),e.filter(function(e){return"string"==typeof e})]},e.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},e.uniq=function(e,t){return e.reduce(function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find(function(e){return t(e)===i})}else r="string"==typeof t?!!e.find(function(e){return e[t]===n[t]}):-1!==e.indexOf(n);return r||e.push(n),e},[])},e.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t,n,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if(!a.length)return e;var s=a.shift();if(this.isObject(e)&&this.isObject(s))for(var u in s){var c=s[u];"__proto__"===u||c instanceof Promise||(!this.isObject(c)||c instanceof Map||c instanceof Set||c instanceof Date||c instanceof i||c instanceof RegExp?Object.assign(e,((n={})[u]=c,n)):(e[u]||Object.assign(e,((t={})[u]=Object.create(Object.getPrototypeOf(c)),t)),this.mergeDeep(e[u],c)))}return this.mergeDeep.apply(this,(0,r.fl)([e],a))},e.deepCompare=function(){for(var e,t,n,r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(n=[],r=[],!this.compare2Objects(n,r,arguments[0],arguments[e]))return!1;return!0},e.compareIds=function(t,n){return null!=t&&null!=n&&(("string"==typeof t.id&&"string"==typeof n.id||"number"==typeof t.id&&"number"==typeof n.id)&&1===Object.keys(t).length&&1===Object.keys(n).length?t.id===n.id:e.deepCompare(t,n))},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},e.isArraysEqual=function(e,t){return e.length===t.length&&e.every(function(e){return -1!==t.indexOf(e)})},e.compare2Objects=function(e,t,n,r){var i;if(Number.isNaN(n)&&Number.isNaN(r)||n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if(("function"==typeof n.equals||n.equals instanceof Function)&&n.equals(r))return!0;if("function"==typeof n&&"function"==typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||n instanceof String&&r instanceof String||n instanceof Number&&r instanceof Number)return n.toString()===r.toString();if(!(n instanceof Object&&r instanceof Object)||n.isPrototypeOf(r)||r.isPrototypeOf(n)||n.constructor!==r.constructor||n.prototype!==r.prototype||e.indexOf(n)>-1||t.indexOf(r)>-1)return!1;for(i in r)if(r.hasOwnProperty(i)!==n.hasOwnProperty(i)||typeof r[i]!=typeof n[i])return!1;for(i in n){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i)||typeof r[i]!=typeof n[i])return!1;switch(typeof n[i]){case"object":case"function":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[i],r[i]))return!1;e.pop(),t.pop();break;default:if(n[i]!==r[i])return!1}}return!0},e}()},8664:function(e,t,n){"use strict";n.d(t,{f:function(){return r}});var r=function(){function e(){}return e.sha1=function(e){var t,n,r,i,a,o,s,u,c,l=function(e,t){return e<<t|e>>>32-t},h=function(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},p=Array(80),f=1732584193,d=4023233417,m=2562383102,y=271733878,v=3285377520,g=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<g-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(g%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(g-1)<<24|8388608;break;case 2:n=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:n=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(g>>>29),b.push(g<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(n=0,i=f,a=d,o=m,s=y,u=v;n<=19;n++)c=l(i,5)+(a&o|~a&s)+u+p[n]+1518500249&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(a^o^s)+u+p[n]+1859775393&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(a&o|a&s|o&s)+u+p[n]+2400959708&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(a^o^s)+u+p[n]+3395469782&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;f=f+i&4294967295,d=d+a&4294967295,m=m+o&4294967295,y=y+s&4294967295,v=v+u&4294967295}return(c=h(f)+h(d)+h(m)+h(y)+h(v)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e}()},5022:function(e,t,n){"use strict";n.d(t,{OV:function(){return u},Qs:function(){return s},eV:function(){return a},fu:function(){return o},vp:function(){return c}});var r=n(9072),i=n.n(r);function a(e,t){return void 0===t&&(t=!1),e.replace(/^([A-Z])|[\s-_](\w)/g,function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()})}function o(e){return e.replace(/(?:([a-z])([A-Z]))|(?:((?!^)[A-Z])([a-z]))/g,"$1_$3$2$4").toLowerCase()}function s(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function u(e,t){void 0===t&&(t={});var n=t.segmentLength,r=void 0===n?4:n,i=t.separator,a=void 0===i?"__":i,o=t.termLength,s=void 0===o?2:o;return e.split(a).reduce(function(e,t){var n=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),i=n.length>1?s:r,a=n.map(function(e){return e.substr(0,i)}).join("");return e.push(a),e},[]).join(a)}function c(e,t){void 0===t&&(t={});var n=i()("sha256");n.update(e,"utf8");var r=n.digest("hex");return t.length?r.slice(0,t.length):r}},274:function(e,t,n){"use strict";n.d(t,{CR:function(){return c},Jh:function(){return s},XA:function(){return u},ZT:function(){return i},fl:function(){return l},mG:function(){return o},pi:function(){return a}});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,s)}u((r=r.apply(e,t||[])).next())})}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}}}]);